// Minimal test to isolate TCP echo crash
use test::{assert, assert_eq}
use test::e2e::server::TcpTestServer
use test::e2e::client::TcpTestClient
use test::e2e::response::TestResult

@test
func test_tcp_echo_one_byte() -> I32 {
    let server: TcpTestServer = TcpTestServer::new().unwrap()
    let c: TcpTestClient = TcpTestClient::new(server.addr())
    let c2: TcpTestClient = c.send_byte(72)
    let c3: TcpTestClient = c2.expect_n(1)
    let result: TestResult = c3.run(ref server)
    assert(result.ok(), result.error_msg())
    assert_eq(result.received_len(), 1 as I64)
    0
}
