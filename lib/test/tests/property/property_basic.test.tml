//! Basic property-based testing tests.

use test::property::*
use test::assertions::*

@test
func test_property_stats_new() -> Outcome[(), Str] {
    let stats = PropertyStats::new()
    assert_eq(stats.total_tests, 0, "total_tests should be 0")
    assert_eq(stats.passed, 0, "passed should be 0")
    assert_eq(stats.failed, 0, "failed should be 0")
    Ok(())
}

@test
func test_property_stats_increment() -> Outcome[(), Str] {
    let mut stats = PropertyStats::new()
    stats.total_tests = 5
    stats.passed = 4
    stats.failed = 1

    assert_eq(stats.total_tests, 5, "total_tests set")
    assert_eq(stats.passed, 4, "passed set")
    assert_eq(stats.failed, 1, "failed set")
    Ok(())
}

@test
func test_test_result_creation() -> Outcome[(), Str] {
    let result = TestResult {
        passed: true,
        shrunk_input: "test",
        num_shrinks: 0
    }

    assert(result.passed, "Result passed")
    assert_eq(result.num_shrinks, 0, "No shrinks")
    Ok(())
}

@test
func test_shrink_i32_utility() -> Outcome[(), Str] {
    let shrunk = shrink_i32(100)
    assert(true, "shrink_i32 compiles")
    Ok(())
}

@test
func test_shrink_i64_utility() -> Outcome[(), Str] {
    let shrunk = shrink_i64(1000)
    assert(true, "shrink_i64 compiles")
    Ok(())
}

@test
func test_shrink_u32_utility() -> Outcome[(), Str] {
    let shrunk = shrink_u32(100)
    assert(true, "shrink_u32 compiles")
    Ok(())
}

@test
func test_shrink_u64_utility() -> Outcome[(), Str] {
    let shrunk = shrink_u64(1000)
    assert(true, "shrink_u64 compiles")
    Ok(())
}

@test
func test_shrink_str_utility() -> Outcome[(), Str] {
    let shrunk = shrink_str("hello")
    assert(true, "shrink_str compiles")
    Ok(())
}

@test
func test_property_stats_all_fields() -> Outcome[(), Str] {
    let mut stats = PropertyStats::new()
    stats.total_tests = 100
    stats.passed = 95
    stats.failed = 5
    stats.first_failing_test = 50
    stats.num_shrinks = 3
    stats.min_shrink_size = 10
    stats.max_shrink_size = 50

    assert_eq(stats.total_tests, 100, "total")
    assert_eq(stats.passed, 95, "passed")
    assert_eq(stats.failed, 5, "failed")
    assert_eq(stats.first_failing_test, 50, "first fail")
    assert_eq(stats.num_shrinks, 3, "shrinks")
    assert_eq(stats.min_shrink_size, 10, "min")
    assert_eq(stats.max_shrink_size, 50, "max")
    Ok(())
}
