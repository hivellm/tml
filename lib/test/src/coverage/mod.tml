//! Code Coverage Tracking Framework
//!
//! This module provides instrumentation for tracking which functions, lines,
//! and branches of code are executed during test runs, enabling comprehensive
//! coverage analysis and reporting.
//!
//! # Coverage Types
//!
//! Three levels of coverage can be tracked:
//!
//! - **Function Coverage** — Records which functions have been called
//! - **Line Coverage** — Records which source lines have executed
//! - **Branch Coverage** — Records which conditional branches have been taken
//!
//! # Tracking Functions
//!
//! These functions are called by the test runner during code execution:
//!
//! - [`cover_func`] — Mark a function as covered
//! - [`cover_line`] — Mark a source line as covered
//! - [`cover_branch`] — Mark a conditional branch as covered
//!
//! # Coverage Queries
//!
//! - [`get_covered_func_count`] — Count of functions covered
//! - [`get_covered_line_count`] — Count of lines covered
//! - [`get_covered_branch_count`] — Count of branches covered
//! - [`get_coverage_percent`] — Overall coverage percentage (0-100)
//! - [`is_func_covered`] — Check if specific function was covered
//!
//! # Coverage Management
//!
//! - [`print_coverage_report`] — Print full coverage report to stdout
//! - [`reset_coverage`] — Clear all coverage data for fresh run
//!
//! # Coverage Assertions
//!
//! - [`assert_func_covered`] — Assert specific function was covered
//! - [`assert_coverage_percent`] — Assert minimum coverage threshold met
//!
//! # Example
//!
//! ```tml
//! use test::coverage::*
//!
//! // During test execution, coverage is tracked automatically
//! // After tests complete, query the results:
//!
//! let total_coverage = get_coverage_percent()
//! assert_coverage_percent(80, "Must achieve at least 80% coverage")
//!
//! assert_func_covered("my_function", "my_function must be tested")
//!
//! // Print complete report
//! print_coverage_report()
//! ```
//!
//! # Implementation Notes
//!
//! Coverage tracking is implemented via external FFI functions that communicate
//! with the TML test runner runtime. The runner collects coverage events during
//! code execution and aggregates them for reporting.

// ============ Coverage Tracking ============

/// Mark a function as covered
/// Call this at the start of a function to track coverage
@extern("tml_cover_func")
pub func cover_func(name: Str)

/// Mark a line as covered
/// Use this to track specific line coverage
@extern("tml_cover_line")
pub func cover_line(file: Str, line: I32)

/// Mark a branch as covered
/// branch_id: unique identifier for this branch (e.g., 0 = if, 1 = else)
@extern("tml_cover_branch")
pub func cover_branch(file: Str, line: I32, branch_id: I32)

// ============ Coverage Reporting ============

/// Print coverage summary to stdout
@extern("tml_print_coverage_report")
pub func print_coverage_report()

/// Get total number of covered functions
@extern("tml_get_covered_func_count")
pub func get_covered_func_count() -> I32

/// Get total number of covered lines
@extern("tml_get_covered_line_count")
pub func get_covered_line_count() -> I32

/// Get total number of covered branches
@extern("tml_get_covered_branch_count")
pub func get_covered_branch_count() -> I32

/// Reset all coverage data
@extern("tml_reset_coverage")
pub func reset_coverage()

/// Get current coverage percentage (0-100)
@extern("tml_get_coverage_percent")
pub func get_coverage_percent() -> I32

/// Check if a specific function has been covered
@extern("tml_is_func_covered")
pub func is_func_covered(name: Str) -> Bool

// ============ Coverage Assertions ============

/// Assert that a function has been covered
pub func assert_func_covered(name: Str, message: Str) {
    if not is_func_covered(name) {
        panic("coverage assertion failed: " + message)
    }
}

/// Assert minimum function coverage percentage
pub func assert_coverage_percent(min_percent: I32, message: Str) {
    let actual: I32 = get_coverage_percent()
    if actual < min_percent {
        panic("coverage assertion failed (below threshold): " + message)
    }
}
