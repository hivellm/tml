// Tests for Buffer swap32 and swap64
use test
use std::collections::Buffer

@test
func test_buffer_swap32() -> I32 {
    var buf: Buffer = Buffer::new(8)
    // Write 4 bytes: 0x01, 0x02, 0x03, 0x04
    buf.write_byte(1)
    buf.write_byte(2)
    buf.write_byte(3)
    buf.write_byte(4)
    buf.swap32()
    // After swap32: 0x04, 0x03, 0x02, 0x01
    assert_eq(buf.get(0), 4, "swap32 byte 0")
    assert_eq(buf.get(1), 3, "swap32 byte 1")
    assert_eq(buf.get(2), 2, "swap32 byte 2")
    assert_eq(buf.get(3), 1, "swap32 byte 3")
    buf.destroy()
    return 0
}

@test
func test_buffer_swap64() -> I32 {
    var buf: Buffer = Buffer::new(16)
    // Write 8 bytes: 1,2,3,4,5,6,7,8
    buf.write_byte(1)
    buf.write_byte(2)
    buf.write_byte(3)
    buf.write_byte(4)
    buf.write_byte(5)
    buf.write_byte(6)
    buf.write_byte(7)
    buf.write_byte(8)
    buf.swap64()
    // After swap64: 8,7,6,5,4,3,2,1
    assert_eq(buf.get(0), 8, "swap64 byte 0")
    assert_eq(buf.get(1), 7, "swap64 byte 1")
    assert_eq(buf.get(7), 1, "swap64 byte 7")
    buf.destroy()
    return 0
}

@test
func test_buffer_i16_be() -> I32 {
    var buf: Buffer = Buffer::new(16)
    // Ensure 2 bytes allocated
    buf.write_byte(0)
    buf.write_byte(0)
    buf.write_u16_be(0x0102, 0)
    let val: I32 = buf.read_u16_be(0)
    assert_eq(val, 0x0102, "write/read u16_be roundtrip")
    buf.destroy()
    return 0
}
