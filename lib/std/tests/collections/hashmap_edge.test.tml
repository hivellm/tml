// Tests for HashMap edge cases
use test
use std::collections::{HashMap, HashMapIter}

@test
func test_hashmap_many_entries() -> I32 {
    let map: HashMap[I32, I32] = HashMap[I32, I32].new(4)
    var i: I32 = 0
    loop (i < 50) {
        map.set(i, i * 10)
        i = i + 1
    }
    assert_eq(map.len(), 50 as I64, "50 entries")
    assert_eq(map.get(0), 0, "get key 0")
    assert_eq(map.get(25), 250, "get key 25")
    assert_eq(map.get(49), 490, "get key 49")
    map.destroy()
    return 0
}

@test
func test_hashmap_remove_reinsert() -> I32 {
    let map: HashMap[I32, I32] = HashMap[I32, I32].new(16)
    map.set(1, 10)
    map.remove(1)
    assert(not map.has(1), "key should be gone after remove")
    map.set(1, 20)
    assert(map.has(1), "key should exist after reinsert")
    assert_eq(map.get(1), 20, "value should be new value")
    map.destroy()
    return 0
}

@test
func test_hashmap_clear_reuse() -> I32 {
    let map: HashMap[Str, I32] = HashMap[Str, I32].new(16)
    map.set("x", 1)
    map.set("y", 2)
    map.clear()
    assert_eq(map.len(), 0 as I64, "empty after clear")
    map.set("z", 99)
    assert_eq(map.get("z"), 99, "can use after clear")
    assert_eq(map.len(), 1 as I64, "len is 1")
    map.destroy()
    return 0
}
