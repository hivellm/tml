// Quick validation: List[T] pure TML implementation
use test::{assert, assert_eq}
use std::collections::List

@test
func test_list_create() -> I32 {
    let list: List[I32] = List[I32].new(8)
    assert_eq(list.len(), 0 as I64, "new list len should be 0")
    assert_eq(list.capacity(), 8 as I64, "capacity should be 8")
    assert(list.is_empty(), "new list should be empty")
    list.destroy()
    return 0
}

@test
func test_list_push_get() -> I32 {
    let list: List[I32] = List[I32].new(8)
    list.push(10)
    list.push(20)
    list.push(30)
    assert_eq(list.len(), 3 as I64, "len after 3 pushes")

    let v0: I64 = list.get(0)
    let v1: I64 = list.get(1)
    let v2: I64 = list.get(2)
    assert_eq(v0, 10 as I64, "get(0)")
    assert_eq(v1, 20 as I64, "get(1)")
    assert_eq(v2, 30 as I64, "get(2)")

    list.destroy()
    return 0
}

@test
func test_list_pop() -> I32 {
    let list: List[I32] = List[I32].new(4)
    list.push(1)
    list.push(2)
    list.push(3)

    let v: I64 = list.pop()
    assert_eq(v, 3 as I64, "pop returns last")
    assert_eq(list.len(), 2 as I64, "len after pop")

    list.destroy()
    return 0
}

@test
func test_list_set() -> I32 {
    let list: List[I32] = List[I32].new(4)
    list.push(10)
    list.push(20)
    list.set(0, 99)
    let v: I64 = list.get(0)
    assert_eq(v, 99 as I64, "set(0, 99)")
    list.destroy()
    return 0
}

@test
func test_list_first_last() -> I32 {
    let list: List[I32] = List[I32].new(4)
    list.push(1)
    list.push(2)
    list.push(3)
    let f: I64 = list.first()
    let l: I64 = list.last()
    assert_eq(f, 1 as I64, "first()")
    assert_eq(l, 3 as I64, "last()")
    list.destroy()
    return 0
}

@test
func test_list_clear() -> I32 {
    let list: List[I32] = List[I32].new(4)
    list.push(1)
    list.push(2)
    list.clear()
    assert_eq(list.len(), 0 as I64, "len after clear")
    assert(list.is_empty(), "is_empty after clear")
    list.destroy()
    return 0
}

@test
func test_list_grow() -> I32 {
    let list: List[I32] = List[I32].new(4)
    list.push(1)
    list.push(2)
    list.push(3)
    list.push(4)
    list.push(5)
    assert_eq(list.len(), 5 as I64, "len after grow")
    assert(list.capacity() >= 5 as I64, "capacity grew")
    let v: I64 = list.get(4)
    assert_eq(v, 5 as I64, "get(4) after grow")
    list.destroy()
    return 0
}

@test
func test_list_default() -> I32 {
    let list: List[I32] = List[I32].default()
    assert_eq(list.len(), 0 as I64, "default len 0")
    assert_eq(list.capacity(), 8 as I64, "default cap 8")
    list.destroy()
    return 0
}
