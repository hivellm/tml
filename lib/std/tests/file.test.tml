// Tests for std::file
use test
use std::file

// ============================================================================
// File Tests (Static Methods Only)
// ============================================================================

@test
func test_file_write_read_all() -> I32 {
    let path: Str = "test_file_rw.txt"
    let content: Str = "Hello, TML!"

    // Write
    let success: Bool = File.write_all(path, content)
    assert(success, "write_all should succeed")

    // Read
    let read_content: Str = File.read_all(path)
    assert(str_eq(read_content, content), "read content should match written content")

    // Cleanup
    Path.remove(path)
    return 0
}

@test
func test_file_append() -> I32 {
    let path: Str = "test_file_append.txt"

    File.write_all(path, "Line 1\n")
    File.append_all(path, "Line 2\n")

    let content: Str = File.read_all(path)
    assert(str_len(content) == 14, "appended content should have correct length")

    Path.remove(path)
    return 0
}

// ============================================================================
// Path Tests
// ============================================================================

@test
func test_path_exists() -> I32 {
    let path: Str = "test_exists.txt"

    assert(not Path.exists(path), "file should not exist initially")

    File.write_all(path, "test")
    assert(Path.exists(path), "file should exist after writing")

    Path.remove(path)
    assert(not Path.exists(path), "file should not exist after removal")
    return 0
}

@test
func test_path_is_file_dir() -> I32 {
    let file_path: Str = "test_is_file.txt"
    let dir_path: Str = "test_is_dir"

    // Create file
    File.write_all(file_path, "test")
    assert(Path.is_file(file_path), "should be a file")
    assert(not Path.is_dir(file_path), "should not be a directory")

    // Create directory
    Path.create_dir(dir_path)
    assert(Path.is_dir(dir_path), "should be a directory")
    assert(not Path.is_file(dir_path), "should not be a file")

    // Cleanup
    Path.remove(file_path)
    Path.remove_dir(dir_path)
    return 0
}

@test
func test_path_create_dir() -> I32 {
    let path: Str = "test_mkdir"

    assert(not Path.exists(path), "dir should not exist initially")

    let success: Bool = Path.create_dir(path)
    assert(success, "create_dir should succeed")
    assert(Path.exists(path), "dir should exist after creation")
    assert(Path.is_dir(path), "should be a directory")

    Path.remove_dir(path)
    return 0
}

@test
func test_path_rename_copy() -> I32 {
    let src: Str = "test_src.txt"
    let dst: Str = "test_dst.txt"
    let copy: Str = "test_copy.txt"

    File.write_all(src, "content")
    assert(Path.exists(src), "source should exist")

    // Test copy
    Path.copy(src, copy)
    assert(Path.exists(copy), "copy should exist")

    // Test rename
    Path.rename(src, dst)
    assert(not Path.exists(src), "source should not exist after rename")
    assert(Path.exists(dst), "dest should exist after rename")

    // Cleanup
    Path.remove(dst)
    Path.remove(copy)
    return 0
}
