//! Basic tests for std::log module.
//!
//! Tests log level constants, set/get level, enabled checks,
//! and basic logging calls.

use std::log
use std::log::{TRACE, DEBUG, INFO, WARN, ERROR, FATAL}
use test::{assert, assert_eq}

// ============================================================================
// Log Level Constants
// ============================================================================

@test
func test_log_const_trace() -> I32 {
    assert_eq(TRACE, 0, "TRACE should be 0")
    return 0
}

@test
func test_log_const_debug() -> I32 {
    assert_eq(DEBUG, 1, "DEBUG should be 1")
    return 0
}

@test
func test_log_const_info() -> I32 {
    assert_eq(INFO, 2, "INFO should be 2")
    return 0
}

@test
func test_log_const_warn() -> I32 {
    assert_eq(WARN, 3, "WARN should be 3")
    return 0
}

@test
func test_log_const_error() -> I32 {
    assert_eq(ERROR, 4, "ERROR should be 4")
    return 0
}

@test
func test_log_const_fatal() -> I32 {
    assert_eq(FATAL, 5, "FATAL should be 5")
    return 0
}

// ============================================================================
// Set/Get Level
// ============================================================================

@test
func test_log_set_get_level_debug() -> I32 {
    log::set_level(DEBUG)
    assert_eq(log::get_level(), DEBUG, "level should be DEBUG after set")
    log::set_level(WARN)
    return 0
}

@test
func test_log_set_get_level_trace() -> I32 {
    log::set_level(TRACE)
    assert_eq(log::get_level(), TRACE, "level should be TRACE")
    log::set_level(WARN)
    return 0
}

@test
func test_log_set_get_level_error() -> I32 {
    log::set_level(ERROR)
    assert_eq(log::get_level(), ERROR, "level should be ERROR")
    log::set_level(WARN)
    return 0
}

// ============================================================================
// Enabled Checks
// ============================================================================

@test
func test_log_enabled_at_warn() -> I32 {
    log::set_level(WARN)
    assert(log::enabled(WARN), "WARN should be enabled at WARN level")
    assert(log::enabled(ERROR), "ERROR should be enabled at WARN level")
    assert(log::enabled(FATAL), "FATAL should be enabled at WARN level")
    log::set_level(WARN)
    return 0
}

@test
func test_log_disabled_below_level() -> I32 {
    log::set_level(WARN)
    assert(not log::enabled(TRACE), "TRACE should be disabled at WARN level")
    assert(not log::enabled(DEBUG), "DEBUG should be disabled at WARN level")
    assert(not log::enabled(INFO), "INFO should be disabled at WARN level")
    log::set_level(WARN)
    return 0
}

@test
func test_log_all_enabled_at_trace() -> I32 {
    log::set_level(TRACE)
    assert(log::enabled(TRACE), "TRACE enabled at TRACE level")
    assert(log::enabled(DEBUG), "DEBUG enabled at TRACE level")
    assert(log::enabled(INFO), "INFO enabled at TRACE level")
    assert(log::enabled(WARN), "WARN enabled at TRACE level")
    assert(log::enabled(ERROR), "ERROR enabled at TRACE level")
    assert(log::enabled(FATAL), "FATAL enabled at TRACE level")
    log::set_level(WARN)
    return 0
}

// ============================================================================
// Basic Log Calls (should not crash)
// ============================================================================

@test
func test_log_trace_call() -> I32 {
    log::set_level(TRACE)
    log::trace("test", "trace message")
    log::set_level(WARN)
    return 0
}

@test
func test_log_debug_call() -> I32 {
    log::set_level(DEBUG)
    log::debug("test", "debug message")
    log::set_level(WARN)
    return 0
}

@test
func test_log_info_call() -> I32 {
    log::set_level(INFO)
    log::info("test", "info message")
    log::set_level(WARN)
    return 0
}

@test
func test_log_warn_call() -> I32 {
    log::warn("test", "warn message")
    return 0
}

@test
func test_log_error_call() -> I32 {
    log::error("test", "error message")
    return 0
}

@test
func test_log_fatal_call() -> I32 {
    log::fatal("test", "fatal message")
    return 0
}

@test
func test_log_generic_call() -> I32 {
    log::msg(INFO, "mymod", "generic log call")
    log::set_level(WARN)
    return 0
}

@test
func test_log_filtered_no_crash() -> I32 {
    log::set_level(ERROR)
    log::trace("test", "should be filtered")
    log::debug("test", "should be filtered")
    log::info("test", "should be filtered")
    log::warn("test", "should be filtered")
    log::set_level(WARN)
    return 0
}
