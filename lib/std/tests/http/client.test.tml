// Tests for std::http::client
use test::{assert, assert_eq}
use std::http::client::HttpClient
use std::http::response::Response
use core::intrinsics::mem_free

@test
func test_client_get_https() -> I32 {
    let client = HttpClient::new()
    let result = client.get("https://www.google.com")
    when result {
        Err(e) => {
            print("  HTTP GET failed: {e.message}\n")
            return 1
        },
        Ok(resp) => {
            let code: I32 = resp.status().code()
            print("  Status: {code}\n")
            // Google returns 200 or 301
            assert(code == 200 or code == 301, "expected 200 or 301")

            let body: Str = resp.text()
            let body_len: I64 = body.len()
            print("  Body length: {body_len}\n")
            assert(body_len > 0, "body should not be empty")
            lowlevel { mem_free(body as I64 as *Unit) }
            resp.destroy()
            return 0
        },
    }
}
