// Simple debug test for deflate
use test
use std::zlib::{deflate, inflate}
use std::zlib::error::ZlibError
use std::collections::Buffer

@extern("zlib_last_error_code")
func debug_last_error() -> I32

@test
func test_simple_deflate() -> I32 {
    let original: Str = "Hello"

    print("1. Calling deflate...\n")
    let result: Outcome[Buffer, ZlibError] = deflate(original)

    if result.is_err() {
        print("deflate failed!\n")
        return 1
    }

    var compressed: Buffer = result.unwrap()
    print("2. Deflate succeeded, compressed len: ")
    print(compressed.len())
    print("\n")

    print("3. Error code after deflate: ")
    let code1: I32 = debug_last_error()
    print(code1)
    print("\n")

    print("4. Calling inflate...\n")
    let inflate_result: Outcome[Str, ZlibError] = inflate(ref compressed)

    print("5. Error code after inflate: ")
    let code2: I32 = debug_last_error()
    print(code2)
    print("\n")

    if inflate_result.is_err() {
        print("inflate failed! Error code: ")
        print(code2)
        print("\n")
        return 1
    }

    let decompressed: Str = inflate_result.unwrap()
    print("6. Inflate succeeded: ")
    print(decompressed)
    print("\n")

    return 0
}
