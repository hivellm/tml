// Tests for Brotli with options
use test
use std::zlib::{brotli_compress_with_options, brotli_decompress_with_options, brotli_compress, brotli_decompress}
use std::zlib::options::BrotliOptions
use std::zlib::error::ZlibError
use std::collections::Buffer

@test
func test_brotli_compress_with_options() -> I32 {
    let original: Str = "Test data for brotli compression with options"
    let options: BrotliOptions = BrotliOptions::default().with_quality(6)
    let result: Outcome[Buffer, ZlibError] = brotli_compress_with_options(original, options)

    if result.is_err() {
        print("brotli_compress_with_options failed\n")
        return 1
    }

    var compressed: Buffer = result.unwrap()
    let decompress_result: Outcome[Str, ZlibError] = brotli_decompress(ref compressed)
    if decompress_result.is_err() {
        print("brotli_decompress failed\n")
        return 1
    }

    let decompressed: Str = decompress_result.unwrap()
    assert_eq(decompressed, original, "brotli with options roundtrip")

    return 0
}

@test
func test_brotli_decompress_with_options() -> I32 {
    let original: Str = "Test data for brotli decompression with options"
    let result: Outcome[Buffer, ZlibError] = brotli_compress(original)
    if result.is_err() {
        return 1
    }

    var compressed: Buffer = result.unwrap()
    let options: BrotliOptions = BrotliOptions::default()
    let decompress_result: Outcome[Str, ZlibError] = brotli_decompress_with_options(ref compressed, options)
    if decompress_result.is_err() {
        print("brotli_decompress_with_options failed\n")
        return 1
    }

    let decompressed: Str = decompress_result.unwrap()
    assert_eq(decompressed, original, "brotli decompress with options")

    return 0
}
