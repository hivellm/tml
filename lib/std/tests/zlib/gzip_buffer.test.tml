// Tests for gzip buffer operations
use test
use std::zlib::{gzip, gzip_buffer, gunzip_to_buffer}
use std::zlib::deflate
use std::zlib::error::ZlibError
use std::collections::Buffer

@test
func test_gzip_buffer() -> I32 {
    // First create a buffer using deflate
    let original: Str = "Data to test gzip_buffer function"
    let deflate_result: Outcome[Buffer, ZlibError] = deflate(original)
    if deflate_result.is_err() {
        print("deflate failed\n")
        return 1
    }

    var input_buf: Buffer = deflate_result.unwrap()

    // Now compress the buffer with gzip
    let result: Outcome[Buffer, ZlibError] = gzip_buffer(ref input_buf)
    if result.is_err() {
        print("gzip_buffer failed\n")
        return 1
    }

    var compressed: Buffer = result.unwrap()
    if compressed.len() == 0 {
        print("gzip_buffer returned empty buffer\n")
        return 1
    }

    return 0
}

@test
func test_gunzip_to_buffer() -> I32 {
    let original: Str = "Data for gunzip_to_buffer test"
    let result: Outcome[Buffer, ZlibError] = gzip(original)
    if result.is_err() {
        return 1
    }

    var compressed: Buffer = result.unwrap()

    // Decompress to buffer instead of string
    let decompress_result: Outcome[Buffer, ZlibError] = gunzip_to_buffer(ref compressed)
    if decompress_result.is_err() {
        print("gunzip_to_buffer failed\n")
        return 1
    }

    var decompressed_buf: Buffer = decompress_result.unwrap()
    if decompressed_buf.len() == 0 {
        print("gunzip_to_buffer returned empty buffer\n")
        return 1
    }

    return 0
}
