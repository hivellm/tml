// Tests for Zstd buffer operations
use test
use std::zlib::{zstd_compress, zstd_compress_buffer, zstd_decompress_to_buffer}
use std::zlib::error::ZlibError
use std::collections::Buffer

@test
func test_zstd_compress_buffer() -> I32 {
    // First compress to create a buffer
    let original: Str = "Test data for zstd buffer compression"
    let result: Outcome[Buffer, ZlibError] = zstd_compress(original)
    if result.is_err() {
        print("zstd_compress failed\n")
        return 1
    }

    var input_buf: Buffer = result.unwrap()

    // Now compress the already compressed buffer
    let result2: Outcome[Buffer, ZlibError] = zstd_compress_buffer(ref input_buf)
    if result2.is_err() {
        print("zstd_compress_buffer failed\n")
        return 1
    }

    var compressed: Buffer = result2.unwrap()
    if compressed.len() == 0 {
        print("zstd_compress_buffer returned empty buffer\n")
        return 1
    }

    return 0
}

@test
func test_zstd_decompress_to_buffer() -> I32 {
    let original: Str = "Data for zstd buffer decompression"
    let result: Outcome[Buffer, ZlibError] = zstd_compress(original)
    if result.is_err() {
        return 1
    }

    var compressed: Buffer = result.unwrap()

    // Decompress to buffer instead of string
    let decompress_result: Outcome[Buffer, ZlibError] = zstd_decompress_to_buffer(ref compressed)
    if decompress_result.is_err() {
        print("zstd_decompress_to_buffer failed\n")
        return 1
    }

    var decompressed_buf: Buffer = decompress_result.unwrap()
    if decompressed_buf.len() == 0 {
        print("zstd_decompress_to_buffer returned empty\n")
        return 1
    }

    return 0
}
