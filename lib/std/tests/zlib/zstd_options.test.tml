// Tests for Zstd with options
use test
use std::zlib::{zstd_compress, zstd_compress_with_options, zstd_decompress, zstd_decompress_with_options}
use std::zlib::options::ZstdOptions
use std::zlib::error::ZlibError
use std::collections::Buffer

@test
func test_zstd_compress_with_options() -> I32 {
    let original: Str = "Test data for zstd compression with options"
    let options: ZstdOptions = ZstdOptions::default().with_level(6)
    let result: Outcome[Buffer, ZlibError] = zstd_compress_with_options(original, options)

    if result.is_err() {
        print("zstd_compress_with_options failed\n")
        return 1
    }

    var compressed: Buffer = result.unwrap()
    let decompress_result: Outcome[Str, ZlibError] = zstd_decompress(ref compressed)
    if decompress_result.is_err() {
        print("zstd_decompress failed\n")
        return 1
    }

    let decompressed: Str = decompress_result.unwrap()
    assert_eq(decompressed, original, "zstd with options roundtrip")

    return 0
}

@test
func test_zstd_decompress_with_options() -> I32 {
    let original: Str = "Test data for zstd decompression with options"
    let result: Outcome[Buffer, ZlibError] = zstd_compress(original)
    if result.is_err() {
        return 1
    }

    var compressed: Buffer = result.unwrap()
    let options: ZstdOptions = ZstdOptions::default()
    let decompress_result: Outcome[Str, ZlibError] = zstd_decompress_with_options(ref compressed, options)
    if decompress_result.is_err() {
        print("zstd_decompress_with_options failed\n")
        return 1
    }

    let decompressed: Str = decompress_result.unwrap()
    assert_eq(decompressed, original, "zstd decompress with options")

    return 0
}
