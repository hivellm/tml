// Tests for deflate buffer operations
use test
use std::zlib::{deflate, deflate_buffer, deflate_buffer_with_options}
use std::zlib::{inflate, inflate_to_buffer}
use std::zlib::options::ZlibOptions
use std::zlib::error::ZlibError
use std::collections::Buffer

@test
func test_deflate_buffer() -> I32 {
    // First compress to create a buffer
    let original: Str = "Test data for deflate buffer compression"
    let result: Outcome[Buffer, ZlibError] = deflate(original)
    if result.is_err() {
        print("deflate failed\n")
        return 1
    }

    var input_buf: Buffer = result.unwrap()

    // Now compress the buffer again
    let result2: Outcome[Buffer, ZlibError] = deflate_buffer(ref input_buf)
    if result2.is_err() {
        print("deflate_buffer failed\n")
        return 1
    }

    var compressed: Buffer = result2.unwrap()
    if compressed.len() == 0 {
        print("deflate_buffer returned empty buffer\n")
        return 1
    }

    return 0
}

@test
func test_deflate_buffer_with_options() -> I32 {
    let original: Str = "Test data for deflate buffer with options"
    let result: Outcome[Buffer, ZlibError] = deflate(original)
    if result.is_err() {
        return 1
    }

    var input_buf: Buffer = result.unwrap()
    let opts: ZlibOptions = ZlibOptions::default().with_level(6)

    let result2: Outcome[Buffer, ZlibError] = deflate_buffer_with_options(ref input_buf, opts)
    if result2.is_err() {
        print("deflate_buffer_with_options failed\n")
        return 1
    }

    var compressed: Buffer = result2.unwrap()
    if compressed.len() == 0 {
        print("deflate_buffer_with_options returned empty\n")
        return 1
    }

    return 0
}
