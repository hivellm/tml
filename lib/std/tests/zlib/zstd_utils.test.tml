// Tests for Zstd utility functions
use test
use std::zlib::{zstd_compress, zstd_content_size, zstd_decompress_bound, zstd_is_frame, zstd_frame_dict_id}
use std::zlib::error::ZlibError
use std::collections::Buffer

@test
func test_zstd_is_frame() -> I32 {
    let original: Str = "Test data for zstd frame check"
    let result: Outcome[Buffer, ZlibError] = zstd_compress(original)
    if result.is_err() {
        return 1
    }

    var compressed: Buffer = result.unwrap()

    // Compressed buffer should be a valid zstd frame
    let is_frame: Bool = zstd_is_frame(ref compressed)
    assert_eq(is_frame, true, "compressed data should be valid zstd frame")

    return 0
}

@test
func test_zstd_decompress_bound() -> I32 {
    let original: Str = "Test data for decompress bound"
    let result: Outcome[Buffer, ZlibError] = zstd_compress(original)
    if result.is_err() {
        return 1
    }

    var compressed: Buffer = result.unwrap()

    // Get decompress bound
    let bound: I64 = zstd_decompress_bound(ref compressed)

    // Bound should be at least as large as original
    let original_len: I64 = original.len()
    if bound < original_len {
        print("decompress bound too small\n")
        return 1
    }

    return 0
}

@test
func test_zstd_frame_dict_id() -> I32 {
    let original: Str = "Test data for frame dict id"
    let result: Outcome[Buffer, ZlibError] = zstd_compress(original)
    if result.is_err() {
        return 1
    }

    var compressed: Buffer = result.unwrap()

    // No dictionary was used, so dict_id should be 0
    let dict_id: I32 = zstd_frame_dict_id(ref compressed)
    assert_eq(dict_id, 0, "no dictionary should give id 0")

    return 0
}
