// Tests for Brotli sync operations
use test
use std::zlib::{brotli_compress, brotli_decompress}
use std::zlib::{brotli_compress_sync, brotli_compress_sync_with_options}
use std::zlib::{brotli_decompress_sync, brotli_decompress_sync_with_options}
use std::zlib::options::BrotliOptions
use std::zlib::error::ZlibError
use std::collections::Buffer

@test
func test_brotli_compress_sync() -> I32 {
    let original: Str = "Test data for brotli_compress_sync"
    let result: Outcome[Buffer, ZlibError] = brotli_compress_sync(original)

    if result.is_err() {
        print("brotli_compress_sync failed\n")
        return 1
    }

    var compressed: Buffer = result.unwrap()
    if compressed.len() == 0 {
        print("brotli_compress_sync returned empty buffer\n")
        return 1
    }

    let decompress_result: Outcome[Str, ZlibError] = brotli_decompress_sync(ref compressed)
    if decompress_result.is_err() {
        print("brotli_decompress_sync failed\n")
        return 1
    }

    assert_eq(decompress_result.unwrap(), original, "brotli sync roundtrip")
    return 0
}

@test
func test_brotli_compress_sync_with_options() -> I32 {
    let original: Str = "Test data for brotli_compress_sync_with_options"
    let opts: BrotliOptions = BrotliOptions::default().with_quality(6)
    let result: Outcome[Buffer, ZlibError] = brotli_compress_sync_with_options(original, opts)

    if result.is_err() {
        print("brotli_compress_sync_with_options failed\n")
        return 1
    }

    var compressed: Buffer = result.unwrap()
    if compressed.len() == 0 {
        print("brotli_compress_sync_with_options returned empty buffer\n")
        return 1
    }

    return 0
}

@test
func test_brotli_decompress_sync_with_options() -> I32 {
    let original: Str = "Test data for brotli_decompress_sync_with_options"
    let result: Outcome[Buffer, ZlibError] = brotli_compress_sync(original)
    if result.is_err() {
        return 1
    }

    var compressed: Buffer = result.unwrap()
    let opts: BrotliOptions = BrotliOptions::default()
    let decompress_result: Outcome[Str, ZlibError] = brotli_decompress_sync_with_options(ref compressed, opts)
    if decompress_result.is_err() {
        print("brotli_decompress_sync_with_options failed\n")
        return 1
    }

    assert_eq(decompress_result.unwrap(), original, "brotli sync with options roundtrip")
    return 0
}

@test
func test_brotli_compress_sync_text_mode() -> I32 {
    let original: Str = "This is text content for Brotli text mode compression test."
    let opts: BrotliOptions = BrotliOptions::text()
    let result: Outcome[Buffer, ZlibError] = brotli_compress_sync_with_options(original, opts)

    if result.is_err() {
        print("brotli text mode compression failed\n")
        return 1
    }

    var compressed: Buffer = result.unwrap()
    let decompress_result: Outcome[Str, ZlibError] = brotli_decompress_sync(ref compressed)
    if decompress_result.is_err() {
        print("brotli text mode decompression failed\n")
        return 1
    }

    assert_eq(decompress_result.unwrap(), original, "brotli text mode roundtrip")
    return 0
}

@test
func test_brotli_compress_sync_fast() -> I32 {
    let original: Str = "Fast compression test data for Brotli."
    let opts: BrotliOptions = BrotliOptions::fast()
    let result: Outcome[Buffer, ZlibError] = brotli_compress_sync_with_options(original, opts)

    if result.is_err() {
        print("brotli fast compression failed\n")
        return 1
    }

    var compressed: Buffer = result.unwrap()
    let decompress_result: Outcome[Str, ZlibError] = brotli_decompress_sync(ref compressed)
    if decompress_result.is_err() {
        print("brotli fast decompression failed\n")
        return 1
    }

    assert_eq(decompress_result.unwrap(), original, "brotli fast roundtrip")
    return 0
}

@test
func test_brotli_compress_sync_best() -> I32 {
    let original: Str = "Best compression test data for Brotli - should achieve highest compression ratio."
    let opts: BrotliOptions = BrotliOptions::best()
    let result: Outcome[Buffer, ZlibError] = brotli_compress_sync_with_options(original, opts)

    if result.is_err() {
        print("brotli best compression failed\n")
        return 1
    }

    var compressed: Buffer = result.unwrap()
    let decompress_result: Outcome[Str, ZlibError] = brotli_decompress_sync(ref compressed)
    if decompress_result.is_err() {
        print("brotli best decompression failed\n")
        return 1
    }

    assert_eq(decompress_result.unwrap(), original, "brotli best roundtrip")
    return 0
}
