// Tests for deflate sync operations
use test
use std::zlib::{deflate, deflate_sync, deflate_sync_with_options}
use std::zlib::{inflate_sync, inflate_sync_with_options}
use std::zlib::{deflate_raw_sync, deflate_raw_sync_with_options}
use std::zlib::{inflate_raw_sync, inflate_raw_sync_with_options}
use std::zlib::{unzip_sync, unzip_sync_with_options}
use std::zlib::options::ZlibOptions
use std::zlib::error::ZlibError
use std::collections::Buffer

@test
func test_deflate_sync() -> I32 {
    let original: Str = "Test data for deflate_sync"
    let result: Outcome[Buffer, ZlibError] = deflate_sync(original)
    if result.is_err() {
        print("deflate_sync failed\n")
        return 1
    }

    var compressed: Buffer = result.unwrap()
    let inflate_result: Outcome[Str, ZlibError] = inflate_sync(ref compressed)
    if inflate_result.is_err() {
        print("inflate_sync failed\n")
        return 1
    }

    assert_eq(inflate_result.unwrap(), original, "sync roundtrip")
    return 0
}

@test
func test_deflate_sync_with_options() -> I32 {
    let original: Str = "Test data for deflate_sync_with_options"
    let opts: ZlibOptions = ZlibOptions::default().with_level(6)
    let result: Outcome[Buffer, ZlibError] = deflate_sync_with_options(original, opts)
    if result.is_err() {
        print("deflate_sync_with_options failed\n")
        return 1
    }

    var compressed: Buffer = result.unwrap()
    let opts2: ZlibOptions = ZlibOptions::default()
    let inflate_result: Outcome[Str, ZlibError] = inflate_sync_with_options(ref compressed, opts2)
    if inflate_result.is_err() {
        print("inflate_sync_with_options failed\n")
        return 1
    }

    assert_eq(inflate_result.unwrap(), original, "sync with options roundtrip")
    return 0
}

@test
func test_deflate_raw_sync() -> I32 {
    let original: Str = "Test data for deflate_raw_sync"
    let result: Outcome[Buffer, ZlibError] = deflate_raw_sync(original)
    if result.is_err() {
        print("deflate_raw_sync failed\n")
        return 1
    }

    var compressed: Buffer = result.unwrap()
    let inflate_result: Outcome[Str, ZlibError] = inflate_raw_sync(ref compressed)
    if inflate_result.is_err() {
        print("inflate_raw_sync failed\n")
        return 1
    }

    assert_eq(inflate_result.unwrap(), original, "raw sync roundtrip")
    return 0
}

@test
func test_deflate_raw_sync_with_options() -> I32 {
    let original: Str = "Test data for deflate_raw_sync_with_options"
    let opts: ZlibOptions = ZlibOptions::deflate_raw().with_level(6)
    let result: Outcome[Buffer, ZlibError] = deflate_raw_sync_with_options(original, opts)
    if result.is_err() {
        print("deflate_raw_sync_with_options failed\n")
        return 1
    }

    var compressed: Buffer = result.unwrap()
    let opts2: ZlibOptions = ZlibOptions::deflate_raw()
    let inflate_result: Outcome[Str, ZlibError] = inflate_raw_sync_with_options(ref compressed, opts2)
    if inflate_result.is_err() {
        print("inflate_raw_sync_with_options failed\n")
        return 1
    }

    assert_eq(inflate_result.unwrap(), original, "raw sync with opts roundtrip")
    return 0
}
