// Tests for gzip sync operations
use test
use std::zlib::{gzip_sync, gunzip_sync, gzip_sync_with_options, gunzip_sync_with_options}
use std::zlib::options::ZlibOptions
use std::zlib::error::ZlibError
use std::collections::Buffer

@test
func test_gzip_sync() -> I32 {
    let original: Str = "Test data for gzip_sync"
    let result: Outcome[Buffer, ZlibError] = gzip_sync(original)

    if result.is_err() {
        print("gzip_sync failed\n")
        return 1
    }

    var compressed: Buffer = result.unwrap()
    let decompress_result: Outcome[Str, ZlibError] = gunzip_sync(ref compressed)
    if decompress_result.is_err() {
        print("gunzip_sync failed\n")
        return 1
    }

    let decompressed: Str = decompress_result.unwrap()
    assert_eq(decompressed, original, "gzip_sync/gunzip_sync roundtrip")

    return 0
}

@test
func test_gzip_sync_with_options() -> I32 {
    let original: Str = "Test data for gzip_sync_with_options"
    let opts: ZlibOptions = ZlibOptions::gzip().with_level(6)
    let result: Outcome[Buffer, ZlibError] = gzip_sync_with_options(original, opts)

    if result.is_err() {
        print("gzip_sync_with_options failed\n")
        return 1
    }

    var compressed: Buffer = result.unwrap()
    if compressed.len() == 0 {
        print("gzip_sync_with_options returned empty buffer\n")
        return 1
    }

    return 0
}

@test
func test_gunzip_sync_with_options() -> I32 {
    let original: Str = "Test data for gunzip_sync_with_options"
    let result: Outcome[Buffer, ZlibError] = gzip_sync(original)
    if result.is_err() {
        return 1
    }

    var compressed: Buffer = result.unwrap()
    let opts: ZlibOptions = ZlibOptions::gzip()
    let decompress_result: Outcome[Str, ZlibError] = gunzip_sync_with_options(ref compressed, opts)
    if decompress_result.is_err() {
        print("gunzip_sync_with_options failed\n")
        return 1
    }

    assert_eq(decompress_result.unwrap(), original, "gunzip_sync_with_options roundtrip")
    return 0
}
