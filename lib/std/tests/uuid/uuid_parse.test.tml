use test
use std::uuid::Uuid

// === Parsing Hyphenated Format ===

@test
func test_uuid_parse_nil() -> I32 {
    let result = Uuid::parse("00000000-0000-0000-0000-000000000000")
    when result {
        Ok(id) => {
            assert(id.is_nil(), "parsed nil should be nil")
            assert_eq(id.to_string(), "00000000-0000-0000-0000-000000000000")
        }
        Err(e) => assert(false, "nil parse should succeed")
    }
    0
}

@test
func test_uuid_parse_max() -> I32 {
    let result = Uuid::parse("ffffffff-ffff-ffff-ffff-ffffffffffff")
    when result {
        Ok(id) => {
            assert_eq(id.to_string(), "ffffffff-ffff-ffff-ffff-ffffffffffff")
        }
        Err(e) => assert(false, "max parse should succeed")
    }
    0
}

@test
func test_uuid_parse_v4_known() -> I32 {
    let result = Uuid::parse("550e8400-e29b-41d4-a716-446655440000")
    when result {
        Ok(id) => {
            assert_eq(id.version(), 4)
            assert_eq(id.variant(), 2)
            assert_eq(id.to_string(), "550e8400-e29b-41d4-a716-446655440000")
        }
        Err(e) => assert(false, "known v4 parse should succeed")
    }
    0
}

// === Parsing Bare Format (32 hex chars) ===

@test
func test_uuid_parse_bare() -> I32 {
    let result = Uuid::parse("550e8400e29b41d4a716446655440000")
    when result {
        Ok(id) => {
            assert_eq(id.to_string(), "550e8400-e29b-41d4-a716-446655440000")
        }
        Err(e) => assert(false, "bare parse should succeed")
    }
    0
}

// === Parse Errors ===

@test
func test_uuid_parse_invalid_length() -> I32 {
    let result = Uuid::parse("550e8400")
    when result {
        Ok(id) => assert(false, "short string should fail")
        Err(e) => assert(true, "expected error")
    }
    0
}

@test
func test_uuid_parse_empty() -> I32 {
    let result = Uuid::parse("")
    when result {
        Ok(id) => assert(false, "empty string should fail")
        Err(e) => assert(true, "expected error")
    }
    0
}

@test
func test_uuid_parse_invalid_hex() -> I32 {
    let result = Uuid::parse("gggggggg-gggg-gggg-gggg-gggggggggggg")
    when result {
        Ok(id) => assert(false, "invalid hex should fail")
        Err(e) => assert(true, "expected error")
    }
    0
}

// === Parse Roundtrip ===

@test
func test_uuid_parse_uppercase() -> I32 {
    // Uppercase hex should work too
    let result = Uuid::parse("550E8400-E29B-41D4-A716-446655440000")
    when result {
        Ok(id) => {
            assert_eq(id.version(), 4)
            assert_eq(id.to_string(), "550e8400-e29b-41d4-a716-446655440000")
        }
        Err(e) => assert(false, "uppercase parse should succeed")
    }
    0
}
