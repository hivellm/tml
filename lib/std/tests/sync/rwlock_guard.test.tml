// Tests for sync/rwlock - guard methods (.get()/.get_mut())
// NOTE: Deref (*guard) on generic guard types triggers a codegen bug.
// Use .get()/.get_mut() instead of *guard.
use test
use std::sync::rwlock::RwLock

@test
func test_rwlock_read_get() -> I32 {
    var rw: RwLock[I32] = RwLock::new(77 as I32)
    let guard = rw.read()
    assert_eq(*guard.get(), 77 as I32, "read guard get should return 77")
    return 0
}

@test
func test_rwlock_write_get_mut() -> I32 {
    var rw: RwLock[I32] = RwLock::new(33 as I32)
    let mut guard = rw.write()
    assert_eq(*guard.get(), 33 as I32, "write guard get should return 33")
    *guard.get_mut() = 99 as I32
    assert_eq(*guard.get(), 99 as I32, "write guard get_mut should update")
    return 0
}
