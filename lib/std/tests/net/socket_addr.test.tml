// Tests for std::net::socket - SocketAddrV4 and SocketAddr
use test
use std::net::socket::{SocketAddrV4, SocketAddr}
use std::net::ip::{Ipv4Addr}

@test
func test_socket_addr_v4_new() -> I32 {
    let addr: SocketAddrV4 = SocketAddrV4::new(Ipv4Addr::LOCALHOST(), 8080 as U16)
    assert_eq(addr.port(), 8080 as U16, "port should be 8080")
    assert(addr.ip().is_loopback(), "ip should be loopback")
    return 0
}

@test
func test_socket_addr_v4_set_port() -> I32 {
    var addr: SocketAddrV4 = SocketAddrV4::new(Ipv4Addr::LOCALHOST(), 80 as U16)
    addr.set_port(443 as U16)
    assert_eq(addr.port(), 443 as U16, "port should be updated to 443")
    return 0
}

@test
func test_socket_addr_v4_set_ip() -> I32 {
    var addr: SocketAddrV4 = SocketAddrV4::new(Ipv4Addr::LOCALHOST(), 80 as U16)
    addr.set_ip(Ipv4Addr::UNSPECIFIED())
    assert(addr.ip().is_unspecified(), "ip should be updated to unspecified")
    return 0
}

@test
func test_socket_addr_v4_eq() -> I32 {
    let a = SocketAddrV4::new(Ipv4Addr::LOCALHOST(), 80 as U16)
    let b = SocketAddrV4::new(Ipv4Addr::LOCALHOST(), 80 as U16)
    assert(a == b, "same addr should be equal")
    return 0
}

@test
func test_socket_addr_v4_duplicate() -> I32 {
    let a = SocketAddrV4::new(Ipv4Addr::LOCALHOST(), 8080 as U16)
    let b = a.duplicate()
    assert(b.port() == 8080 as U16, "duplicate should have same port")
    return 0
}

@test
func test_socket_addr_from_v4() -> I32 {
    let v4 = SocketAddrV4::new(Ipv4Addr::LOCALHOST(), 3000 as U16)
    let addr = SocketAddr::V4(v4)
    assert(addr.port() == 3000 as U16, "SocketAddr port should be 3000")
    return 0
}

@test
func test_socket_addr_is_ipv4() -> I32 {
    let v4 = SocketAddrV4::new(Ipv4Addr::LOCALHOST(), 80 as U16)
    let addr = SocketAddr::V4(v4)
    assert(addr.is_ipv4(), "should be ipv4")
    assert(not addr.is_ipv6(), "should not be ipv6")
    return 0
}

@test
func test_socket_addr_set_port() -> I32 {
    let v4 = SocketAddrV4::new(Ipv4Addr::LOCALHOST(), 80 as U16)
    var addr = SocketAddr::V4(v4)
    addr.set_port(443 as U16)
    assert(addr.port() == 443 as U16, "set_port should update to 443")
    return 0
}

@test
func test_socket_addr_duplicate() -> I32 {
    let v4 = SocketAddrV4::new(Ipv4Addr::LOCALHOST(), 9999 as U16)
    let addr = SocketAddr::V4(v4)
    let copy = addr.duplicate()
    assert(copy.port() == 9999 as U16, "duplicate should preserve port")
    return 0
}
