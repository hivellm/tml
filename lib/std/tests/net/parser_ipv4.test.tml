use test
use std::net::parser::{parse_ipv4, parse_ipv6, parse_ip, AddrParseError}
use std::net::ip::{Ipv4Addr, Ipv6Addr, IpAddr}

// ============================================================================
// parse_ipv4 - Valid addresses
// ============================================================================

@test
func test_parse_ipv4_localhost() -> I32 {
    let result = parse_ipv4("127.0.0.1")
    when result {
        Ok(addr) => {
            assert_eq(addr.octet0() as I32, 127)
            assert_eq(addr.octet1() as I32, 0)
            assert_eq(addr.octet2() as I32, 0)
            assert_eq(addr.octet3() as I32, 1)
        }
        Err(_) => assert(false, "should parse 127.0.0.1")
    }
    0
}

@test
func test_parse_ipv4_zeros() -> I32 {
    let result = parse_ipv4("0.0.0.0")
    when result {
        Ok(addr) => {
            assert_eq(addr.octet0() as I32, 0)
            assert_eq(addr.octet1() as I32, 0)
            assert_eq(addr.octet2() as I32, 0)
            assert_eq(addr.octet3() as I32, 0)
        }
        Err(_) => assert(false, "should parse 0.0.0.0")
    }
    0
}

@test
func test_parse_ipv4_broadcast() -> I32 {
    let result = parse_ipv4("255.255.255.255")
    when result {
        Ok(addr) => {
            assert_eq(addr.octet0() as I32, 255)
            assert_eq(addr.octet1() as I32, 255)
            assert_eq(addr.octet2() as I32, 255)
            assert_eq(addr.octet3() as I32, 255)
        }
        Err(_) => assert(false, "should parse 255.255.255.255")
    }
    0
}

@test
func test_parse_ipv4_private() -> I32 {
    let result = parse_ipv4("192.168.1.100")
    when result {
        Ok(addr) => {
            assert_eq(addr.octet0() as I32, 192)
            assert_eq(addr.octet1() as I32, 168)
            assert_eq(addr.octet2() as I32, 1)
            assert_eq(addr.octet3() as I32, 100)
        }
        Err(_) => assert(false, "should parse 192.168.1.100")
    }
    0
}

@test
func test_parse_ipv4_class_a() -> I32 {
    let result = parse_ipv4("10.0.0.1")
    when result {
        Ok(addr) => {
            assert(addr.is_private(), "10.0.0.1 should be private")
            assert_eq(addr.octet0() as I32, 10)
        }
        Err(_) => assert(false, "should parse 10.0.0.1")
    }
    0
}

// ============================================================================
// parse_ipv4 - Invalid addresses
// ============================================================================

@test
func test_parse_ipv4_empty() -> I32 {
    let result = parse_ipv4("")
    when result {
        Ok(_) => assert(false, "empty string should fail")
        Err(_) => assert(true, "correctly rejected empty string")
    }
    0
}

@test
func test_parse_ipv4_too_few_octets() -> I32 {
    let result = parse_ipv4("127.0.1")
    when result {
        Ok(_) => assert(false, "3 octets should fail")
        Err(_) => assert(true, "correctly rejected 3 octets")
    }
    0
}

@test
func test_parse_ipv4_too_many_octets() -> I32 {
    let result = parse_ipv4("127.0.0.1.1")
    when result {
        Ok(_) => assert(false, "5 octets should fail")
        Err(_) => assert(true, "correctly rejected 5 octets")
    }
    0
}

@test
func test_parse_ipv4_octet_too_large() -> I32 {
    let result = parse_ipv4("256.0.0.1")
    when result {
        Ok(_) => assert(false, "octet 256 should fail")
        Err(_) => assert(true, "correctly rejected octet > 255")
    }
    0
}

@test
func test_parse_ipv4_leading_zero() -> I32 {
    let result = parse_ipv4("01.0.0.1")
    when result {
        Ok(_) => assert(false, "leading zero should fail")
        Err(_) => assert(true, "correctly rejected leading zero")
    }
    0
}

@test
func test_parse_ipv4_negative() -> I32 {
    let result = parse_ipv4("-1.0.0.1")
    when result {
        Ok(_) => assert(false, "negative should fail")
        Err(_) => assert(true, "correctly rejected negative")
    }
    0
}

@test
func test_parse_ipv4_letters() -> I32 {
    let result = parse_ipv4("abc.0.0.1")
    when result {
        Ok(_) => assert(false, "letters should fail")
        Err(_) => assert(true, "correctly rejected letters")
    }
    0
}

@test
func test_parse_ipv4_trailing_dot() -> I32 {
    let result = parse_ipv4("127.0.0.1.")
    when result {
        Ok(_) => assert(false, "trailing dot should fail")
        Err(_) => assert(true, "correctly rejected trailing dot")
    }
    0
}
