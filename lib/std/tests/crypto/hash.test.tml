//! Tests for crypto hash functions
//!
//! Tests MD5, SHA-1, SHA-2 family, and streaming hash API.

use std::crypto::hash::{sha256, sha512, sha384, sha1, md5, sha512_256}
use std::crypto::hash::{Hash, HashAlgorithm, Digest}
use test::{assert, assert_eq}

// ============================================================================
// SHA-256 Tests
// ============================================================================

@test
func test_sha256_empty_string() -> I32 {
    let mut digest: Digest = sha256("")
    let hex: Str = digest.to_hex()
    assert_eq(hex, "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855", "sha256 empty")
    digest.destroy()
    return 0
}

@test
func test_sha256_hello_world() -> I32 {
    let mut digest: Digest = sha256("hello world")
    let hex: Str = digest.to_hex()
    assert_eq(hex, "b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9", "sha256 hello world")
    digest.destroy()
    return 0
}

@test
func test_sha256_hello() -> I32 {
    let mut digest: Digest = sha256("hello")
    let hex: Str = digest.to_hex()
    assert_eq(hex, "2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824", "sha256 hello")
    digest.destroy()
    return 0
}

// ============================================================================
// SHA-512 Tests
// ============================================================================

@test
func test_sha512_empty_string() -> I32 {
    let mut digest: Digest = sha512("")
    let hex: Str = digest.to_hex()
    assert_eq(hex, "cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e", "sha512 empty")
    digest.destroy()
    return 0
}

@test
func test_sha512_hello() -> I32 {
    let mut digest: Digest = sha512("hello")
    let hex: Str = digest.to_hex()
    assert(hex.len() == (128 as I64), "sha512 produces 128 hex chars")
    digest.destroy()
    return 0
}

// ============================================================================
// SHA-384 Tests
// ============================================================================

@test
func test_sha384_empty_string() -> I32 {
    let mut digest: Digest = sha384("")
    let hex: Str = digest.to_hex()
    assert(hex.len() == (96 as I64), "sha384 produces 96 hex chars")
    digest.destroy()
    return 0
}

// ============================================================================
// SHA-1 Tests (legacy, not for security)
// ============================================================================

@test
func test_sha1_empty_string() -> I32 {
    let mut digest: Digest = sha1("")
    let hex: Str = digest.to_hex()
    assert_eq(hex, "da39a3ee5e6b4b0d3255bfef95601890afd80709", "sha1 empty")
    digest.destroy()
    return 0
}

@test
func test_sha1_hello() -> I32 {
    let mut digest: Digest = sha1("hello")
    let hex: Str = digest.to_hex()
    assert_eq(hex, "aaf4c61ddcc5e8a2dabede0f3b482cd9aea9434d", "sha1 hello")
    digest.destroy()
    return 0
}

// ============================================================================
// MD5 Tests (legacy, not for security)
// ============================================================================

@test
func test_md5_empty_string() -> I32 {
    let mut digest: Digest = md5("")
    let hex: Str = digest.to_hex()
    assert_eq(hex, "d41d8cd98f00b204e9800998ecf8427e", "md5 empty")
    digest.destroy()
    return 0
}

@test
func test_md5_hello() -> I32 {
    let mut digest: Digest = md5("hello")
    let hex: Str = digest.to_hex()
    assert_eq(hex, "5d41402abc4b2a76b9719d911017c592", "md5 hello")
    digest.destroy()
    return 0
}

// ============================================================================
// SHA-512/256 Tests
// ============================================================================

@test
func test_sha512_256_empty() -> I32 {
    let mut digest: Digest = sha512_256("")
    let hex: Str = digest.to_hex()
    assert(hex.len() == (64 as I64), "sha512-256 produces 64 hex chars")
    digest.destroy()
    return 0
}

// ============================================================================
// Streaming Hash API Tests
// ============================================================================

@test
func test_hash_streaming_sha256() -> I32 {
    let mut hash: Hash = Hash::create(HashAlgorithm::Sha256)
    hash.update("hello")
    hash.update(" ")
    hash.update("world")
    let mut digest: Digest = hash.digest()
    let hex: Str = digest.to_hex()
    assert_eq(hex, "b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9", "streaming sha256")
    digest.destroy()
    hash.destroy()
    return 0
}

@test
func test_hash_algorithm_md5() -> I32 {
    let mut hash: Hash = Hash::create(HashAlgorithm::Md5)
    hash.update("hello")
    let mut digest: Digest = hash.digest()
    assert_eq(digest.to_hex(), "5d41402abc4b2a76b9719d911017c592", "streaming md5")
    digest.destroy()
    hash.destroy()
    return 0
}

// ============================================================================
// Digest Encoding Tests
// ============================================================================

@test
func test_digest_to_base64() -> I32 {
    let mut digest: Digest = sha256("hello")
    let base64: Str = digest.to_base64()
    assert_eq(base64, "LPJNul+wow4m6DsqxbninhsWHlwfp0JecwQzYpOLmCQ=", "sha256 base64")
    digest.destroy()
    return 0
}
