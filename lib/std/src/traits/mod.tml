//! Core traits (behaviors) for TML types.
//!
//! This module provides the fundamental behaviors that types can implement
//! for common operations like copying, comparison, hashing, and conversion.
//!
//! # Core Behaviors
//!
//! | Behavior | Description |
//! |----------|-------------|
//! | [`Copy`] | Trivial bitwise copying |
//! | [`Duplicate`] | Explicit deep copying |
//! | [`Drop`] | Resource cleanup |
//!
//! # Equality and Ordering
//!
//! | Behavior | Description |
//! |----------|-------------|
//! | [`PartialEq`] | Partial equality comparison |
//! | [`Eq`] | Full equality (reflexive) |
//! | [`PartialOrd`] | Partial ordering |
//! | [`Ord`] | Total ordering |
//!
//! # Other Behaviors
//!
//! | Behavior | Description |
//! |----------|-------------|
//! | [`Hash`] | Hash code generation |
//! | [`Display`] | Human-readable formatting |
//! | [`Debug`] | Debug formatting |
//! | [`Default`] | Default value creation |
//! | [`From[T]`] | Conversion from type T |
//! | [`Into[T]`] | Conversion into type T |

/// Marker behavior for types that can be trivially copied (bitwise copy).
///
/// All primitive types (I32, F64, Bool, etc.) implicitly implement Copy.
/// Copy types don't need explicit cloning - assignment copies the value.
///
/// # Example
///
/// ```tml
/// // I32 is Copy, so this works:
/// let x: I32 = 5
/// let y: I32 = x  // x is copied, both are usable
/// ```
pub behavior Copy {
    // Marker behavior - no methods
}

/// Behavior for types that can create an explicit deep copy.
///
/// Required for non-Copy types that need explicit duplication.
/// Unlike Copy, Duplicate allows complex copying logic.
///
/// # Example
///
/// ```tml
/// impl Duplicate for MyList {
///     func duplicate(this) -> Self {
///         // Deep copy all elements
///     }
/// }
/// ```
pub behavior Duplicate {
    /// Creates and returns a copy of this value.
    func duplicate(this) -> Self
}

/// Behavior for types that need cleanup when going out of scope.
///
/// Called automatically by the runtime when a value is dropped.
/// Use for releasing resources like file handles, memory, etc.
///
/// # Example
///
/// ```tml
/// impl Drop for FileHandle {
///     func drop(mut this) {
///         this.close()
///     }
/// }
/// ```
pub behavior Drop {
    /// Called when the value is dropped.
    func drop(mut this)
}

/// Behavior for partial equality comparison.
///
/// May not be reflexive (e.g., `NaN != NaN` for floats).
/// Implement this to enable `==` and `!=` operators.
pub behavior PartialEq {
    /// Returns `true` if `this` equals `other`.
    func eq(this, other: ref Self) -> Bool

    /// Returns `true` if `this` does not equal `other`.
    func ne(this, other: ref Self) -> Bool {
        return not this.eq(other)
    }
}

/// Behavior for full equality (reflexive, symmetric, transitive).
///
/// Types implementing `Eq` guarantee that `a == a` is always true.
/// Required for use as keys in hash-based collections.
pub behavior Eq: PartialEq {
    // Inherits eq and ne from PartialEq
}

/// Represents the result of a comparison.
pub type Ordering {
    /// Less than.
    Less,
    /// Equal.
    Equal,
    /// Greater than.
    Greater,
}

/// Behavior for partial ordering comparison.
///
/// May have incomparable values (e.g., floats with NaN).
/// Implement this to enable `<`, `<=`, `>`, `>=` operators.
pub behavior PartialOrd: PartialEq {
    /// Compares and returns ordering, or `Nothing` if not comparable.
    func partial_cmp(this, other: ref Self) -> Maybe[Ordering]

    /// Returns `true` if `this < other`.
    func lt(this, other: ref Self) -> Bool {
        return when this.partial_cmp(other) {
            Just(Ordering::Less) => true,
            _ => false,
        }
    }

    /// Returns `true` if `this <= other`.
    func le(this, other: ref Self) -> Bool {
        return when this.partial_cmp(other) {
            Just(Ordering::Less) => true,
            Just(Ordering::Equal) => true,
            _ => false,
        }
    }

    /// Returns `true` if `this > other`.
    func gt(this, other: ref Self) -> Bool {
        return when this.partial_cmp(other) {
            Just(Ordering::Greater) => true,
            _ => false,
        }
    }

    /// Returns `true` if `this >= other`.
    func ge(this, other: ref Self) -> Bool {
        return when this.partial_cmp(other) {
            Just(Ordering::Greater) => true,
            Just(Ordering::Equal) => true,
            _ => false,
        }
    }
}

/// Behavior for total ordering (all values are comparable).
///
/// Required for sorting and binary search operations.
pub behavior Ord: Eq + PartialOrd {
    /// Compares and returns ordering.
    func cmp(this, other: ref Self) -> Ordering

    /// Returns ordering wrapped in `Just`.
    func partial_cmp(this, other: ref Self) -> Maybe[Ordering] {
        return Just(this.cmp(other))
    }

    /// Returns the maximum of two values.
    func max(this, other: Self) -> Self {
        return when this.cmp(ref other) {
            Ordering::Greater => this,
            Ordering::Equal => this,
            Ordering::Less => other,
        }
    }

    /// Returns the minimum of two values.
    func min(this, other: Self) -> Self {
        return when this.cmp(ref other) {
            Ordering::Less => this,
            Ordering::Equal => this,
            Ordering::Greater => other,
        }
    }
}

/// Behavior for types that can be hashed.
///
/// Required for use in hash-based collections like `HashMap`.
/// Types implementing `Hash` must also implement `Eq`.
pub behavior Hash {
    /// Computes and returns a hash value.
    func hash(this) -> I64
}

/// Behavior for human-readable string representation.
///
/// Implement this for user-facing output.
pub behavior Display {
    /// Returns a human-readable string representation.
    func to_string(this) -> Str
}

/// Behavior for debug string representation.
///
/// Implement this for debugging and logging output.
/// Typically more verbose than `Display`.
pub behavior Debug {
    /// Returns a debug string representation.
    func debug_string(this) -> Str
}

/// Behavior for types with a meaningful default value.
///
/// # Example
///
/// ```tml
/// impl Default for Counter {
///     func default() -> Self {
///         Counter { count: 0 }
///     }
/// }
/// ```
pub behavior Default {
    /// Creates and returns a default value.
    func default() -> Self
}

/// Behavior for infallible conversion from another type.
///
/// # Example
///
/// ```tml
/// impl From[I32] for I64 {
///     func from(value: I32) -> Self {
///         value as I64
///     }
/// }
/// ```
pub behavior From[T] {
    /// Converts from type T to Self.
    func from(value: T) -> Self
}

/// Behavior for infallible conversion into another type.
///
/// Automatically derived from `From`.
pub behavior Into[T] {
    /// Converts self into type T.
    func into(this) -> T
}

/// Behavior for fallible conversion from another type.
pub behavior TryFrom[T] {
    /// The error type returned on conversion failure.
    type Error

    /// Attempts to convert, returning `Err` on failure.
    func try_from(value: T) -> Outcome[Self, This::Error]
}

/// Behavior for fallible conversion into another type.
pub behavior TryInto[T] {
    /// The error type returned on conversion failure.
    type Error

    /// Attempts to convert, returning `Err` on failure.
    func try_into(this) -> Outcome[T, This::Error]
}

/// Behavior for cheap reference-to-reference conversion.
pub behavior AsRef[T] {
    /// Returns a reference to the inner type.
    func as_ref(this) -> ref T
}

/// Behavior for cheap mutable reference-to-reference conversion.
pub behavior AsMut[T] {
    /// Returns a mutable reference to the inner type.
    func as_mut(mut this) -> mut ref T
}

/// Marker behavior for types with known size at compile time.
///
/// Most types are `Sized`; only trait objects are `!Sized`.
pub behavior Sized {
    // Marker behavior - no methods
}

/// Marker behavior for types that can be safely sent between threads.
pub behavior Send {
    // Marker behavior - no methods
}

/// Marker behavior for types that can be safely shared between threads.
pub behavior Sync {
    // Marker behavior - no methods
}
