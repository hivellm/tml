//! HTTP request methods.
//!
//! Defines the standard HTTP methods as a variant type with
//! `when` matching and utility methods.

/// An HTTP request method.
pub type Method {
    /// GET — retrieve a resource.
    GET,
    /// POST — submit data.
    POST,
    /// PUT — replace a resource.
    PUT,
    /// DELETE — remove a resource.
    DELETE,
    /// PATCH — partial update.
    PATCH,
    /// HEAD — like GET but no body.
    HEAD,
    /// OPTIONS — describe communication options.
    OPTIONS,
    /// TRACE — loop-back test.
    TRACE,
    /// CONNECT — establish tunnel.
    CONNECT,
}

impl Method {
    /// Returns the method name as a string (e.g. "GET").
    pub func to_string(this) -> Str {
        when this {
            Method::GET => "GET",
            Method::POST => "POST",
            Method::PUT => "PUT",
            Method::DELETE => "DELETE",
            Method::PATCH => "PATCH",
            Method::HEAD => "HEAD",
            Method::OPTIONS => "OPTIONS",
            Method::TRACE => "TRACE",
            Method::CONNECT => "CONNECT",
        }
    }

    /// Parses a method from a string. Returns GET for unrecognized input.
    pub func from_string(s: Str) -> Method {
        when s {
            "GET" => Method::GET,
            "POST" => Method::POST,
            "PUT" => Method::PUT,
            "DELETE" => Method::DELETE,
            "PATCH" => Method::PATCH,
            "HEAD" => Method::HEAD,
            "OPTIONS" => Method::OPTIONS,
            "TRACE" => Method::TRACE,
            "CONNECT" => Method::CONNECT,
            _ => Method::GET,
        }
    }

    /// True if this method typically carries a request body.
    pub func has_body(this) -> Bool {
        when this {
            Method::POST => true,
            Method::PUT => true,
            Method::PATCH => true,
            _ => false,
        }
    }

    /// True if this method is idempotent.
    pub func is_idempotent(this) -> Bool {
        when this {
            Method::GET => true,
            Method::PUT => true,
            Method::DELETE => true,
            Method::HEAD => true,
            Method::OPTIONS => true,
            Method::TRACE => true,
            _ => false,
        }
    }

    /// True if this method is safe (no side effects).
    pub func is_safe(this) -> Bool {
        when this {
            Method::GET => true,
            Method::HEAD => true,
            Method::OPTIONS => true,
            Method::TRACE => true,
            _ => false,
        }
    }
}
