//! File I/O operations.
//!
//! Provides the [`File`] type for reading and writing files.
//!
//! # Example
//!
//! ```tml
//! use std::file::File
//!
//! let content = File::read_all("config.txt")
//! File::write_all("output.txt", "Hello, World!")
//! ```

// FFI declarations for C runtime file operations
@extern("file_open_read")
func ffi_file_open_read(path: Str) -> *Unit

@extern("file_open_write")
func ffi_file_open_write(path: Str) -> *Unit

@extern("file_open_append")
func ffi_file_open_append(path: Str) -> *Unit

@extern("file_close")
func ffi_file_close(handle: *Unit)

@extern("file_is_open")
func ffi_file_is_open(handle: *Unit) -> Bool

@extern("file_read_line")
func ffi_file_read_line(handle: *Unit) -> Str

@extern("file_write_str")
func ffi_file_write_str(handle: *Unit, content: Str) -> Bool

@extern("file_size")
func ffi_file_size(handle: *Unit) -> I64

@extern("file_flush")
func ffi_file_flush(handle: *Unit) -> Bool

@extern("file_read_all")
func ffi_file_read_all(path: Str) -> Str

@extern("file_write_all")
func ffi_file_write_all(path: Str, content: Str) -> Bool

@extern("file_append_all")
func ffi_file_append_all(path: Str, content: Str) -> Bool

/// A file handle for reading and writing operations.
///
/// `File` provides both instance methods for streaming I/O
/// and static methods for simple read/write operations.
///
/// # Example
///
/// ```tml
/// let file = File::open_read("data.txt")
/// let line = file.read_line()
/// file.close()
/// ```
pub type File {
    handle: *Unit
}

impl File {
    /// Open a file for reading
    pub func open_read(path: Str) -> File {
        let h: *Unit = ffi_file_open_read(path)
        File { handle: h }
    }

    /// Open a file for writing (creates or truncates)
    pub func open_write(path: Str) -> File {
        let h: *Unit = ffi_file_open_write(path)
        File { handle: h }
    }

    /// Open a file for appending
    pub func open_append(path: Str) -> File {
        let h: *Unit = ffi_file_open_append(path)
        File { handle: h }
    }

    /// Check if the file is open
    pub func is_open(this) -> Bool {
        return ffi_file_is_open(this.handle)
    }

    /// Read a single line from the file
    pub func read_line(this) -> Str {
        return ffi_file_read_line(this.handle)
    }

    /// Write a string to the file
    pub func write_str(this, content: Str) -> Bool {
        return ffi_file_write_str(this.handle, content)
    }

    /// Get the size of the file in bytes
    pub func size(this) -> I64 {
        return ffi_file_size(this.handle)
    }

    /// Flush buffered data to disk.
    pub func flush(this) -> Bool {
        return ffi_file_flush(this.handle)
    }

    /// Close the file
    pub func close(this) {
        ffi_file_close(this.handle)
    }

    // ========== Static utility functions ==========

    /// Read entire file contents as a string
    pub func read_all(path: Str) -> Str {
        return ffi_file_read_all(path)
    }

    /// Write content to a file (overwrites if exists)
    pub func write_all(path: Str, content: Str) -> Bool {
        return ffi_file_write_all(path, content)
    }

    /// Append content to a file
    pub func append_all(path: Str, content: Str) -> Bool {
        return ffi_file_append_all(path, content)
    }
}
