//! Implementations of formatting behaviors for built-in types.
//!
//! This module provides implementations of `Display`, `Debug`, and other
//! formatting behaviors for all primitive types and common generic types.
//!
//! # Behaviors Implemented
//!
//! | Behavior | Description | Types |
//! |----------|-------------|-------|
//! | [`Display`] | Human-readable string output | All primitives, `Maybe`, `Outcome`, `Ordering`, tuples |
//! | [`Debug`] | Debug/inspection output | All primitives, `Maybe`, `Outcome`, `Ordering`, tuples |
//! | [`Binary`] | Binary format (`0b...`) | All integer types |
//! | [`Octal`] | Octal format (`0o...`) | All integer types |
//! | [`LowerHex`] | Lower hex format (`0x...`) | All integer types |
//! | [`UpperHex`] | Upper hex format (`0x...`) | All integer types |
//! | [`LowerExp`] | Lower exponent (`1.5e2`) | F32, F64 |
//! | [`UpperExp`] | Upper exponent (`1.5E2`) | F32, F64 |
//!
//! # Examples
//!
//! ```tml
//! let x: I32 = 42
//! x.to_string()       // "42" (Display)
//! x.debug_string()    // "42" (Debug)
//! x.fmt_binary()      // "0b101010" (Binary)
//! x.fmt_lower_hex()   // "0x2a" (LowerHex)
//!
//! let m: Maybe[I32] = Just(10)
//! m.to_string()       // "Just(10)"
//! ```

// Display, Debug, Ordering are builtins - no import needed
use core::fmt::num::{Binary, Octal, LowerHex, UpperHex, LowerExp, UpperExp}
use core::fmt::helpers::{
    i8_to_str, i16_to_str, i32_to_str, i64_to_str,
    u8_to_str, u16_to_str, u32_to_str, u64_to_str,
    u8_to_binary_str, u16_to_binary_str, u32_to_binary_str, u64_to_binary_str,
    i8_to_binary_str, i16_to_binary_str, i32_to_binary_str, i64_to_binary_str,
    u64_to_octal_str, u64_to_hex_str,
    char_to_str
}

// ============================================================================
// Display implementations for primitives
// ============================================================================

/// Converts an `I8` to its decimal string representation.
impl Display for I8 {
    @allocates
    pub func to_string(this) -> Str {
        return i8_to_str(this)
    }
}

/// Converts an `I16` to its decimal string representation.
impl Display for I16 {
    @allocates
    pub func to_string(this) -> Str {
        return i16_to_str(this)
    }
}

/// Converts an `I32` to its decimal string representation.
impl Display for I32 {
    @allocates
    pub func to_string(this) -> Str {
        return i32_to_str(this)
    }
}

/// Converts an `I64` to its decimal string representation.
impl Display for I64 {
    @allocates
    pub func to_string(this) -> Str {
        return i64_to_str(this)
    }
}

/// Converts a `U8` to its decimal string representation.
impl Display for U8 {
    @allocates
    pub func to_string(this) -> Str {
        return u8_to_str(this)
    }
}

/// Converts a `U16` to its decimal string representation.
impl Display for U16 {
    @allocates
    pub func to_string(this) -> Str {
        return u16_to_str(this)
    }
}

/// Converts a `U32` to its decimal string representation.
impl Display for U32 {
    @allocates
    pub func to_string(this) -> Str {
        return u32_to_str(this)
    }
}

/// Converts a `U64` to its decimal string representation.
impl Display for U64 {
    @allocates
    pub func to_string(this) -> Str {
        return u64_to_str(this)
    }
}

/// Converts an `F32` to its string representation.
impl Display for F32 {
    @allocates
    pub func to_string(this) -> Str {
        return lowlevel { f32_to_string(this) }
    }
}

/// Converts an `F64` to its string representation.
impl Display for F64 {
    @allocates
    pub func to_string(this) -> Str {
        return lowlevel { f64_to_string(this) }
    }
}

/// Converts a `Bool` to `"true"` or `"false"`.
impl Display for Bool {
    pub func to_string(this) -> Str {
        if this {
            return "true"
        }
        return "false"
    }
}

/// Returns the string itself (identity conversion).
impl Display for Str {
    pub func to_string(this) -> Str {
        return this
    }
}

/// Converts a `Char` to a one-character string.
impl Display for Char {
    @allocates
    pub func to_string(this) -> Str {
        return char_to_str(this)
    }
}

/// Displays `Unit` as `"()"`.
impl Display for Unit {
    pub func to_string(this) -> Str {
        return "()"
    }
}

// ============================================================================
// Debug implementations for primitives
// ============================================================================

/// Debug output for `I8` (same as Display for numbers).
impl Debug for I8 {
    @allocates
    pub func debug_string(this) -> Str {
        return i8_to_str(this)
    }
}

/// Debug output for `I16`.
impl Debug for I16 {
    @allocates
    pub func debug_string(this) -> Str {
        return i16_to_str(this)
    }
}

/// Debug output for `I32`.
impl Debug for I32 {
    @allocates
    pub func debug_string(this) -> Str {
        return i32_to_str(this)
    }
}

/// Debug output for `I64`.
impl Debug for I64 {
    @allocates
    pub func debug_string(this) -> Str {
        return i64_to_str(this)
    }
}

/// Debug output for `U8`.
impl Debug for U8 {
    @allocates
    pub func debug_string(this) -> Str {
        return u8_to_str(this)
    }
}

/// Debug output for `U16`.
impl Debug for U16 {
    @allocates
    pub func debug_string(this) -> Str {
        return u16_to_str(this)
    }
}

/// Debug output for `U32`.
impl Debug for U32 {
    @allocates
    pub func debug_string(this) -> Str {
        return u32_to_str(this)
    }
}

/// Debug output for `U64`.
impl Debug for U64 {
    @allocates
    pub func debug_string(this) -> Str {
        return u64_to_str(this)
    }
}

/// Debug output for `F32`.
impl Debug for F32 {
    @allocates
    pub func debug_string(this) -> Str {
        return lowlevel { f32_to_string(this) }
    }
}

/// Debug output for `F64`.
impl Debug for F64 {
    @allocates
    pub func debug_string(this) -> Str {
        return lowlevel { f64_to_string(this) }
    }
}

/// Debug output for `Bool` (`"true"` or `"false"`).
impl Debug for Bool {
    pub func debug_string(this) -> Str {
        if this {
            return "true"
        }
        return "false"
    }
}

/// Debug output for `Str` (wraps in double quotes).
impl Debug for Str {
    @allocates
    pub func debug_string(this) -> Str {
        // Debug output includes quotes
        return "\"" + this + "\""
    }
}

/// Debug output for `Char` (wraps in single quotes).
impl Debug for Char {
    @allocates
    pub func debug_string(this) -> Str {
        return "'" + char_to_str(this) + "'"
    }
}

/// Debug output for `Unit` (`"()"`).
impl Debug for Unit {
    pub func debug_string(this) -> Str {
        return "()"
    }
}

// ============================================================================
// Display and Debug for Maybe[T]
// ============================================================================

/// Display for `Maybe[T]`: `"Just(value)"` or `"Nothing"`.
impl[T: Display] Display for Maybe[T] {
    @allocates
    pub func to_string(this) -> Str {
        when this {
            Just(val) => return "Just(" + val.to_string() + ")",
            Nothing => return "Nothing",
        }
    }
}

/// Debug for `Maybe[T]`: `"Just(debug)"` or `"Nothing"`.
impl[T: Debug] Debug for Maybe[T] {
    @allocates
    pub func debug_string(this) -> Str {
        when this {
            Just(val) => return "Just(" + val.debug_string() + ")",
            Nothing => return "Nothing",
        }
    }
}

// ============================================================================
// Display and Debug for Outcome[T, E]
// ============================================================================

/// Display for `Outcome[T, E]`: `"Ok(value)"` or `"Err(error)"`.
impl[T: Display, E: Display] Display for Outcome[T, E] {
    @allocates
    pub func to_string(this) -> Str {
        when this {
            Ok(val) => return "Ok(" + val.to_string() + ")",
            Err(e) => return "Err(" + e.to_string() + ")",
        }
    }
}

/// Debug for `Outcome[T, E]`: `"Ok(debug)"` or `"Err(debug)"`.
impl[T: Debug, E: Debug] Debug for Outcome[T, E] {
    @allocates
    pub func debug_string(this) -> Str {
        when this {
            Ok(val) => return "Ok(" + val.debug_string() + ")",
            Err(e) => return "Err(" + e.debug_string() + ")",
        }
    }
}

// ============================================================================
// Display and Debug for Ordering
// ============================================================================

/// Display for `Ordering`: `"Less"`, `"Equal"`, or `"Greater"`.
impl Display for Ordering {
    pub func to_string(this) -> Str {
        when this {
            Ordering::Less => return "Less",
            Ordering::Equal => return "Equal",
            Ordering::Greater => return "Greater",
        }
    }
}

/// Debug for `Ordering`: `"Ordering::Less"`, etc.
impl Debug for Ordering {
    pub func debug_string(this) -> Str {
        when this {
            Ordering::Less => return "Ordering::Less",
            Ordering::Equal => return "Ordering::Equal",
            Ordering::Greater => return "Ordering::Greater",
        }
    }
}

// ============================================================================
// Binary implementations
// ============================================================================

/// Binary format for `U8` (e.g. `"0b10101010"`).
impl Binary for U8 {
    @allocates
    pub func fmt_binary(this) -> Str {
        return "0b" + u8_to_binary_str(this)
    }
}

/// Binary format for `U16`.
impl Binary for U16 {
    @allocates
    pub func fmt_binary(this) -> Str {
        return "0b" + u16_to_binary_str(this)
    }
}

/// Binary format for `U32`.
impl Binary for U32 {
    @allocates
    pub func fmt_binary(this) -> Str {
        return "0b" + u32_to_binary_str(this)
    }
}

/// Binary format for `U64`.
impl Binary for U64 {
    @allocates
    pub func fmt_binary(this) -> Str {
        return "0b" + u64_to_binary_str(this)
    }
}

/// Binary format for `I8`.
impl Binary for I8 {
    @allocates
    pub func fmt_binary(this) -> Str {
        return "0b" + i8_to_binary_str(this)
    }
}

/// Binary format for `I16`.
impl Binary for I16 {
    @allocates
    pub func fmt_binary(this) -> Str {
        return "0b" + i16_to_binary_str(this)
    }
}

/// Binary format for `I32`.
impl Binary for I32 {
    @allocates
    pub func fmt_binary(this) -> Str {
        return "0b" + i32_to_binary_str(this)
    }
}

/// Binary format for `I64`.
impl Binary for I64 {
    @allocates
    pub func fmt_binary(this) -> Str {
        return "0b" + i64_to_binary_str(this)
    }
}

// ============================================================================
// Octal implementations
// ============================================================================

/// Octal format for `U8` (e.g. `"0o377"`).
impl Octal for U8 {
    @allocates
    pub func fmt_octal(this) -> Str {
        return "0o" + u64_to_octal_str(this as U64)
    }
}

/// Octal format for `U16`.
impl Octal for U16 {
    @allocates
    pub func fmt_octal(this) -> Str {
        return "0o" + u64_to_octal_str(this as U64)
    }
}

/// Octal format for `U32`.
impl Octal for U32 {
    @allocates
    pub func fmt_octal(this) -> Str {
        return "0o" + u64_to_octal_str(this as U64)
    }
}

/// Octal format for `U64`.
impl Octal for U64 {
    @allocates
    pub func fmt_octal(this) -> Str {
        return "0o" + u64_to_octal_str(this)
    }
}

/// Octal format for `I8`.
impl Octal for I8 {
    @allocates
    pub func fmt_octal(this) -> Str {
        return "0o" + u64_to_octal_str((this as U8) as U64)
    }
}

/// Octal format for `I16`.
impl Octal for I16 {
    @allocates
    pub func fmt_octal(this) -> Str {
        return "0o" + u64_to_octal_str((this as U16) as U64)
    }
}

/// Octal format for `I32`.
impl Octal for I32 {
    @allocates
    pub func fmt_octal(this) -> Str {
        return "0o" + u64_to_octal_str((this as U32) as U64)
    }
}

/// Octal format for `I64`.
impl Octal for I64 {
    @allocates
    pub func fmt_octal(this) -> Str {
        return "0o" + u64_to_octal_str(this as U64)
    }
}

// ============================================================================
// LowerHex implementations
// ============================================================================

/// Lower hex format for `U8` (e.g. `"0xff"`).
impl LowerHex for U8 {
    @allocates
    pub func fmt_lower_hex(this) -> Str {
        return "0x" + u64_to_hex_str(this as U64, false)
    }
}

/// Lower hex format for `U16`.
impl LowerHex for U16 {
    @allocates
    pub func fmt_lower_hex(this) -> Str {
        return "0x" + u64_to_hex_str(this as U64, false)
    }
}

/// Lower hex format for `U32`.
impl LowerHex for U32 {
    @allocates
    pub func fmt_lower_hex(this) -> Str {
        return "0x" + u64_to_hex_str(this as U64, false)
    }
}

/// Lower hex format for `U64`.
impl LowerHex for U64 {
    @allocates
    pub func fmt_lower_hex(this) -> Str {
        return "0x" + u64_to_hex_str(this, false)
    }
}

/// Lower hex format for `I8`.
impl LowerHex for I8 {
    @allocates
    pub func fmt_lower_hex(this) -> Str {
        return "0x" + u64_to_hex_str((this as U8) as U64, false)
    }
}

/// Lower hex format for `I16`.
impl LowerHex for I16 {
    @allocates
    pub func fmt_lower_hex(this) -> Str {
        return "0x" + u64_to_hex_str((this as U16) as U64, false)
    }
}

/// Lower hex format for `I32`.
impl LowerHex for I32 {
    @allocates
    pub func fmt_lower_hex(this) -> Str {
        return "0x" + u64_to_hex_str((this as U32) as U64, false)
    }
}

/// Lower hex format for `I64`.
impl LowerHex for I64 {
    @allocates
    pub func fmt_lower_hex(this) -> Str {
        return "0x" + u64_to_hex_str(this as U64, false)
    }
}

// ============================================================================
// UpperHex implementations
// ============================================================================

/// Upper hex format for `U8` (e.g. `"0xFF"`).
impl UpperHex for U8 {
    @allocates
    pub func fmt_upper_hex(this) -> Str {
        return "0x" + u64_to_hex_str(this as U64, true)
    }
}

/// Upper hex format for `U16`.
impl UpperHex for U16 {
    @allocates
    pub func fmt_upper_hex(this) -> Str {
        return "0x" + u64_to_hex_str(this as U64, true)
    }
}

/// Upper hex format for `U32`.
impl UpperHex for U32 {
    @allocates
    pub func fmt_upper_hex(this) -> Str {
        return "0x" + u64_to_hex_str(this as U64, true)
    }
}

/// Upper hex format for `U64`.
impl UpperHex for U64 {
    @allocates
    pub func fmt_upper_hex(this) -> Str {
        return "0x" + u64_to_hex_str(this, true)
    }
}

/// Upper hex format for `I8`.
impl UpperHex for I8 {
    @allocates
    pub func fmt_upper_hex(this) -> Str {
        return "0x" + u64_to_hex_str((this as U8) as U64, true)
    }
}

/// Upper hex format for `I16`.
impl UpperHex for I16 {
    @allocates
    pub func fmt_upper_hex(this) -> Str {
        return "0x" + u64_to_hex_str((this as U16) as U64, true)
    }
}

/// Upper hex format for `I32`.
impl UpperHex for I32 {
    @allocates
    pub func fmt_upper_hex(this) -> Str {
        return "0x" + u64_to_hex_str((this as U32) as U64, true)
    }
}

/// Upper hex format for `I64`.
impl UpperHex for I64 {
    @allocates
    pub func fmt_upper_hex(this) -> Str {
        return "0x" + u64_to_hex_str(this as U64, true)
    }
}

// ============================================================================
// LowerExp and UpperExp implementations for floats
// ============================================================================

/// Lower exponent format for `F32` (e.g. `"1.5e2"`).
impl LowerExp for F32 {
    @allocates
    pub func fmt_lower_exp(this) -> Str {
        return lowlevel { f32_to_exp_string(this, false) }
    }
}

/// Lower exponent format for `F64` (e.g. `"1.5e2"`).
impl LowerExp for F64 {
    @allocates
    pub func fmt_lower_exp(this) -> Str {
        return lowlevel { f64_to_exp_string(this, false) }
    }
}

/// Upper exponent format for `F32` (e.g. `"1.5E2"`).
impl UpperExp for F32 {
    @allocates
    pub func fmt_upper_exp(this) -> Str {
        return lowlevel { f32_to_exp_string(this, true) }
    }
}

/// Upper exponent format for `F64` (e.g. `"1.5E2"`).
impl UpperExp for F64 {
    @allocates
    pub func fmt_upper_exp(this) -> Str {
        return lowlevel { f64_to_exp_string(this, true) }
    }
}

// ============================================================================
// Display and Debug for tuples (2-tuples)
// ============================================================================

/// Display for 2-tuples: `"(a, b)"`.
impl[A: Display, B: Display] Display for (A, B) {
    @allocates
    pub func to_string(this) -> Str {
        return "(" + this.0.to_string() + ", " + this.1.to_string() + ")"
    }
}

/// Debug for 2-tuples: `"(a, b)"`.
impl[A: Debug, B: Debug] Debug for (A, B) {
    @allocates
    pub func debug_string(this) -> Str {
        return "(" + this.0.debug_string() + ", " + this.1.debug_string() + ")"
    }
}

// ============================================================================
// Display and Debug for 3-tuples
// ============================================================================

/// Display for 3-tuples: `"(a, b, c)"`.
impl[A: Display, B: Display, C: Display] Display for (A, B, C) {
    @allocates
    pub func to_string(this) -> Str {
        return "(" + this.0.to_string() + ", " + this.1.to_string() + ", " + this.2.to_string() + ")"
    }
}

/// Debug for 3-tuples: `"(a, b, c)"`.
impl[A: Debug, B: Debug, C: Debug] Debug for (A, B, C) {
    @allocates
    pub func debug_string(this) -> Str {
        return "(" + this.0.debug_string() + ", " + this.1.debug_string() + ", " + this.2.debug_string() + ")"
    }
}

// ============================================================================
// Display and Debug for 4-tuples
// ============================================================================

/// Display for 4-tuples: `"(a, b, c, d)"`.
impl[A: Display, B: Display, C: Display, D: Display] Display for (A, B, C, D) {
    @allocates
    pub func to_string(this) -> Str {
        return "(" + this.0.to_string() + ", " + this.1.to_string() + ", " +
               this.2.to_string() + ", " + this.3.to_string() + ")"
    }
}

/// Debug for 4-tuples: `"(a, b, c, d)"`.
impl[A: Debug, B: Debug, C: Debug, D: Debug] Debug for (A, B, C, D) {
    @allocates
    pub func debug_string(this) -> Str {
        return "(" + this.0.debug_string() + ", " + this.1.debug_string() + ", " +
               this.2.debug_string() + ", " + this.3.debug_string() + ")"
    }
}

// ============================================================================
// Display and Debug for 5-tuples
// ============================================================================

/// Display for 5-tuples: `"(a, b, c, d, e)"`.
impl[A: Display, B: Display, C: Display, D: Display, E: Display] Display for (A, B, C, D, E) {
    @allocates
    pub func to_string(this) -> Str {
        return "(" + this.0.to_string() + ", " + this.1.to_string() + ", " +
               this.2.to_string() + ", " + this.3.to_string() + ", " +
               this.4.to_string() + ")"
    }
}

/// Debug for 5-tuples: `"(a, b, c, d, e)"`.
impl[A: Debug, B: Debug, C: Debug, D: Debug, E: Debug] Debug for (A, B, C, D, E) {
    @allocates
    pub func debug_string(this) -> Str {
        return "(" + this.0.debug_string() + ", " + this.1.debug_string() + ", " +
               this.2.debug_string() + ", " + this.3.debug_string() + ", " +
               this.4.debug_string() + ")"
    }
}

// ============================================================================
// Display and Debug for 6-tuples
// ============================================================================

/// Display for 6-tuples: `"(a, b, c, d, e, f)"`.
impl[A: Display, B: Display, C: Display, D: Display, E: Display, F: Display] Display for (A, B, C, D, E, F) {
    @allocates
    pub func to_string(this) -> Str {
        return "(" + this.0.to_string() + ", " + this.1.to_string() + ", " +
               this.2.to_string() + ", " + this.3.to_string() + ", " +
               this.4.to_string() + ", " + this.5.to_string() + ")"
    }
}

/// Debug for 6-tuples: `"(a, b, c, d, e, f)"`.
impl[A: Debug, B: Debug, C: Debug, D: Debug, E: Debug, F: Debug] Debug for (A, B, C, D, E, F) {
    @allocates
    pub func debug_string(this) -> Str {
        return "(" + this.0.debug_string() + ", " + this.1.debug_string() + ", " +
               this.2.debug_string() + ", " + this.3.debug_string() + ", " +
               this.4.debug_string() + ", " + this.5.debug_string() + ")"
    }
}
