//! The Map adapter.
//!
//! This module provides the `Map` iterator adapter which transforms each
//! element using a function.

// ============================================================================
// Map Adapter
// ============================================================================

/// An iterator that transforms each element using a function.
///
/// This struct is created by the [`map`] function. See its documentation
/// for more details.
///
/// # Notes
///
/// `Map` is lazy - the transformation is only applied when the element
/// is consumed.
///
/// # Example
///
/// ```tml
/// use core::iter::*
///
/// var iter: OnceI32 = once_i32(5)
/// let doubled: Map[OnceI32, func(I32) -> I32] = map(iter, do(x: I32) -> I32 { x * 2 })
/// // Yields 10
/// ```
pub type Map[I, F] {
    iter: I,
    f: F
}

impl[I: Iterator, F, B] Iterator for Map[I, F] where F = func(I::Item) -> B {
    type Item = B

    pub func next(mut this) -> Maybe[B] {
        when this.iter.next() {
            Just(item) => return Just(this.f(item)),
            Nothing => return Nothing
        }
    }

    pub func size_hint(this) -> (I64, Maybe[I64]) {
        return this.iter.size_hint()
    }
}

// ============================================================================
// Constructor Function
// ============================================================================

/// Creates an iterator that transforms each element using a function.
///
/// The closure `f` is called on each element, transforming it into a new value.
/// The resulting iterator has the same length as the original.
///
/// # Example
///
/// ```tml
/// use core::iter::*
///
/// var nums: RepeatNI32 = repeat_n_i32(2, 3)
/// let squared: Map[RepeatNI32, func(I32) -> I32] = map(nums, do(x: I32) -> I32 { x * x })
/// // Yields 4, 4, 4
/// ```
pub func map[I: Iterator, F, B](iter: I, f: F) -> Map[I, F] where F = func(I::Item) -> B {
    return Map { iter: iter, f: f }
}
