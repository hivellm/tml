//! Iterator source types.
//!
//! This module provides types that create iterators from scratch rather than
//! by transforming existing iterators. These are the "starting points" for
//! iterator chains.
//!
//! # Available Sources
//!
//! | Function | Description |
//! |----------|-------------|
//! | [`empty_i32`] / [`empty_i64`] | Yields nothing |
//! | [`once_i32`] / [`once_i64`] | Yields exactly one element |
//! | [`repeat_n_i32`] / [`repeat_n_i64`] | Yields an element N times |
//!
//! # Examples
//!
//! ## Empty Iterator
//!
//! An iterator that yields no elements. Useful as a default or placeholder:
//!
//! ```tml
//! use core::iter::sources::empty_i32
//!
//! let mut iter = empty_i32()
//! assert(iter.next() == Nothing)  // Always yields Nothing
//! ```
//!
//! ## Once Iterator
//!
//! An iterator that yields exactly one element:
//!
//! ```tml
//! use core::iter::sources::once_i64
//!
//! let mut iter = once_i64(42)
//! assert(iter.next() == Just(42))  // First call yields the value
//! assert(iter.next() == Nothing)   // Second call yields Nothing
//! ```
//!
//! ## RepeatN Iterator
//!
//! An iterator that yields an element a fixed number of times:
//!
//! ```tml
//! use core::iter::sources::repeat_n_i32
//!
//! let mut iter = repeat_n_i32(7, 3)
//! assert(iter.next() == Just(7))
//! assert(iter.next() == Just(7))
//! assert(iter.next() == Just(7))
//! assert(iter.next() == Nothing)  // Exhausted after 3 yields
//! ```
//!
//! # Note on Type Suffixes
//!
//! These source functions currently use type suffixes (`_i32`, `_i64`) because
//! TML's generic inference for these patterns is still being developed. Future
//! versions will provide generic versions without suffixes.

// ============================================================================
// Empty Iterator for I32
// ============================================================================

/// An iterator that yields nothing.
///
/// This struct is created by the [`empty_i32`] function. See its documentation
/// for more details.
///
/// # Examples
///
/// ```tml
/// let mut empty = empty_i32()
/// assert(empty.next() == Nothing)
/// ```
pub type EmptyI32 {
    _done: Bool
}

impl EmptyI32 {
    pub func next(mut this) -> Maybe[I32] {
        return Nothing
    }
}

/// Creates an iterator that yields nothing.
///
/// This is useful when you need an iterator but have no elements to iterate
/// over. It can serve as a default or placeholder in generic code.
///
/// # Examples
///
/// ```tml
/// let mut iter = empty_i32()
///
/// // Always returns Nothing
/// assert(iter.next() == Nothing)
/// assert(iter.next() == Nothing)  // Still Nothing
/// ```
///
/// Use as a default when conditionally building iterators:
///
/// ```tml
/// func get_numbers(include: Bool) -> impl Iterator {
///     if include {
///         return once_i32(42)
///     }
///     return empty_i32()  // Fallback to empty
/// }
/// ```
pub func empty_i32() -> EmptyI32 {
    return EmptyI32 { _done: true }
}

// ============================================================================
// Empty Iterator for I64
// ============================================================================

/// An iterator that yields nothing (I64 version).
///
/// This struct is created by the [`empty_i64`] function. See its documentation
/// for more details.
pub type EmptyI64 {
    _done: Bool
}

impl EmptyI64 {
    pub func next(mut this) -> Maybe[I64] {
        return Nothing
    }
}

/// Creates an iterator that yields nothing (I64 version).
///
/// See [`empty_i32`] for full documentation. This is the I64 variant.
pub func empty_i64() -> EmptyI64 {
    return EmptyI64 { _done: true }
}

// ============================================================================
// Once Iterator for I32
// ============================================================================

/// An iterator that yields exactly one element.
///
/// This struct is created by the [`once_i32`] function. See its documentation
/// for more details.
///
/// # Examples
///
/// ```tml
/// let mut once = once_i32(42)
/// assert(once.next() == Just(42))
/// assert(once.next() == Nothing)
/// ```
pub type OnceI32 {
    value: Maybe[I32]
}

impl OnceI32 {
    pub func next(mut this) -> Maybe[I32] {
        let result: Maybe[I32] = this.value
        this.value = Nothing
        return result
    }
}

/// Creates an iterator that yields exactly one element.
///
/// This is useful when you need to pass a single value where an iterator is
/// expected, or when chaining a single element into an existing iterator.
///
/// # Examples
///
/// Basic usage:
///
/// ```tml
/// let mut iter = once_i32(42)
///
/// assert(iter.next() == Just(42))  // Yields the value
/// assert(iter.next() == Nothing)   // Then yields Nothing forever
/// ```
///
/// Chaining with other iterators:
///
/// ```tml
/// // Prepend a header value
/// let iter = chain(once_i32(0), range_iter)
/// ```
pub func once_i32(value: I32) -> OnceI32 {
    return OnceI32 { value: Just(value) }
}

// ============================================================================
// Once Iterator for I64
// ============================================================================

/// An iterator that yields exactly one element (I64 version).
///
/// This struct is created by the [`once_i64`] function. See its documentation
/// for more details.
pub type OnceI64 {
    value: Maybe[I64]
}

impl OnceI64 {
    pub func next(mut this) -> Maybe[I64] {
        let result: Maybe[I64] = this.value
        this.value = Nothing
        return result
    }
}

/// Creates an iterator that yields exactly one element (I64 version).
///
/// See [`once_i32`] for full documentation. This is the I64 variant.
pub func once_i64(value: I64) -> OnceI64 {
    return OnceI64 { value: Just(value) }
}

// ============================================================================
// RepeatN Iterator for I32
// ============================================================================

/// An iterator that repeats an element a fixed number of times.
///
/// This struct is created by the [`repeat_n_i32`] function. See its
/// documentation for more details.
///
/// Unlike an infinite `repeat` iterator, `RepeatN` has a defined length and
/// will exhaust after yielding the element `n` times.
///
/// # Examples
///
/// ```tml
/// let mut iter = repeat_n_i32(5, 3)
/// assert(iter.next() == Just(5))
/// assert(iter.next() == Just(5))
/// assert(iter.next() == Just(5))
/// assert(iter.next() == Nothing)
/// ```
pub type RepeatNI32 {
    value: I32,
    remaining: I64
}

impl RepeatNI32 {
    pub func next(mut this) -> Maybe[I32] {
        if this.remaining <= 0 {
            return Nothing
        }
        this.remaining = this.remaining - 1
        return Just(this.value)
    }
}

/// Creates an iterator that repeats an element exactly `n` times.
///
/// This is useful when you need to fill a collection with the same value,
/// or when you need a predictable number of identical elements.
///
/// # Arguments
///
/// * `value` - The value to repeat
/// * `n` - The number of times to yield the value
///
/// # Examples
///
/// Basic usage:
///
/// ```tml
/// let mut iter = repeat_n_i32(42, 3)
///
/// assert(iter.next() == Just(42))
/// assert(iter.next() == Just(42))
/// assert(iter.next() == Just(42))
/// assert(iter.next() == Nothing)  // Exhausted
/// ```
///
/// Zero repetitions:
///
/// ```tml
/// let mut iter = repeat_n_i32(42, 0)
/// assert(iter.next() == Nothing)  // Immediately exhausted
/// ```
///
/// Combining with other adapters:
///
/// ```tml
/// // Create padding of zeros
/// let padding = repeat_n_i32(0, 5)
/// let iter = chain(data_iter, padding)
/// ```
pub func repeat_n_i32(value: I32, n: I64) -> RepeatNI32 {
    return RepeatNI32 { value: value, remaining: n }
}

// ============================================================================
// RepeatN Iterator for I64
// ============================================================================

/// An iterator that repeats an element a fixed number of times (I64 version).
///
/// This struct is created by the [`repeat_n_i64`] function. See its
/// documentation for more details.
pub type RepeatNI64 {
    value: I64,
    remaining: I64
}

impl RepeatNI64 {
    pub func next(mut this) -> Maybe[I64] {
        if this.remaining <= 0 {
            return Nothing
        }
        this.remaining = this.remaining - 1
        return Just(this.value)
    }
}

/// Creates an iterator that repeats an element exactly `n` times (I64 version).
///
/// See [`repeat_n_i32`] for full documentation. This is the I64 variant.
pub func repeat_n_i64(value: I64, n: I64) -> RepeatNI64 {
    return RepeatNI64 { value: value, remaining: n }
}
