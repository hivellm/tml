// Tests for core::ptr::const_ptr â€” RawPtr methods
use test::{assert, assert_eq}
use core::ptr::const_ptr::RawPtr

@test
func test_raw_ptr_null() -> I32 {
    let ptr: RawPtr[I64] = RawPtr::null_ptr()
    assert(ptr.is_null(), "null_ptr should be null")
    assert_eq(ptr.addr(), 0 as I64, "null addr should be 0")
    return 0
}

@test
func test_raw_ptr_from_addr() -> I32 {
    let ptr: RawPtr[I64] = RawPtr::from_addr(4096 as I64)
    assert(not ptr.is_null(), "from_addr(4096) should not be null")
    assert_eq(ptr.addr(), 4096 as I64, "addr should return 4096")
    return 0
}

@test
func test_raw_ptr_cast() -> I32 {
    let ptr: RawPtr[I64] = RawPtr::from_addr(2000 as I64)
    let byte_ptr: RawPtr[U8] = ptr.cast[U8]()
    assert_eq(byte_ptr.addr(), 2000 as I64, "cast should preserve address")
    return 0
}

@test
func test_raw_ptr_offset() -> I32 {
    let ptr: RawPtr[I64] = RawPtr::from_addr(1000 as I64)
    let next: RawPtr[I64] = ptr.offset(1 as I64)
    assert(next.addr() > ptr.addr(), "offset(1) should increase address")
    return 0
}

@test
func test_raw_ptr_add() -> I32 {
    let ptr: RawPtr[I64] = RawPtr::from_addr(1000 as I64)
    let next: RawPtr[I64] = ptr.add(2 as I64)
    assert(next.addr() > ptr.addr(), "add(2) should increase address")
    return 0
}

@test
func test_raw_ptr_sub() -> I32 {
    let ptr: RawPtr[I64] = RawPtr::from_addr(1000 as I64)
    let prev: RawPtr[I64] = ptr.sub(1 as I64)
    assert(prev.addr() < ptr.addr(), "sub(1) should decrease address")
    return 0
}

@test
func test_raw_ptr_offset_from() -> I32 {
    let p1: RawPtr[I64] = RawPtr::from_addr(1000 as I64)
    let p2: RawPtr[I64] = RawPtr::from_addr(1000 as I64)
    let dist: I64 = p1.offset_from(p2)
    assert_eq(dist, 0 as I64, "same address offset_from should be 0")
    return 0
}

@test
func test_raw_ptr_is_aligned() -> I32 {
    let ptr: RawPtr[I64] = RawPtr::from_addr(1024 as I64)
    assert(ptr.is_aligned(), "1024 should be aligned for I64")
    return 0
}

@test
func test_raw_ptr_to_usize() -> I32 {
    let ptr: RawPtr[I64] = RawPtr::from_addr(5000 as I64)
    assert_eq(ptr.to_usize(), 5000 as I64, "to_usize should return address")
    return 0
}

@test
func test_raw_ptr_hash() -> I32 {
    let ptr: RawPtr[I64] = RawPtr::from_addr(7777 as I64)
    let h: I64 = ptr.hash()
    assert_eq(h, 7777 as I64, "hash should return address")
    return 0
}

@test
func test_raw_ptr_not_aligned_odd() -> I32 {
    let ptr: RawPtr[I64] = RawPtr::from_addr(3 as I64)
    assert(not ptr.is_aligned(), "address 3 should not be aligned for I64")
    return 0
}

@test
func test_raw_ptr_aligned_powers() -> I32 {
    let ptr: RawPtr[I64] = RawPtr::from_addr(64 as I64)
    assert(ptr.is_aligned(), "address 64 should be aligned for I64")
    return 0
}

@test
func test_raw_ptr_offset_negative() -> I32 {
    let ptr: RawPtr[I64] = RawPtr::from_addr(2000 as I64)
    let prev: RawPtr[I64] = ptr.offset(-1 as I64)
    assert(prev.addr() < ptr.addr(), "offset(-1) should decrease address")
    return 0
}
