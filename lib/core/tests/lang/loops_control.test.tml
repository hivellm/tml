// Tests for loops and control flow - loop, for, if/else, break, continue
use test

// =============================================================================
// loop (while-style)
// =============================================================================

@test
func test_loop_count_to_ten() -> I32 {
    var count: I32 = 0
    loop (count < 10) {
        count = count + 1
    }
    assert_eq(count, 10, "loop should count to 10")
    return 0
}

@test
func test_loop_sum() -> I32 {
    var sum: I32 = 0
    var i: I32 = 1
    loop (i <= 5) {
        sum = sum + i
        i = i + 1
    }
    assert_eq(sum, 15, "sum of 1..5 should be 15")
    return 0
}

@test
func test_loop_zero_iterations() -> I32 {
    var count: I32 = 0
    loop (false) {
        count = count + 1
    }
    assert_eq(count, 0, "loop(false) should execute 0 times")
    return 0
}

// =============================================================================
// loop with break
// =============================================================================

@test
func test_loop_break() -> I32 {
    var i: I32 = 0
    loop (true) {
        if i >= 5 {
            break
        }
        i = i + 1
    }
    assert_eq(i, 5, "loop with break should stop at 5")
    return 0
}

// =============================================================================
// loop with continue
// =============================================================================

@test
func test_loop_continue_skip_even() -> I32 {
    var sum: I32 = 0
    var i: I32 = 0
    loop (i < 10) {
        i = i + 1
        if i % 2 == 0 {
            continue
        }
        sum = sum + i
    }
    // sum of odd numbers 1+3+5+7+9 = 25
    assert_eq(sum, 25, "sum of odd numbers 1-9 should be 25")
    return 0
}

// =============================================================================
// for-in range loops
// =============================================================================

@test
func test_for_range_to() -> I32 {
    var sum: I32 = 0
    for i in 0 to 5 {
        sum = sum + i
    }
    // 0+1+2+3+4 = 10
    assert_eq(sum, 10, "for 0 to 5 should sum to 10")
    return 0
}

@test
func test_for_range_through() -> I32 {
    var sum: I32 = 0
    for i in 1 through 5 {
        sum = sum + i
    }
    // 1+2+3+4+5 = 15
    assert_eq(sum, 15, "for 1 through 5 should sum to 15")
    return 0
}

// =============================================================================
// if/else
// =============================================================================

func classify_sign(n: I32) -> I32 {
    if n > 0 {
        return 1
    } else if n < 0 {
        return -1
    } else {
        return 0
    }
}

@test
func test_if_positive() -> I32 {
    assert_eq(classify_sign(42), 1, "positive should return 1")
    return 0
}

@test
func test_if_negative() -> I32 {
    assert_eq(classify_sign(-7), -1, "negative should return -1")
    return 0
}

@test
func test_if_zero() -> I32 {
    assert_eq(classify_sign(0), 0, "zero should return 0")
    return 0
}

// =============================================================================
// nested loops
// =============================================================================

@test
func test_nested_loop() -> I32 {
    var total: I32 = 0
    var i: I32 = 0
    loop (i < 3) {
        var j: I32 = 0
        loop (j < 4) {
            total = total + 1
            j = j + 1
        }
        i = i + 1
    }
    assert_eq(total, 12, "3x4 nested loop should be 12")
    return 0
}

// =============================================================================
// Ternary / conditional expression
// =============================================================================

@test
func test_ternary_true() -> I32 {
    let x: I32 = 5
    let result: I32 = if x > 3 { 100 } else { 0 }
    assert_eq(result, 100, "ternary true branch should be 100")
    return 0
}

@test
func test_ternary_false() -> I32 {
    let x: I32 = 1
    let result: I32 = if x > 3 { 100 } else { 0 }
    assert_eq(result, 0, "ternary false branch should be 0")
    return 0
}
