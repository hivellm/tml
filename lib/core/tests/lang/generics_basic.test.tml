// Tests for generics - generic functions, generic types
use test

// =============================================================================
// Generic function - identity
// =============================================================================

func identity[T](x: T) -> T {
    return x
}

@test
func test_generic_identity_i32() -> I32 {
    let result: I32 = identity[I32](42)
    assert_eq(result, 42, "identity(42) should be 42")
    return 0
}

@test
func test_generic_identity_bool() -> I32 {
    let result: Bool = identity[Bool](true)
    assert(result, "identity(true) should be true")
    return 0
}

// =============================================================================
// Generic function - max
// =============================================================================

func max_of[T](a: T, b: T) -> T {
    if a > b {
        return a
    }
    return b
}

@test
func test_generic_max_i32() -> I32 {
    let result: I32 = max_of[I32](3, 7)
    assert_eq(result, 7, "max(3, 7) should be 7")
    return 0
}

@test
func test_generic_max_i32_equal() -> I32 {
    let result: I32 = max_of[I32](5, 5)
    assert_eq(result, 5, "max(5, 5) should be 5")
    return 0
}

// =============================================================================
// Generic type (Pair)
// =============================================================================

type Pair[A, B] {
    first: A,
    second: B
}

@test
func test_generic_pair_i32_i32() -> I32 {
    let p: Pair[I32, I32] = Pair { first: 10, second: 20 }
    assert_eq(p.first, 10, "pair first should be 10")
    assert_eq(p.second, 20, "pair second should be 20")
    return 0
}

@test
func test_generic_pair_i32_bool() -> I32 {
    let p: Pair[I32, Bool] = Pair { first: 42, second: true }
    assert_eq(p.first, 42, "pair first should be 42")
    assert(p.second, "pair second should be true")
    return 0
}

// =============================================================================
// Generic function with Maybe
// =============================================================================

func or_else[T](m: Maybe[T], default_val: T) -> T {
    when m {
        Just(v) => return v,
        Nothing => return default_val
    }
}

@test
func test_generic_or_else_just() -> I32 {
    let m: Maybe[I32] = Just(99)
    assert_eq(or_else(m, 0), 99, "or_else Just(99) should be 99")
    return 0
}

@test
func test_generic_or_else_nothing() -> I32 {
    let m: Maybe[I32] = Nothing
    assert_eq(or_else(m, -1), -1, "or_else Nothing should be -1")
    return 0
}
