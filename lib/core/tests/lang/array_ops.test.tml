// Tests for array operations - indexing, map, length, literals
use test

// =============================================================================
// Array literals and indexing
// =============================================================================

@test
func test_array_literal() -> I32 {
    let arr: [I32; 3] = [10, 20, 30]
    assert_eq(arr[0], 10, "arr[0] should be 10")
    assert_eq(arr[1], 20, "arr[1] should be 20")
    assert_eq(arr[2], 30, "arr[2] should be 30")
    return 0
}

@test
func test_array_single_element() -> I32 {
    let arr: [I32; 1] = [42]
    assert_eq(arr[0], 42, "single element array")
    return 0
}

@test
func test_array_five_elements() -> I32 {
    let arr: [I32; 5] = [1, 2, 3, 4, 5]
    let sum: I32 = arr[0] + arr[1] + arr[2] + arr[3] + arr[4]
    assert_eq(sum, 15, "sum of [1,2,3,4,5] should be 15")
    return 0
}

// =============================================================================
// Array map
// =============================================================================

@test
func test_array_map_double() -> I32 {
    let arr: [I32; 3] = [1, 2, 3]
    let doubled: [I32; 3] = arr.map(do(x: I32) -> I32 { x * 2 })
    assert_eq(doubled[0], 2, "doubled[0] should be 2")
    assert_eq(doubled[1], 4, "doubled[1] should be 4")
    assert_eq(doubled[2], 6, "doubled[2] should be 6")
    return 0
}

@test
func test_array_map_negate() -> I32 {
    let arr: [I32; 3] = [10, 20, 30]
    let negated: [I32; 3] = arr.map(do(x: I32) -> I32 { 0 - x })
    assert_eq(negated[0], -10, "negated[0] should be -10")
    assert_eq(negated[1], -20, "negated[1] should be -20")
    assert_eq(negated[2], -30, "negated[2] should be -30")
    return 0
}

// =============================================================================
// Array as function parameter
// =============================================================================

func sum_array(arr: [I32; 4]) -> I32 {
    return arr[0] + arr[1] + arr[2] + arr[3]
}

@test
func test_array_as_param() -> I32 {
    let arr: [I32; 4] = [10, 20, 30, 40]
    assert_eq(sum_array(arr), 100, "sum should be 100")
    return 0
}

func max_of_three(arr: [I32; 3]) -> I32 {
    var result: I32 = arr[0]
    if arr[1] > result {
        result = arr[1]
    }
    if arr[2] > result {
        result = arr[2]
    }
    return result
}

@test
func test_array_max() -> I32 {
    assert_eq(max_of_three([3, 7, 2]), 7, "max of [3,7,2] should be 7")
    assert_eq(max_of_three([10, 5, 8]), 10, "max of [10,5,8] should be 10")
    assert_eq(max_of_three([1, 2, 9]), 9, "max of [1,2,9] should be 9")
    return 0
}

// =============================================================================
// Array with loop
// =============================================================================

@test
func test_array_sum_with_loop() -> I32 {
    let arr: [I32; 5] = [2, 4, 6, 8, 10]
    var sum: I32 = 0
    for i in 0 to 5 {
        sum = sum + arr[i]
    }
    assert_eq(sum, 30, "sum of [2,4,6,8,10] should be 30")
    return 0
}
