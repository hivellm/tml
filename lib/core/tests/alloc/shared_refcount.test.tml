// Tests for Shared[T] â€” duplicate, try_unwrap, get_mut, get
use test::{assert, assert_eq}
use core::alloc::shared::Shared

@test
func test_shared_get() -> I32 {
    let s: Shared[I32] = Shared::new(42)
    let v: I32 = s.get()
    assert_eq(v, 42, "Shared::get should return 42")
    0
}

@test
func test_shared_duplicate_increments_count() -> I32 {
    let s: Shared[I32] = Shared::new(10)
    assert_eq(s.strong_count(), 1, "initial count = 1")
    let s2: Shared[I32] = s.duplicate()
    assert_eq(s.strong_count(), 2, "after duplicate count = 2")
    assert_eq(s2.get(), 10, "duplicate has same value")
    0
}

@test
func test_shared_try_unwrap_unique() -> I32 {
    var s: Shared[I32] = Shared::new(99)
    assert(s.is_unique(), "should be unique before unwrap")
    let result: Maybe[I32] = s.try_unwrap()
    assert(result.is_just(), "try_unwrap on unique should return Just")
    assert_eq(result.unwrap(), 99, "unwrapped value should be 99")
    0
}
