use test
use core::ringbuf::RingBuf

@test
func test_ringbuf_front_back() -> I32 {
    var rb: RingBuf = RingBuf::new(4)
    rb.push_back(10)
    rb.push_back(20)
    rb.push_back(30)
    assert_eq(rb.front().unwrap(), 10)
    assert_eq(rb.back().unwrap(), 30)
    return 0
}

@test
func test_ringbuf_push_front() -> I32 {
    var rb: RingBuf = RingBuf::new(4)
    assert(rb.push_front(30))
    assert(rb.push_front(20))
    assert(rb.push_front(10))
    assert_eq(rb.front().unwrap(), 10)
    assert_eq(rb.back().unwrap(), 30)
    assert_eq(rb.len(), 3)
    return 0
}

@test
func test_ringbuf_pop_back() -> I32 {
    var rb: RingBuf = RingBuf::new(4)
    rb.push_back(1)
    rb.push_back(2)
    rb.push_back(3)
    assert_eq(rb.pop_back().unwrap(), 3)
    assert_eq(rb.pop_back().unwrap(), 2)
    assert_eq(rb.pop_back().unwrap(), 1)
    assert(rb.is_empty())
    return 0
}

@test
func test_ringbuf_wraparound() -> I32 {
    var rb: RingBuf = RingBuf::new(3)
    rb.push_back(1)
    rb.push_back(2)
    rb.push_back(3)
    // Now full: [1, 2, 3], head=0
    rb.pop_front()  // Remove 1, head=1
    rb.pop_front()  // Remove 2, head=2
    // Now [_, _, 3], head=2, len=1
    rb.push_back(4)  // Wraps to index 0
    rb.push_back(5)  // Wraps to index 1
    // Now [4, 5, 3], head=2, len=3
    assert_eq(rb.pop_front().unwrap(), 3)
    assert_eq(rb.pop_front().unwrap(), 4)
    assert_eq(rb.pop_front().unwrap(), 5)
    return 0
}

@test
func test_ringbuf_get() -> I32 {
    var rb: RingBuf = RingBuf::new(4)
    rb.push_back(10)
    rb.push_back(20)
    rb.push_back(30)
    assert_eq(rb.get(0).unwrap(), 10)
    assert_eq(rb.get(1).unwrap(), 20)
    assert_eq(rb.get(2).unwrap(), 30)
    assert(rb.get(3).is_nothing())
    assert(rb.get(-1).is_nothing())
    return 0
}
