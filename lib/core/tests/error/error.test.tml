// Tests for core::error module
// Tests IoErrorKind enum Display

use test
use core::error::{IoErrorKind, IoError, SimpleError, ParseError}

// =============================================================================
// IoErrorKind Tests - These work because IoErrorKind has explicit Display impl
// =============================================================================

@test
func test_io_error_kind_not_found() -> I32 {
    let kind: IoErrorKind = IoErrorKind::NotFound
    let s: Str = kind.to_string()
    assert_eq(s, "entity not found", "NotFound string repr")
    return 0
}

@test
func test_io_error_kind_permission_denied() -> I32 {
    let kind: IoErrorKind = IoErrorKind::PermissionDenied
    let s: Str = kind.to_string()
    assert_eq(s, "permission denied", "PermissionDenied string repr")
    return 0
}

@test
func test_io_error_kind_connection_refused() -> I32 {
    let kind: IoErrorKind = IoErrorKind::ConnectionRefused
    let s: Str = kind.to_string()
    assert_eq(s, "connection refused", "ConnectionRefused string repr")
    return 0
}

@test
func test_io_error_kind_timed_out() -> I32 {
    let kind: IoErrorKind = IoErrorKind::TimedOut
    let s: Str = kind.to_string()
    assert_eq(s, "operation timed out", "TimedOut string repr")
    return 0
}

@test
func test_io_error_kind_other() -> I32 {
    let kind: IoErrorKind = IoErrorKind::Other
    let s: Str = kind.to_string()
    assert_eq(s, "other error", "Other string repr")
    return 0
}

@test
func test_io_error_kind_debug() -> I32 {
    let kind: IoErrorKind = IoErrorKind::NotFound
    let debug: Str = kind.debug_string()
    assert_eq(debug, "NotFound", "Debug should return variant name")
    return 0
}

@test
func test_io_error_kind_broken_pipe() -> I32 {
    let kind: IoErrorKind = IoErrorKind::BrokenPipe
    let s: Str = kind.to_string()
    assert_eq(s, "broken pipe", "BrokenPipe string repr")
    return 0
}

@test
func test_io_error_kind_already_exists() -> I32 {
    let kind: IoErrorKind = IoErrorKind::AlreadyExists
    let s: Str = kind.to_string()
    assert_eq(s, "entity already exists", "AlreadyExists string repr")
    return 0
}

// =============================================================================
// SimpleError Tests
// =============================================================================

@test
func test_simple_error_display() -> I32 {
    let err: SimpleError = SimpleError::new("test message")
    let s: Str = err.to_string()
    assert_eq(s, "test message", "SimpleError to_string")
    return 0
}

@test
func test_simple_error_debug() -> I32 {
    let err: SimpleError = SimpleError::new("oops")
    let s: Str = err.debug_string()
    assert_eq(s, "SimpleError(\"oops\")", "SimpleError debug_string")
    return 0
}

// =============================================================================
// ParseError Tests
// =============================================================================

@test
func test_parse_error_display() -> I32 {
    let err: ParseError = ParseError::new("unexpected token")
    let s: Str = err.to_string()
    assert_eq(s, "parse error: unexpected token", "ParseError to_string")
    return 0
}

@test
func test_parse_error_with_position() -> I32 {
    let err: ParseError = ParseError::with_position("expected '}'", 42)
    let s: Str = err.to_string()
    assert_eq(s, "parse error at position 42: expected '}'", "ParseError with position")
    return 0
}

@test
func test_parse_error_debug() -> I32 {
    let err: ParseError = ParseError::new("syntax error")
    let s: Str = err.debug_string()
    assert_eq(s, "ParseError { message: \"syntax error\", position: Nothing }", "ParseError debug")
    return 0
}

// =============================================================================
// IoError Tests
// =============================================================================

@test
func test_io_error_display() -> I32 {
    let err: IoError = IoError::new(IoErrorKind::PermissionDenied)
    let s: Str = err.to_string()
    assert_eq(s, "permission denied", "IoError to_string")
    return 0
}

@test
func test_io_error_with_message() -> I32 {
    let err: IoError = IoError::with_message(IoErrorKind::NotFound, "config.json")
    let s: Str = err.to_string()
    assert_eq(s, "entity not found: config.json", "IoError with message")
    return 0
}

@test
func test_io_error_kind_method() -> I32 {
    let err: IoError = IoError::new(IoErrorKind::TimedOut)
    let kind: IoErrorKind = err.kind()
    let s: Str = kind.to_string()
    assert_eq(s, "operation timed out", "IoError kind method")
    return 0
}
