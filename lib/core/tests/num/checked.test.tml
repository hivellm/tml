// Tests for checked arithmetic intrinsics
use test
use core::intrinsics::{checked_add, checked_sub, checked_mul, checked_div}

// ============================================================================
// checked_add - normal cases
// ============================================================================

@test
func test_checked_add_i32_normal() -> I32 {
    when checked_add[I32](10, 20) {
        Just(n) => assert_eq(n, 30, "10 + 20 = 30"),
        Nothing => panic("should not overflow")
    }
    return 0
}

@test
func test_checked_add_i32_zero() -> I32 {
    when checked_add[I32](42, 0) {
        Just(n) => assert_eq(n, 42, "42 + 0 = 42"),
        Nothing => panic("should not overflow")
    }
    return 0
}

@test
func test_checked_add_i32_negative() -> I32 {
    when checked_add[I32](-10, -20) {
        Just(n) => assert_eq(n, -30, "-10 + -20 = -30"),
        Nothing => panic("should not overflow")
    }
    return 0
}

// ============================================================================
// checked_add - overflow cases
// ============================================================================

@test
func test_checked_add_i32_overflow() -> I32 {
    when checked_add[I32](2147483647, 1) {
        Just(_) => panic("should overflow"),
        Nothing => {}
    }
    return 0
}

@test
func test_checked_add_i32_underflow() -> I32 {
    when checked_add[I32](-2147483648, -1) {
        Just(_) => panic("should underflow"),
        Nothing => {}
    }
    return 0
}

// ============================================================================
// checked_sub
// ============================================================================

@test
func test_checked_sub_i32_normal() -> I32 {
    when checked_sub[I32](30, 10) {
        Just(n) => assert_eq(n, 20, "30 - 10 = 20"),
        Nothing => panic("should not overflow")
    }
    return 0
}

@test
func test_checked_sub_i32_overflow() -> I32 {
    when checked_sub[I32](-2147483648, 1) {
        Just(_) => panic("should underflow"),
        Nothing => {}
    }
    return 0
}

// ============================================================================
// checked_mul
// ============================================================================

@test
func test_checked_mul_i32_normal() -> I32 {
    when checked_mul[I32](6, 7) {
        Just(n) => assert_eq(n, 42, "6 * 7 = 42"),
        Nothing => panic("should not overflow")
    }
    return 0
}

@test
func test_checked_mul_i32_overflow() -> I32 {
    when checked_mul[I32](2147483647, 2) {
        Just(_) => panic("should overflow"),
        Nothing => {}
    }
    return 0
}

@test
func test_checked_mul_i32_zero() -> I32 {
    when checked_mul[I32](999999, 0) {
        Just(n) => assert_eq(n, 0, "anything * 0 = 0"),
        Nothing => panic("should not overflow")
    }
    return 0
}

// ============================================================================
// checked_div
// ============================================================================

@test
func test_checked_div_i32_normal() -> I32 {
    when checked_div[I32](42, 6) {
        Just(n) => assert_eq(n, 7, "42 / 6 = 7"),
        Nothing => panic("should not fail")
    }
    return 0
}

@test
func test_checked_div_i32_by_zero() -> I32 {
    when checked_div[I32](42, 0) {
        Just(_) => panic("should fail on div by zero"),
        Nothing => {}
    }
    return 0
}
