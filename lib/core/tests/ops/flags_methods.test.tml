// @flags enum method tests: .has(), .add(), .remove(), .toggle(), .is_empty()
// Static methods: ::none(), ::all(), ::from_bits()
use test

@flags
type FileMode {
    Read,
    Write,
    Execute,
}

@test
func test_flags_has() -> I32 {
    let rw = FileMode::Read | FileMode::Write
    assert(rw.has(FileMode::Read), "rw should have Read")
    assert(rw.has(FileMode::Write), "rw should have Write")
    assert(not rw.has(FileMode::Execute), "rw should not have Execute")
    return 0
}

@test
func test_flags_is_empty() -> I32 {
    let empty = FileMode::none()
    assert(empty.is_empty(), "none() should be empty")
    let r = FileMode::Read
    assert(not r.is_empty(), "Read should not be empty")
    return 0
}

@test
func test_flags_add() -> I32 {
    let r = FileMode::Read
    let rw = r.add(FileMode::Write)
    assert(rw.has(FileMode::Read), "rw should have Read")
    assert(rw.has(FileMode::Write), "rw should have Write")
    assert_eq(rw.bits(), 3, "Read | Write bits should be 3")
    return 0
}

@test
func test_flags_remove() -> I32 {
    let rw = FileMode::Read | FileMode::Write
    let r = rw.remove(FileMode::Write)
    assert(r.has(FileMode::Read), "r should have Read")
    assert(not r.has(FileMode::Write), "r should not have Write")
    assert_eq(r.bits(), 1, "Read-only bits should be 1")
    return 0
}

@test
func test_flags_toggle() -> I32 {
    let r = FileMode::Read
    let rw = r.toggle(FileMode::Write)
    assert(rw.has(FileMode::Write), "after toggle, should have Write")
    let r2 = rw.toggle(FileMode::Write)
    assert(not r2.has(FileMode::Write), "after second toggle, should not have Write")
    return 0
}

@test
func test_flags_none() -> I32 {
    let n = FileMode::none()
    assert(n.is_empty(), "none() should be empty")
    assert_eq(n.bits(), 0, "none() bits should be 0")
    return 0
}

@test
func test_flags_all() -> I32 {
    let all = FileMode::all()
    assert(all.has(FileMode::Read), "all() should have Read")
    assert(all.has(FileMode::Write), "all() should have Write")
    assert(all.has(FileMode::Execute), "all() should have Execute")
    assert_eq(all.bits(), 7, "all() bits should be 7")
    return 0
}

@test
func test_flags_from_bits() -> I32 {
    let rw = FileMode::from_bits(3)
    assert(rw.has(FileMode::Read), "from_bits(3) should have Read")
    assert(rw.has(FileMode::Write), "from_bits(3) should have Write")
    assert(not rw.has(FileMode::Execute), "from_bits(3) should not have Execute")
    return 0
}
