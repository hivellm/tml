// Tests targeting specific uncovered functions to reach 75% coverage
use test::{assert_eq, assert}
use core::alloc::{Layout, handle_alloc_error}
use core::char::convert::TryFromCharError
use core::error::Error

// ============================================================================
// handle_alloc_error (alloc/global) — 1 function
// ============================================================================

@test
func test_handle_alloc_error() -> I32 {
    let layout = Layout::from_size_align_unchecked(64, 8)
    handle_alloc_error(layout)
    assert(true, "handle_alloc_error runs without crash")
    return 0
}

// ============================================================================
// TryFromCharError::description (char/convert) — 1 function
// ============================================================================

@test
func test_try_from_char_error_description() -> I32 {
    let err = TryFromCharError { value: 'x' }
    let desc: Str = err.description()
    assert_eq(desc, "char value too large", "TryFromCharError::description")
    return 0
}

// ============================================================================
// Bit assign ops — covering 7+ uncovered functions (ops/bit)
// I16::bitand_assign, U8::bitand_assign, U16::bitand_assign, U64::bitand_assign
// I8::bitor_assign, I64::bitor_assign, U8::bitor_assign
// ============================================================================

@test
func test_bitand_assign_i16() -> I32 {
    let mut a: I16 = 0xFF
    a &= 0x0F
    assert_eq(a as I64, 15, "I16 bitand_assign")
    return 0
}

@test
func test_bitand_assign_u8() -> I32 {
    let mut a: U8 = 0xFF
    a &= 0x0F
    assert_eq(a as I64, 15, "U8 bitand_assign")
    return 0
}

@test
func test_bitand_assign_u16() -> I32 {
    let mut a: U16 = 0xFF
    a &= 0x0F
    assert_eq(a as I64, 15, "U16 bitand_assign")
    return 0
}

@test
func test_bitand_assign_u64() -> I32 {
    let mut a: U64 = 0xFF
    a &= 0x0F
    assert_eq(a as I64, 15, "U64 bitand_assign")
    return 0
}

@test
func test_bitor_assign_i8() -> I32 {
    let mut a: I8 = 0x01
    a |= 0x10
    assert_eq(a as I64, 17, "I8 bitor_assign")
    return 0
}

@test
func test_bitor_assign_i64() -> I32 {
    let mut a: I64 = 0x01
    a |= 0x10
    assert_eq(a, 17, "I64 bitor_assign")
    return 0
}

@test
func test_bitor_assign_u8() -> I32 {
    let mut a: U8 = 0x01
    a |= 0x10
    assert_eq(a as I64, 17, "U8 bitor_assign")
    return 0
}
