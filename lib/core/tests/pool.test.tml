// Consolidated tests for core::pool (14 tests)
use test
use core::pool::{Pool, GrowthPolicy, PoolStats}

// ============================================================================
// GrowthPolicy Tests (from pool.test.tml)
// ============================================================================

@test
func test_growth_policy_fixed_next_capacity() -> I32 {
    let policy: GrowthPolicy = GrowthPolicy::Fixed
    assert(policy.next_capacity(10) == 10, "Fixed policy should not change capacity")
    assert(policy.next_capacity(100) == 100, "Fixed policy should not change capacity")
    return 0
}

@test
func test_growth_policy_doubling_next_capacity() -> I32 {
    let policy: GrowthPolicy = GrowthPolicy::Doubling
    assert(policy.next_capacity(10) == 20, "Doubling should double capacity")
    assert(policy.next_capacity(16) == 32, "Doubling should double capacity")
    assert(policy.next_capacity(1) == 2, "Doubling should double capacity")
    return 0
}

@test
func test_growth_policy_linear_next_capacity() -> I32 {
    let policy: GrowthPolicy = GrowthPolicy::Linear(5)
    assert(policy.next_capacity(10) == 15, "Linear(5) should add 5")
    assert(policy.next_capacity(100) == 105, "Linear(5) should add 5")

    let policy2: GrowthPolicy = GrowthPolicy::Linear(10)
    assert(policy2.next_capacity(0) == 10, "Linear(10) should add 10")
    return 0
}

@test
func test_growth_policy_can_grow() -> I32 {
    let fixed: GrowthPolicy = GrowthPolicy::Fixed
    let doubling: GrowthPolicy = GrowthPolicy::Doubling
    let linear: GrowthPolicy = GrowthPolicy::Linear(8)

    assert(fixed.can_grow() == false, "Fixed cannot grow")
    assert(doubling.can_grow() == true, "Doubling can grow")
    assert(linear.can_grow() == true, "Linear can grow")
    return 0
}

// ============================================================================
// PoolStats Tests (from pool.test.tml)
// ============================================================================

@test
func test_pool_stats_new() -> I32 {
    let stats: PoolStats = PoolStats::new()
    assert(stats.available == 0, "New stats should have 0 available")
    assert(stats.in_use == 0, "New stats should have 0 in_use")
    assert(stats.capacity == 0, "New stats should have 0 capacity")
    assert(stats.hits == 0, "New stats should have 0 hits")
    assert(stats.misses == 0, "New stats should have 0 misses")
    assert(stats.grows == 0, "New stats should have 0 grows")
    return 0
}

@test
func test_pool_stats_hit_rate_empty() -> I32 {
    let stats: PoolStats = PoolStats::new()
    // When no operations, hit rate should be 100%
    let rate: F64 = stats.hit_rate()
    assert(rate == 100.0, "Empty stats should have 100% hit rate")
    return 0
}

@test
func test_pool_stats_hit_rate_all_hits() -> I32 {
    var stats: PoolStats = PoolStats::new()
    stats.hits = 10
    stats.misses = 0
    let rate: F64 = stats.hit_rate()
    assert(rate == 100.0, "All hits should have 100% hit rate")
    return 0
}

@test
func test_pool_stats_hit_rate_all_misses() -> I32 {
    var stats: PoolStats = PoolStats::new()
    stats.hits = 0
    stats.misses = 10
    let rate: F64 = stats.hit_rate()
    assert(rate == 0.0, "All misses should have 0% hit rate")
    return 0
}

@test
func test_pool_stats_hit_rate_half() -> I32 {
    var stats: PoolStats = PoolStats::new()
    stats.hits = 5
    stats.misses = 5
    let rate: F64 = stats.hit_rate()
    assert(rate == 50.0, "Half hits should have 50% hit rate")
    return 0
}

// ============================================================================
// Pool Coverage Tests (from pool_coverage.test.tml)
// ============================================================================

@test
func test_pool_stats_new_coverage() -> I32 {
    let stats: PoolStats = PoolStats::new()
    assert_eq(stats.available, 0, "new stats available is 0")
    assert_eq(stats.in_use, 0, "new stats in_use is 0")
    assert_eq(stats.capacity, 0, "new stats capacity is 0")
    return 0
}

@test
func test_growth_policy_fixed() -> I32 {
    let p: GrowthPolicy = GrowthPolicy::Fixed
    assert(not p.can_grow(), "Fixed cannot grow")
    assert_eq(p.next_capacity(10), 10, "Fixed next_capacity is same")
    return 0
}

@test
func test_growth_policy_doubling() -> I32 {
    let p: GrowthPolicy = GrowthPolicy::Doubling
    assert(p.can_grow(), "Doubling can grow")
    assert_eq(p.next_capacity(10), 20, "Doubling doubles capacity")
    return 0
}

@test
func test_growth_policy_linear() -> I32 {
    let p: GrowthPolicy = GrowthPolicy::Linear(5)
    assert(p.can_grow(), "Linear can grow")
    assert_eq(p.next_capacity(10), 15, "Linear adds step")
    return 0
}

@test
func test_pool_stats_hit_rate_empty_coverage() -> I32 {
    let stats: PoolStats = PoolStats::new()
    let rate: F64 = stats.hit_rate()
    assert(rate > 99.0, "hit_rate of empty stats should be 100")
    return 0
}
