// Tests for core::array module - basic array operations
use test

// =============================================================================
// Basic array literal and indexing
// =============================================================================

@test
func test_array_literal() -> I32 {
    let arr: [I32; 3] = [10, 20, 30]
    assert(arr[0] == 10, "arr[0] should be 10")
    assert(arr[1] == 20, "arr[1] should be 20")
    assert(arr[2] == 30, "arr[2] should be 30")
    return 0
}

@test
func test_array_len() -> I32 {
    let arr: [I32; 5] = [1, 2, 3, 4, 5]
    assert(arr.len() == 5, "array len should be 5")
    return 0
}

@test
func test_array_is_empty_false() -> I32 {
    let arr: [I32; 3] = [1, 2, 3]
    assert(not arr.is_empty(), "non-empty array should not be empty")
    return 0
}

// =============================================================================
// get, first, last
// =============================================================================

@test
func test_array_get_valid() -> I32 {
    let arr: [I32; 3] = [10, 20, 30]
    let val: Maybe[ref I32] = arr.get(1)
    assert(val.is_just(), "get(1) should be Just")
    return 0
}

@test
func test_array_get_out_of_bounds() -> I32 {
    let arr: [I32; 3] = [10, 20, 30]
    let val: Maybe[ref I32] = arr.get(5)
    assert(val.is_nothing(), "get(5) should be Nothing for 3-elem array")
    return 0
}

@test
func test_array_get_negative() -> I32 {
    let arr: [I32; 3] = [10, 20, 30]
    let val: Maybe[ref I32] = arr.get(-1)
    assert(val.is_nothing(), "get(-1) should be Nothing")
    return 0
}

@test
func test_array_first() -> I32 {
    let arr: [I32; 3] = [10, 20, 30]
    let val: Maybe[ref I32] = arr.first()
    assert(val.is_just(), "first() should be Just for non-empty array")
    return 0
}

@test
func test_array_last() -> I32 {
    let arr: [I32; 3] = [10, 20, 30]
    let val: Maybe[ref I32] = arr.last()
    assert(val.is_just(), "last() should be Just for non-empty array")
    return 0
}

// =============================================================================
// Mutation via indexing
// =============================================================================

@test
func test_array_mut_index() -> I32 {
    let mut arr: [I32; 3] = [10, 20, 30]
    arr[1] = 99
    assert(arr[1] == 99, "arr[1] should be 99 after mutation")
    return 0
}

@test
func test_array_mut_multiple() -> I32 {
    let mut arr: [I32; 3] = [1, 2, 3]
    arr[0] = 100
    arr[2] = 300
    assert(arr[0] == 100, "arr[0] should be 100")
    assert(arr[1] == 2, "arr[1] should still be 2")
    assert(arr[2] == 300, "arr[2] should be 300")
    return 0
}

// =============================================================================
// map
// =============================================================================

@test
func test_array_map_double() -> I32 {
    let arr: [I32; 3] = [1, 2, 3]
    let doubled: [I32; 3] = arr.map(do(x: I32) -> I32 { return x * 2 })
    assert(doubled[0] == 2, "doubled[0] should be 2")
    assert(doubled[1] == 4, "doubled[1] should be 4")
    assert(doubled[2] == 6, "doubled[2] should be 6")
    return 0
}
