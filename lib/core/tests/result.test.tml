// Tests for core::result module (Outcome type)
use test

// ============================================================================
// Outcome::is_ok and is_err Tests
// ============================================================================

@test
func test_outcome_is_ok_true() -> I32 {
    let result: Outcome[I32, Str] = Ok(42)
    assert(result.is_ok(), "Ok should be is_ok")
    return 0
}

@test
func test_outcome_is_ok_false() -> I32 {
    let result: Outcome[I32, Str] = Err("error")
    assert(not result.is_ok(), "Err should not be is_ok")
    return 0
}

@test
func test_outcome_is_err_true() -> I32 {
    let result: Outcome[I32, Str] = Err("error")
    assert(result.is_err(), "Err should be is_err")
    return 0
}

@test
func test_outcome_is_err_false() -> I32 {
    let result: Outcome[I32, Str] = Ok(42)
    assert(not result.is_err(), "Ok should not be is_err")
    return 0
}

// ============================================================================
// Outcome::unwrap Tests
// ============================================================================

@test
func test_outcome_unwrap_ok() -> I32 {
    let result: Outcome[I32, Str] = Ok(123)
    let value: I32 = result.unwrap()
    assert(value == 123, "unwrap should return value")
    return 0
}

@test
func test_outcome_unwrap_or_ok() -> I32 {
    let result: Outcome[I32, Str] = Ok(42)
    let value: I32 = result.unwrap_or(0)
    assert(value == 42, "unwrap_or on Ok should return inner value")
    return 0
}

@test
func test_outcome_unwrap_or_err() -> I32 {
    let result: Outcome[I32, Str] = Err("failed")
    let value: I32 = result.unwrap_or(99)
    assert(value == 99, "unwrap_or on Err should return default")
    return 0
}

// ============================================================================
// Outcome::expect Tests
// ============================================================================

@test
func test_outcome_expect_ok() -> I32 {
    let result: Outcome[I32, Str] = Ok(777)
    let value: I32 = result.expect("should not fail")
    assert(value == 777, "expect on Ok should return value")
    return 0
}

// ============================================================================
// Outcome::unwrap_err Tests
// ============================================================================

@test
func test_outcome_unwrap_err() -> I32 {
    let result: Outcome[I32, Str] = Err("my error")
    let err: Str = result.unwrap_err()
    assert(err == "my error", "unwrap_err should return error")
    return 0
}

// ============================================================================
// Outcome::expect_err Tests
// ============================================================================

@test
func test_outcome_expect_err() -> I32 {
    let result: Outcome[I32, Str] = Err("expected error")
    let err: Str = result.expect_err("should be error")
    assert(err == "expected error", "expect_err should return error")
    return 0
}

// ============================================================================
// Outcome::is_ok_and / is_err_and Tests
// ============================================================================

@test
func test_outcome_is_ok_and_true() -> I32 {
    let result: Outcome[I32, Str] = Ok(10)
    let check: Bool = result.is_ok_and(do(x) x > 5)
    assert(check, "is_ok_and should return true when predicate matches")
    return 0
}

@test
func test_outcome_is_ok_and_false_predicate() -> I32 {
    let result: Outcome[I32, Str] = Ok(3)
    let check: Bool = result.is_ok_and(do(x) x > 5)
    assert(not check, "is_ok_and should return false when predicate fails")
    return 0
}

@test
func test_outcome_is_ok_and_on_err() -> I32 {
    let result: Outcome[I32, Str] = Err("nope")
    let check: Bool = result.is_ok_and(do(x) x > 0)
    assert(not check, "is_ok_and on Err should return false")
    return 0
}

@test
func test_outcome_is_err_and_true() -> I32 {
    let result: Outcome[I32, Str] = Err("error 404")
    let check: Bool = result.is_err_and(do(e) e == "error 404")
    assert(check, "is_err_and should return true when predicate matches")
    return 0
}

@test
func test_outcome_is_err_and_on_ok() -> I32 {
    let result: Outcome[I32, Str] = Ok(42)
    let check: Bool = result.is_err_and(do(e) e == "anything")
    assert(not check, "is_err_and on Ok should return false")
    return 0
}

// ============================================================================
// Outcome::unwrap_or_else Tests
// ============================================================================

@test
func test_outcome_unwrap_or_else_ok() -> I32 {
    let result: Outcome[I32, Str] = Ok(50)
    let value: I32 = result.unwrap_or_else(do(e) 0)
    assert(value == 50, "unwrap_or_else on Ok should return inner value")
    return 0
}

@test
func test_outcome_unwrap_or_else_err() -> I32 {
    let result: Outcome[I32, Str] = Err("fail")
    let value: I32 = result.unwrap_or_else(do(e) -1)
    assert(value == -1, "unwrap_or_else on Err should call closure")
    return 0
}
