//! Tests for F32x4 comparison, horizontal, and math operations.

use core::simd::f32x4::{F32x4, select}
use core::simd::mask::Mask4

@test func test_eq_ne() -> I32 {
    let a = F32x4::new(1.0 as F32, 2.0 as F32, 3.0 as F32, 4.0 as F32)
    let b = F32x4::new(1.0 as F32, 0.0 as F32, 3.0 as F32, 0.0 as F32)
    let m = a.eq(b)
    if not m.m0 { return 1 }
    if m.m1 { return 2 }
    if not m.m2 { return 3 }
    if m.m3 { return 4 }
    let n = a.ne(b)
    if n.m0 { return 5 }
    if not n.m1 { return 6 }
    return 0
}

@test func test_lt_gt() -> I32 {
    let a = F32x4::new(1.0 as F32, 5.0 as F32, 3.0 as F32, 3.0 as F32)
    let b = F32x4::new(2.0 as F32, 4.0 as F32, 3.0 as F32, 6.0 as F32)
    let lt = a.lt(b)
    if not lt.m0 { return 1 }   // 1 < 2
    if lt.m1 { return 2 }       // 5 not < 4
    if lt.m2 { return 3 }       // 3 not < 3
    if not lt.m3 { return 4 }   // 3 < 6
    let gt = a.gt(b)
    if gt.m0 { return 5 }       // 1 not > 2
    if not gt.m1 { return 6 }   // 5 > 4
    return 0
}

@test func test_sum() -> I32 {
    let v = F32x4::new(1.0 as F32, 2.0 as F32, 3.0 as F32, 4.0 as F32)
    let s = v.sum()
    if s != (10.0 as F32) { return 1 }
    return 0
}

@test func test_hmin_hmax() -> I32 {
    let v = F32x4::new(3.0 as F32, 1.0 as F32, 4.0 as F32, 2.0 as F32)
    if v.hmin() != (1.0 as F32) { return 1 }
    if v.hmax() != (4.0 as F32) { return 2 }
    return 0
}

@test func test_min_max() -> I32 {
    let a = F32x4::new(1.0 as F32, 5.0 as F32, 3.0 as F32, 7.0 as F32)
    let b = F32x4::new(4.0 as F32, 2.0 as F32, 6.0 as F32, 0.0 as F32)
    let lo = a.min(b)
    if lo.get(0) != (1.0 as F32) { return 1 }
    if lo.get(1) != (2.0 as F32) { return 2 }
    if lo.get(2) != (3.0 as F32) { return 3 }
    if lo.get(3) != (0.0 as F32) { return 4 }
    let hi = a.max(b)
    if hi.get(0) != (4.0 as F32) { return 5 }
    if hi.get(1) != (5.0 as F32) { return 6 }
    return 0
}

@test func test_abs() -> I32 {
    let v = F32x4::new((0.0 as F32) - (3.0 as F32), 2.0 as F32, (0.0 as F32) - (1.0 as F32), 0.0 as F32)
    let a = v.abs()
    if a.get(0) != (3.0 as F32) { return 1 }
    if a.get(1) != (2.0 as F32) { return 2 }
    if a.get(2) != (1.0 as F32) { return 3 }
    if a.get(3) != (0.0 as F32) { return 4 }
    return 0
}

@test func test_select() -> I32 {
    let mask = Mask4 { m0: true, m1: false, m2: true, m3: false }
    let a = F32x4::new(10.0 as F32, 20.0 as F32, 30.0 as F32, 40.0 as F32)
    let b = F32x4::new(1.0 as F32, 2.0 as F32, 3.0 as F32, 4.0 as F32)
    let r = select(mask, a, b)
    if r.get(0) != (10.0 as F32) { return 1 }
    if r.get(1) != (2.0 as F32) { return 2 }
    if r.get(2) != (30.0 as F32) { return 3 }
    if r.get(3) != (4.0 as F32) { return 4 }
    return 0
}
