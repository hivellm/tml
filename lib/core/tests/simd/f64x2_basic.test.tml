//! Tests for F64x2 basic operations.

use core::simd::f64x2::{F64x2, select}
use core::simd::mask::Mask2

@test func test_new_and_get() -> I32 {
    let v = F64x2::new(1.5, 2.5)
    if v.get(0) != 1.5 { return 1 }
    if v.get(1) != 2.5 { return 2 }
    return 0
}

@test func test_splat() -> I32 {
    let v = F64x2::splat(3.14)
    if v.get(0) != 3.14 { return 1 }
    if v.get(1) != 3.14 { return 2 }
    return 0
}

@test func test_zero() -> I32 {
    let v = F64x2::zero()
    if v.get(0) != 0.0 { return 1 }
    if v.get(1) != 0.0 { return 2 }
    return 0
}

@test func test_set() -> I32 {
    let v = F64x2::new(1.0, 2.0)
    let w = v.set(1, 99.0)
    if w.get(0) != 1.0 { return 1 }
    if w.get(1) != 99.0 { return 2 }
    return 0
}

@test func test_add_sub() -> I32 {
    let a = F64x2::new(10.0, 20.0)
    let b = F64x2::new(3.0, 7.0)
    let c = a.add(b)
    if c.get(0) != 13.0 { return 1 }
    if c.get(1) != 27.0 { return 2 }
    let d = a.sub(b)
    if d.get(0) != 7.0 { return 3 }
    if d.get(1) != 13.0 { return 4 }
    return 0
}

@test func test_mul_div() -> I32 {
    let a = F64x2::new(6.0, 15.0)
    let b = F64x2::new(3.0, 5.0)
    let c = a.mul(b)
    if c.get(0) != 18.0 { return 1 }
    if c.get(1) != 75.0 { return 2 }
    let d = a.div(b)
    if d.get(0) != 2.0 { return 3 }
    if d.get(1) != 3.0 { return 4 }
    return 0
}

@test func test_neg() -> I32 {
    let v = F64x2::new(5.0, 0.0 - 3.0)
    let n = v.neg()
    if n.get(0) != (0.0 - 5.0) { return 1 }
    if n.get(1) != 3.0 { return 2 }
    return 0
}

@test func test_eq_lt_gt() -> I32 {
    let a = F64x2::new(1.0, 5.0)
    let b = F64x2::new(1.0, 3.0)
    let m = a.eq(b)
    if not m.m0 { return 1 }
    if m.m1 { return 2 }
    let lt = a.lt(b)
    if lt.m0 { return 3 }
    if lt.m1 { return 4 }
    let gt = a.gt(b)
    if gt.m0 { return 5 }
    if not gt.m1 { return 6 }
    return 0
}

@test func test_sum_hmin_hmax() -> I32 {
    let v = F64x2::new(3.0, 7.0)
    if v.sum() != 10.0 { return 1 }
    if v.hmin() != 3.0 { return 2 }
    if v.hmax() != 7.0 { return 3 }
    return 0
}

@test func test_abs() -> I32 {
    let v = F64x2::new(0.0 - 4.5, 2.0)
    let a = v.abs()
    if a.get(0) != 4.5 { return 1 }
    if a.get(1) != 2.0 { return 2 }
    return 0
}

@test func test_min_max() -> I32 {
    let a = F64x2::new(1.0, 5.0)
    let b = F64x2::new(3.0, 2.0)
    let lo = a.min(b)
    if lo.get(0) != 1.0 { return 1 }
    if lo.get(1) != 2.0 { return 2 }
    let hi = a.max(b)
    if hi.get(0) != 3.0 { return 3 }
    if hi.get(1) != 5.0 { return 4 }
    return 0
}

@test func test_select() -> I32 {
    let mask = Mask2 { m0: false, m1: true }
    let a = F64x2::new(10.0, 20.0)
    let b = F64x2::new(1.0, 2.0)
    let r = select(mask, a, b)
    if r.get(0) != 1.0 { return 1 }
    if r.get(1) != 20.0 { return 2 }
    return 0
}
