// Tests for @derive(Serialize) macro
use test

// ============================================================================
// Simple Struct Tests
// ============================================================================

@derive(Serialize)
type SerPoint {
    x: I32,
    y: I32
}

@test
func test_serialize_point() -> I32 {
    let p: SerPoint = SerPoint { x: 10, y: 20 }
    let json: Str = p.to_json()
    // Expected: {"x": 10, "y": 20}
    assert(json.contains("\"x\":"), "Should contain field x")
    assert(json.contains("\"y\":"), "Should contain field y")
    assert(json.contains("10"), "Should contain value 10")
    assert(json.contains("20"), "Should contain value 20")
    assert(json.starts_with("{"), "Should start with {")
    assert(json.ends_with("}"), "Should end with }")
    return 0
}

// ============================================================================
// String Field Tests
// ============================================================================

@derive(Serialize)
type SerPerson {
    name: Str,
    age: I32
}

@test
func test_serialize_string_field() -> I32 {
    let p: SerPerson = SerPerson { name: "Alice", age: 30 }
    let json: Str = p.to_json()
    // String fields should be quoted in JSON
    assert(json.contains("\"name\":"), "Should contain field name")
    assert(json.contains("\"Alice\""), "Should contain quoted string value")
    assert(json.contains("30"), "Should contain age value")
    return 0
}

// ============================================================================
// Simple Enum Tests
// ============================================================================

@derive(Serialize)
type SerStatus = Active | Inactive | Pending

@test
func test_serialize_enum_active() -> I32 {
    let s: SerStatus = SerStatus::Active
    let json: Str = s.to_json()
    // Expected: {"variant": "Active"}
    assert(json.contains("\"variant\":"), "Should contain variant key")
    assert(json.contains("\"Active\""), "Should contain variant name Active")
    return 0
}

@test
func test_serialize_enum_inactive() -> I32 {
    let s: SerStatus = SerStatus::Inactive
    let json: Str = s.to_json()
    assert(json.contains("\"variant\":"), "Should contain variant key")
    assert(json.contains("\"Inactive\""), "Should contain variant name Inactive")
    return 0
}
