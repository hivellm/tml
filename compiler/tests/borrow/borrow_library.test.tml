// Tests for core::borrow module
// Tests Borrow, BorrowMut, ToOwned traits

use test
use core::borrow::{Borrow, BorrowMut, ToOwned}

// =============================================================================
// Borrow Trait Tests
// =============================================================================

@test
func test_borrow_i32() -> I32 {
    let x: I32 = 42
    let r: ref I32 = x.borrow()
    assert_eq(*r, 42, "borrow should return reference to value")
    return 0
}

@test
func test_borrow_str() -> I32 {
    let s: Str = Str::from("hello")
    let r: ref Str = s.borrow()
    // Dereference explicitly since method call on ref Str has codegen issue
    let derefed: Str = *r
    assert_eq(derefed.len(), 5, "borrowed str should have same length")
    return 0
}

@test
func test_borrow_bool() -> I32 {
    let b: Bool = true
    let r: ref Bool = b.borrow()
    assert_eq(*r, true, "borrow bool should work")
    return 0
}

@test
func test_borrow_i64() -> I32 {
    let x: I64 = 9876543210
    let r: ref I64 = x.borrow()
    assert_eq(*r, 9876543210, "borrow I64 should work")
    return 0
}

// =============================================================================
// BorrowMut Trait Tests
// =============================================================================

@test
func test_borrow_mut_i32() -> I32 {
    let mut x: I32 = 42
    let r: mut ref I32 = x.borrow_mut()
    *r = 100
    assert_eq(x, 100, "borrow_mut should allow mutation")
    return 0
}

@test
func test_borrow_mut_i64() -> I32 {
    let mut x: I64 = 100
    let r: mut ref I64 = x.borrow_mut()
    *r = 200
    assert_eq(x, 200, "borrow_mut I64 should work")
    return 0
}

// =============================================================================
// ToOwned Trait Tests
// =============================================================================

@test
func test_to_owned_i32() -> I32 {
    let x: I32 = 42
    let owned: I32 = x.to_owned()
    assert_eq(owned, 42, "to_owned should copy I32")
    return 0
}

@test
func test_to_owned_i64() -> I32 {
    let x: I64 = 123456789
    let owned: I64 = x.to_owned()
    assert_eq(owned, 123456789, "to_owned should copy I64")
    return 0
}

@test
func test_to_owned_f64() -> I32 {
    let x: F64 = 3.14159
    let owned: F64 = x.to_owned()
    assert(owned > 3.14 and owned < 3.15, "to_owned should copy F64")
    return 0
}

@test
func test_to_owned_bool() -> I32 {
    let x: Bool = true
    let owned: Bool = x.to_owned()
    assert_eq(owned, true, "to_owned should copy Bool")
    return 0
}

@test
func test_to_owned_str() -> I32 {
    let s: Str = Str::from("hello world")
    let owned: Str = s.to_owned()
    assert_eq(owned.len(), 11, "to_owned should duplicate Str")
    return 0
}

@test
func test_to_owned_i8() -> I32 {
    let x: I8 = 127
    let owned: I8 = x.to_owned()
    assert_eq(owned, 127, "to_owned should copy I8")
    return 0
}

@test
func test_to_owned_u32() -> I32 {
    // Use value < 2^31 to avoid signed/unsigned comparison issues
    let x: U32 = 2000000000
    let owned: U32 = x.to_owned()
    assert_eq(owned, 2000000000, "to_owned should copy U32")
    return 0
}

// Note: Cow and Maybe/Outcome ToOwned tests removed due to associated type codegen issues
