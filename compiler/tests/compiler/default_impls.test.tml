// Test default implementations in behaviors
// Tests that impl blocks can inherit default methods from behaviors

use test

// Test behavior with default implementation
behavior Describable {
    func describe(this) -> I32

    // Default implementation - calls describe and adds 1
    func describe_plus_one(this) -> I32 {
        return this.describe() + 1
    }
}

type Counter {
    value: I32,
}

impl Describable for Counter {
    // Only implement describe, use default for describe_plus_one
    func describe(this) -> I32 {
        return this.value
    }
}

// Test behavior with multiple default implementations
behavior Stringifiable {
    func as_number(this) -> I32

    func double_it(this) -> I32 {
        return this.as_number() * 2
    }

    func triple_it(this) -> I32 {
        return this.as_number() * 3
    }
}

type Amount {
    num: I32,
}

impl Stringifiable for Amount {
    // Only implement as_number, use defaults for double_it and triple_it
    func as_number(this) -> I32 {
        return this.num
    }
}

// Test overriding a default implementation
type SpecialAmount {
    num: I32,
}

impl Stringifiable for SpecialAmount {
    func as_number(this) -> I32 {
        return this.num
    }

    // Override the default implementation
    func double_it(this) -> I32 {
        return this.num * 4  // Not actually doubling!
    }
    // triple_it uses default
}

@test
func test_describe_plus_one() {
    let c: Counter = Counter { value: 10 }
    let result: I32 = c.describe_plus_one()
    assert_eq(result, 11, "describe_plus_one should return 11")
}

@test
func test_describe() {
    let c: Counter = Counter { value: 10 }
    let val: I32 = c.describe()
    assert_eq(val, 10, "describe should return 10")
}

@test
func test_double_it_default() {
    let a: Amount = Amount { num: 5 }
    let doubled: I32 = a.double_it()
    assert_eq(doubled, 10, "double_it should return 10")
}

@test
func test_triple_it_default() {
    let a: Amount = Amount { num: 5 }
    let tripled: I32 = a.triple_it()
    assert_eq(tripled, 15, "triple_it should return 15")
}

@test
func test_override_double_it() {
    let s: SpecialAmount = SpecialAmount { num: 10 }
    let s_doubled: I32 = s.double_it()
    assert_eq(s_doubled, 40, "overridden double_it should return 40")
}

@test
func test_default_triple_it_on_special() {
    let s: SpecialAmount = SpecialAmount { num: 10 }
    let s_tripled: I32 = s.triple_it()
    assert_eq(s_tripled, 30, "default triple_it should return 30")
}
