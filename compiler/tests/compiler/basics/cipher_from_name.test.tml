// Test: cipher.tml from_name pattern with when syntax
// This tests the idiomatic way to write CipherAlgorithm::from_name

use test

type CipherAlgorithm {
    Aes128Cbc,
    Aes256Cbc,
    Aes128Gcm,
    Aes256Gcm,
    ChaCha20Poly1305,
    Unknown,
}

// This is the idiomatic way to write from_name using when
func from_name(name: Str) -> CipherAlgorithm {
    when name {
        "aes-128-cbc" => CipherAlgorithm::Aes128Cbc,
        "aes-256-cbc" => CipherAlgorithm::Aes256Cbc,
        "aes-128-gcm" => CipherAlgorithm::Aes128Gcm,
        "aes-256-gcm" => CipherAlgorithm::Aes256Gcm,
        "chacha20-poly1305" => CipherAlgorithm::ChaCha20Poly1305,
        _ => CipherAlgorithm::Unknown
    }
}

// Helper to check if algorithm matches expected variant
func is_aes128_cbc(algo: CipherAlgorithm) -> Bool {
    when algo {
        CipherAlgorithm::Aes128Cbc => true,
        _ => false
    }
}

func is_aes256_gcm(algo: CipherAlgorithm) -> Bool {
    when algo {
        CipherAlgorithm::Aes256Gcm => true,
        _ => false
    }
}

func is_chacha(algo: CipherAlgorithm) -> Bool {
    when algo {
        CipherAlgorithm::ChaCha20Poly1305 => true,
        _ => false
    }
}

func is_unknown(algo: CipherAlgorithm) -> Bool {
    when algo {
        CipherAlgorithm::Unknown => true,
        _ => false
    }
}

@test
func test_from_name_aes128_cbc() -> I32 {
    let algo: CipherAlgorithm = from_name("aes-128-cbc")
    assert_true(is_aes128_cbc(algo), "aes-128-cbc should parse to Aes128Cbc")
    return 0
}

@test
func test_from_name_aes256_gcm() -> I32 {
    let algo: CipherAlgorithm = from_name("aes-256-gcm")
    assert_true(is_aes256_gcm(algo), "aes-256-gcm should parse to Aes256Gcm")
    return 0
}

@test
func test_from_name_chacha() -> I32 {
    let algo: CipherAlgorithm = from_name("chacha20-poly1305")
    assert_true(is_chacha(algo), "chacha20-poly1305 should parse to ChaCha20Poly1305")
    return 0
}

@test
func test_from_name_unknown() -> I32 {
    let algo: CipherAlgorithm = from_name("invalid-algo")
    assert_true(is_unknown(algo), "invalid-algo should parse to Unknown")
    return 0
}

@test
func test_from_name_empty() -> I32 {
    let algo: CipherAlgorithm = from_name("")
    assert_true(is_unknown(algo), "empty string should parse to Unknown")
    return 0
}
