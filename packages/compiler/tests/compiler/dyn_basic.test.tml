// Test with full dyn dispatch
use test

behavior Describable {
    func get_value(this) -> I32
}

type Counter {
    value: I32,
}

impl Describable for Counter {
    func get_value(this) -> I32 {
        return this.value
    }
}

@test
func test_impl_method() -> I32 {
    let c: Counter = Counter { value: 123 }
    let result: I32 = c.get_value()
    assert_eq(result, 123, "get_value should return this.value")
    return 0
}

@test
func test_dyn_coercion() -> I32 {
    let c: Counter = Counter { value: 456 }
    // Upcast to dyn type
    let d: dyn Describable = c
    // Call method through vtable
    let result: I32 = d.get_value()
    assert_eq(result, 456, "dyn dispatch should work")
    return 0
}

func main() -> I32 {
    return 0
}