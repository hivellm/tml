# TML Compiler Test Suite

All tests use the `@test` decorator and `*.test.tml` naming convention.

## Test Files (7 total)

‚úÖ **Core Test Suites**:
- `basics.test.tml` - Arithmetic, variables, conditionals (3 tests)
- `closures.test.tml` - Closures and function types (4 tests)
- `structs.test.tml` - Struct types and methods
- `enums.test.tml` - Enum declarations and pattern matching
- `collections.test.tml` - Lists, HashMaps, Buffers
- `features.test.tml` - Bitwise ops, method syntax (2 tests)
- `patterns.test.tml` - Pattern matching (3 tests)

**Down from 60+ files to 7 organized suites!**

## Test Format

Tests use `@test` decorator - **no main() needed**:

```tml
@test
func arithmetic() -> I32 {
    println("Testing arithmetic...")

    let result: I32 = 2 + 2
    if result != 4 {
        println("FAIL")
        return 1  // Non-zero = failure
    }

    println("OK")
    return 0  // Zero = success
}

@test
func variables() -> I32 {
    // ... another test
    return 0
}

// No main() function needed - auto-generated by compiler!
```

## Running Tests

```bash
# Run all tests in a file
cd packages/compiler/build
./Debug/tml.exe run ../tests/tml/basics.test.tml

# Build test executable
./Debug/tml.exe build ../tests/tml/closures.test.tml

# Type check only
./Debug/tml.exe check ../tests/tml/enums.test.tml

# Run all tests
for file in ../tests/tml/*.test.tml; do ./Debug/tml.exe run "$file"; done
```

## How @test Works

1. Compiler detects functions decorated with `@test`
2. Auto-generates `main()` that:
   - Calls each test function in order
   - Stops on first failure
   - Returns the error code from failed test
3. No manual test orchestration needed!

Generated LLVM IR:
```llvm
define i32 @main(i32 %argc, ptr %argv) {
entry:
  %r1 = call i32 @tml_arithmetic()
  %fail1 = icmp ne i32 %r1, 0
  br i1 %fail1, label %test_fail_0, label %test_next_0

test_fail_0:
  ret i32 %r1  ; Return error code

test_next_0:
  %r2 = call i32 @tml_variables()
  ; ... more tests
  ret i32 0  ; All tests passed
}
```

## Test Status

### ‚úÖ Fully Working
- @test decorator (fully implemented!)
- Basic language features
- Structs and enums
- Closures without capture
- Collections (List, HashMap)
- Bitwise operations
- Pattern matching types

### üöß Partial Support
- Closures with environment capture
- Where clause enforcement
- Advanced pattern matching

### ‚è≥ Future Features
- Assertion macros (`assert_eq!`, `assert!`)
- Benchmarking (`@bench`)
- Test filtering
- Parallel test execution
