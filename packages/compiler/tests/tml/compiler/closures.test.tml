// Closure Tests

@test
func closure_no_capture() -> I32 {
    println("--- Closure Without Capture ---")

    let f: func(I32) -> I32 = do(n: I32) -> I32 { n }
    let result: I32 = f(5)

    if result != 5 {
        println("FAIL: Expected 5")
        return 1
    }

    println("OK")
    return 0
}

@test
func closure_identity() -> I32 {
    println("--- Closure Identity ---")

    let identity: func(I32) -> I32 = do(x: I32) -> I32 { x }
    let val: I32 = identity(42)

    if val != 42 {
        println("FAIL: Expected 42")
        return 1
    }

    println("OK")
    return 0
}

@test
func closure_arithmetic() -> I32 {
    println("--- Closure Arithmetic ---")

    let double: func(I32) -> I32 = do(x: I32) -> I32 { x + x }
    let result: I32 = double(10)

    if result != 20 {
        println("FAIL: Expected 20")
        return 1
    }

    println("OK")
    return 0
}

func apply_func(f: func(I32) -> I32, val: I32) -> I32 {
    f(val)
}

@test
func function_as_parameter() -> I32 {
    println("--- Function as Parameter ---")

    let increment: func(I32) -> I32 = do(x: I32) -> I32 { x + 1 }
    let result: I32 = apply_func(increment, 9)

    if result != 10 {
        println("FAIL: Expected 10")
        return 1
    }

    println("OK")
    return 0
}
