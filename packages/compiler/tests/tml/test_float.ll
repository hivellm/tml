; Generated by TML Compiler
target triple = "x86_64-pc-windows-msvc"

; Runtime type declarations
%struct.tml_str = type { ptr, i64 }

; External function declarations
declare i32 @printf(ptr, ...)
declare i32 @puts(ptr)
declare i32 @putchar(i32)
declare ptr @malloc(i64)
declare void @free(ptr)

; Threading runtime (tml_runtime.c)
declare ptr @tml_thread_spawn(ptr, ptr)
declare void @tml_thread_join(ptr)
declare void @tml_thread_yield()
declare void @tml_thread_sleep(i32)
declare i32 @tml_thread_id()

; Time functions
declare i32 @tml_time_ms()
declare i64 @tml_time_us()
declare i64 @tml_time_ns()

; Float functions
declare ptr @tml_float_to_fixed(double, i32)
declare ptr @tml_float_to_precision(double, i32)
declare ptr @tml_float_to_string(double)
declare double @tml_int_to_float(i32)
declare double @tml_i64_to_float(i64)
declare i32 @tml_float_to_int(double)
declare i64 @tml_float_to_i64(double)
declare i32 @tml_float_round(double)
declare i32 @tml_float_floor(double)
declare i32 @tml_float_ceil(double)
declare double @tml_float_abs(double)
declare double @tml_float_sqrt(double)
declare double @tml_float_pow(double, i32)

; Channel runtime (Go-style)
declare ptr @tml_channel_create()
declare i32 @tml_channel_send(ptr, i32)
declare i32 @tml_channel_recv(ptr, ptr)
declare i32 @tml_channel_try_send(ptr, i32)
declare i32 @tml_channel_try_recv(ptr, ptr)
declare void @tml_channel_close(ptr)
declare void @tml_channel_destroy(ptr)
declare i32 @tml_channel_len(ptr)

; Mutex runtime
declare ptr @tml_mutex_create()
declare void @tml_mutex_lock(ptr)
declare void @tml_mutex_unlock(ptr)
declare i32 @tml_mutex_try_lock(ptr)
declare void @tml_mutex_destroy(ptr)

; WaitGroup runtime (Go-style)
declare ptr @tml_waitgroup_create()
declare void @tml_waitgroup_add(ptr, i32)
declare void @tml_waitgroup_done(ptr)
declare void @tml_waitgroup_wait(ptr)
declare void @tml_waitgroup_destroy(ptr)

; Atomic counter runtime
declare ptr @tml_atomic_counter_create(i32)
declare i32 @tml_atomic_counter_inc(ptr)
declare i32 @tml_atomic_counter_dec(ptr)
declare i32 @tml_atomic_counter_get(ptr)
declare void @tml_atomic_counter_set(ptr, i32)
declare void @tml_atomic_counter_destroy(ptr)

; List (dynamic array) runtime
declare ptr @tml_list_create(i32)
declare void @tml_list_destroy(ptr)
declare void @tml_list_push(ptr, i32)
declare i32 @tml_list_pop(ptr)
declare i32 @tml_list_get(ptr, i32)
declare void @tml_list_set(ptr, i32, i32)
declare i32 @tml_list_len(ptr)
declare i32 @tml_list_capacity(ptr)
declare void @tml_list_clear(ptr)
declare i32 @tml_list_is_empty(ptr)

; HashMap runtime
declare ptr @tml_hashmap_create()
declare void @tml_hashmap_destroy(ptr)
declare void @tml_hashmap_set(ptr, i32, i32)
declare i32 @tml_hashmap_get(ptr, i32, ptr)
declare i32 @tml_hashmap_has(ptr, i32)
declare i32 @tml_hashmap_remove(ptr, i32)
declare i32 @tml_hashmap_len(ptr)
declare void @tml_hashmap_clear(ptr)

; Buffer runtime
declare ptr @tml_buffer_create(i32)
declare void @tml_buffer_destroy(ptr)
declare void @tml_buffer_write_byte(ptr, i32)
declare void @tml_buffer_write_i32(ptr, i32)
declare i32 @tml_buffer_read_byte(ptr)
declare i32 @tml_buffer_read_i32(ptr)
declare i32 @tml_buffer_len(ptr)
declare i32 @tml_buffer_capacity(ptr)
declare i32 @tml_buffer_remaining(ptr)
declare void @tml_buffer_clear(ptr)
declare void @tml_buffer_reset_read(ptr)

; String utilities
declare i32 @tml_str_len(ptr)
declare i32 @tml_str_hash(ptr)
declare i32 @tml_str_eq(ptr, ptr)

; Format strings
@.fmt.int = private constant [4 x i8] c"%d\0A\00"
@.fmt.int.no_nl = private constant [3 x i8] c"%d\00"
@.fmt.i64 = private constant [5 x i8] c"%ld\0A\00"
@.fmt.i64.no_nl = private constant [4 x i8] c"%ld\00"
@.fmt.float = private constant [4 x i8] c"%f\0A\00"
@.fmt.float.no_nl = private constant [3 x i8] c"%f\00"
@.fmt.float3 = private constant [6 x i8] c"%.3f\0A\00"
@.fmt.float3.no_nl = private constant [5 x i8] c"%.3f\00"
@.fmt.str.no_nl = private constant [3 x i8] c"%s\00"
@.str.true = private constant [5 x i8] c"true\00"
@.str.false = private constant [6 x i8] c"false\00"
@.str.space = private constant [2 x i8] c" \00"
@.str.newline = private constant [2 x i8] c"\0A\00"


define i32 @tml_main() {
entry:
  %t0 = call i32 @puts(ptr @.str.0)
  %t1 = call i32 @puts(ptr @.str.1)
  %t2 = alloca i32
  %t3 = sitofp i32 7 to double
  %t4 = call i32 @tml_float_round(double %t3)
  store i32 %t4, ptr %t2
  %t5 = alloca i32
  %t6 = sitofp i32 7 to double
  %t7 = call i32 @tml_float_floor(double %t6)
  store i32 %t7, ptr %t5
  %t8 = alloca i32
  %t9 = sitofp i32 7 to double
  %t10 = call i32 @tml_float_ceil(double %t9)
  store i32 %t10, ptr %t8
  %t11 = call i32 (ptr, ...) @printf(ptr @.fmt.str.no_nl, ptr @.str.2)
  %t12 = load i32, ptr %t2
  %t13 = call i32 (ptr, ...) @printf(ptr @.fmt.int.no_nl, i32 %t12)
  %t14 = call i32 @putchar(i32 10)
  %t15 = call i32 (ptr, ...) @printf(ptr @.fmt.str.no_nl, ptr @.str.3)
  %t16 = load i32, ptr %t5
  %t17 = call i32 (ptr, ...) @printf(ptr @.fmt.int.no_nl, i32 %t16)
  %t18 = call i32 @putchar(i32 10)
  %t19 = call i32 (ptr, ...) @printf(ptr @.fmt.str.no_nl, ptr @.str.4)
  %t20 = load i32, ptr %t8
  %t21 = call i32 (ptr, ...) @printf(ptr @.fmt.int.no_nl, i32 %t20)
  %t22 = call i32 @putchar(i32 10)
  %t23 = alloca i32
  %t24 = sitofp i32 5 to double
  %t25 = call double @tml_float_abs(double %t24)
  %t26 = fptosi double %t25 to i32
  store i32 %t26, ptr %t23
  %t27 = alloca i32
  %t28 = sub i32 0, 5
  %t29 = sitofp i32 %t28 to double
  %t30 = call double @tml_float_abs(double %t29)
  %t31 = fptosi double %t30 to i32
  store i32 %t31, ptr %t27
  %t32 = call i32 (ptr, ...) @printf(ptr @.fmt.str.no_nl, ptr @.str.5)
  %t33 = load i32, ptr %t23
  %t34 = call i32 (ptr, ...) @printf(ptr @.fmt.int.no_nl, i32 %t33)
  %t35 = call i32 @putchar(i32 10)
  %t36 = call i32 (ptr, ...) @printf(ptr @.fmt.str.no_nl, ptr @.str.6)
  %t37 = load i32, ptr %t27
  %t38 = call i32 (ptr, ...) @printf(ptr @.fmt.int.no_nl, i32 %t37)
  %t39 = call i32 @putchar(i32 10)
  %t40 = call i32 (ptr, ...) @printf(ptr @.fmt.str.no_nl, ptr @.str.7)
  %t41 = sitofp i32 16 to double
  %t42 = call double @tml_float_sqrt(double %t41)
  %t43 = fptosi double %t42 to i32
  %t44 = call i32 (ptr, ...) @printf(ptr @.fmt.int.no_nl, i32 %t43)
  %t45 = call i32 @putchar(i32 10)
  %t46 = call i32 (ptr, ...) @printf(ptr @.fmt.str.no_nl, ptr @.str.8)
  %t47 = sitofp i32 2 to double
  %t48 = call double @tml_float_pow(double %t47, i32 10)
  %t49 = fptosi double %t48 to i32
  %t50 = call i32 (ptr, ...) @printf(ptr @.fmt.int.no_nl, i32 %t49)
  %t51 = call i32 @putchar(i32 10)
  %t52 = call i32 @puts(ptr @.str.9)
  %t53 = call i32 @puts(ptr @.str.10)
  %t54 = alloca i32
  %t55 = sitofp i32 12345 to double
  %t56 = call ptr @tml_float_to_fixed(double %t55, i32 2)
  store i32 %t56, ptr %t54
  %t57 = call i32 (ptr, ...) @printf(ptr @.fmt.str.no_nl, ptr @.str.11)
  %t58 = load i32, ptr %t54
  %t59 = call i32 (ptr, ...) @printf(ptr @.fmt.int.no_nl, i32 %t58)
  %t60 = call i32 @putchar(i32 10)
  %t61 = call i32 @puts(ptr @.str.12)
  %t62 = call i32 @puts(ptr @.str.13)
  ret i32 0
}
; String constants
@.str.0 = private constant [29 x i8] c"=== Float Function Tests ===\00"
@.str.1 = private constant [1 x i8] c"\00"
@.str.2 = private constant [12 x i8] c"round(7) = \00"
@.str.3 = private constant [12 x i8] c"floor(7) = \00"
@.str.4 = private constant [11 x i8] c"ceil(7) = \00"
@.str.5 = private constant [10 x i8] c"abs(5) = \00"
@.str.6 = private constant [11 x i8] c"abs(-5) = \00"
@.str.7 = private constant [12 x i8] c"sqrt(16) = \00"
@.str.8 = private constant [14 x i8] c"pow(2, 10) = \00"
@.str.9 = private constant [1 x i8] c"\00"
@.str.10 = private constant [29 x i8] c"String formatting functions:\00"
@.str.11 = private constant [21 x i8] c"toFixed(12345, 2) = \00"
@.str.12 = private constant [1 x i8] c"\00"
@.str.13 = private constant [6 x i8] c"Done.\00"

; Entry point
define i32 @main(i32 %argc, ptr %argv) {
entry:
  call void @tml_main()
  ret i32 0
}
