// Error handling types and traits

/// Standard error trait
pub behavior Error {
    func message(this) -> Str
    func source(this) -> Maybe[Error]
}

/// Generic error type
pub type GenericError {
    message: Str,
    source: Maybe[Error],
}

impl Error for GenericError {
    func message(this) -> Str {
        this.message
    }

    func source(this) -> Maybe[Error] {
        this.source
    }
}

impl GenericError {
    pub func new(message: Str) -> GenericError {
        GenericError {
            message: message,
            source: Nothing,
        }
    }

    pub func with_source(message: Str, source: Error) -> GenericError {
        GenericError {
            message: message,
            source: Just(source),
        }
    }
}

/// I/O error types
pub type IoError {
    NotFound,
    PermissionDenied,
    ConnectionRefused,
    ConnectionReset,
    ConnectionAborted,
    NotConnected,
    AddrInUse,
    AddrNotAvailable,
    BrokenPipe,
    AlreadyExists,
    WouldBlock,
    InvalidInput,
    InvalidData,
    TimedOut,
    WriteZero,
    Interrupted,
    Other(message: Str),
}

impl Error for IoError {
    func message(this) -> Str {
        when this {
            IoError::NotFound => "entity not found",
            IoError::PermissionDenied => "permission denied",
            IoError::ConnectionRefused => "connection refused",
            IoError::ConnectionReset => "connection reset",
            IoError::ConnectionAborted => "connection aborted",
            IoError::NotConnected => "not connected",
            IoError::AddrInUse => "address in use",
            IoError::AddrNotAvailable => "address not available",
            IoError::BrokenPipe => "broken pipe",
            IoError::AlreadyExists => "entity already exists",
            IoError::WouldBlock => "operation would block",
            IoError::InvalidInput => "invalid input",
            IoError::InvalidData => "invalid data",
            IoError::TimedOut => "timed out",
            IoError::WriteZero => "write zero",
            IoError::Interrupted => "interrupted",
            IoError::Other(msg) => msg,
        }
    }

    func source(this) -> Maybe[Error] {
        Nothing
    }
}

/// Parse error
pub type ParseError {
    message: Str,
    line: I32,
    column: I32,
}

impl Error for ParseError {
    func message(this) -> Str {
        this.message + " at line " + this.line.to_string() +
            ", column " + this.column.to_string()
    }

    func source(this) -> Maybe[Error] {
        Nothing
    }
}
