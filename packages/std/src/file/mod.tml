// TML Standard Library - File I/O Module
// Provides: File object and Path utilities

// ============================================================================
// File Handle
// ============================================================================

/// File open modes
pub const FILE_READ: I32 = 1
pub const FILE_WRITE: I32 = 2
pub const FILE_APPEND: I32 = 4

/// File handle for reading and writing
pub type File {
    handle: *Unit
}

impl File {
    /// Open a file with the specified mode
    /// Modes: FILE_READ, FILE_WRITE, FILE_APPEND (can be combined with |)
    pub func open(path: Str, mode: I32) -> File {
        let handle: *Unit = lowlevel { file_open(path, mode) }
        File { handle: handle }
    }

    /// Open a file for reading
    pub func open_read(path: Str) -> File {
        File.open(path, FILE_READ)
    }

    /// Open a file for writing (creates or truncates)
    pub func open_write(path: Str) -> File {
        File.open(path, FILE_WRITE)
    }

    /// Open a file for appending
    pub func open_append(path: Str) -> File {
        File.open(path, FILE_APPEND)
    }

    /// Check if the file is open
    pub func is_open(this) -> Bool {
        lowlevel { file_is_open(this.handle) }
    }

    /// Read up to `size` bytes into a buffer, returns bytes read
    pub func read(this, buffer: *U8, size: I64) -> I64 {
        lowlevel { file_read(this.handle, buffer, size) }
    }

    /// Read a single line from the file
    pub func read_line(this) -> Str {
        lowlevel { file_read_line(this.handle) }
    }

    /// Write bytes to the file, returns bytes written
    pub func write(this, data: *U8, size: I64) -> I64 {
        lowlevel { file_write(this.handle, data, size) }
    }

    /// Write a string to the file
    pub func write_str(this, content: Str) -> Bool {
        lowlevel { file_write_str(this.handle, content) }
    }

    /// Get the size of the file in bytes
    pub func size(this) -> I64 {
        lowlevel { file_size(this.handle) }
    }

    /// Get the current position in the file
    pub func position(this) -> I64 {
        lowlevel { file_position(this.handle) }
    }

    /// Seek to a specific position in the file
    pub func seek(this, position: I64) -> Bool {
        lowlevel { file_seek(this.handle, position) }
    }

    /// Seek to the end of the file
    pub func seek_end(this) -> Bool {
        lowlevel { file_seek_end(this.handle) }
    }

    /// Seek to the beginning of the file
    pub func rewind(this) {
        lowlevel { file_rewind(this.handle) }
    }

    /// Close the file
    pub func close(this) {
        lowlevel { file_close(this.handle) }
    }

    // ========== Static utility functions ==========

    /// Read entire file contents as a string
    pub func read_all(path: Str) -> Str {
        lowlevel { file_read_all(path) }
    }

    /// Write content to a file (overwrites if exists)
    pub func write_all(path: Str, content: Str) -> Bool {
        lowlevel { file_write_all(path, content) }
    }

    /// Append content to a file
    pub func append_all(path: Str, content: Str) -> Bool {
        lowlevel { file_append_all(path, content) }
    }
}

// ============================================================================
// Path - Path manipulation utilities
// ============================================================================

/// Path utilities (all static functions)
pub type Path {}

impl Path {
    /// Check if a path exists
    pub func exists(path: Str) -> Bool {
        lowlevel { path_exists(path) }
    }

    /// Check if path is a file
    pub func is_file(path: Str) -> Bool {
        lowlevel { path_is_file(path) }
    }

    /// Check if path is a directory
    pub func is_dir(path: Str) -> Bool {
        lowlevel { path_is_dir(path) }
    }

    /// Create a directory
    pub func create_dir(path: Str) -> Bool {
        lowlevel { path_create_dir(path) }
    }

    /// Create a directory and all parent directories
    pub func create_dir_all(path: Str) -> Bool {
        lowlevel { path_create_dir_all(path) }
    }

    /// Remove a file
    pub func remove(path: Str) -> Bool {
        lowlevel { path_remove(path) }
    }

    /// Remove an empty directory
    pub func remove_dir(path: Str) -> Bool {
        lowlevel { path_remove_dir(path) }
    }

    /// Rename/move a file or directory
    pub func rename(from: Str, to: Str) -> Bool {
        lowlevel { path_rename(from, to) }
    }

    /// Copy a file
    pub func copy(from: Str, to: Str) -> Bool {
        lowlevel { path_copy(from, to) }
    }

    /// Join two path components
    pub func join(base: Str, child: Str) -> Str {
        lowlevel { path_join(base, child) }
    }

    /// Get the parent directory of a path
    pub func parent(path: Str) -> Str {
        lowlevel { path_parent(path) }
    }

    /// Get the filename from a path
    pub func filename(path: Str) -> Str {
        lowlevel { path_filename(path) }
    }

    /// Get the file extension (including dot)
    pub func extension(path: Str) -> Str {
        lowlevel { path_extension(path) }
    }

    /// Get the absolute path
    pub func absolute(path: Str) -> Str {
        lowlevel { path_absolute(path) }
    }
}
