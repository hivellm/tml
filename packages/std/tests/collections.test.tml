// Tests for std::collections
use test
use std::collections

// ============================================================================
// List Tests
// ============================================================================

@test
func test_list_new() -> I32 {
    let list: List[I32] = List[I32].new(16)
    assert(list.len() == 0, "new list should be empty")
    list.destroy()
    return 0
}

@test
func test_list_push_pop() -> I32 {
    let list: List[I32] = List[I32].default()
    list.push(10)
    list.push(20)
    list.push(30)

    assert(list.len() == 3, "len should be 3")
    assert(list.pop() == 30, "pop should return 30")
    assert(list.pop() == 20, "pop should return 20")
    assert(list.len() == 1, "len should be 1")

    list.destroy()
    return 0
}

@test
func test_list_get_set() -> I32 {
    let list: List[I32] = List[I32].new(8)
    list.push(10)
    list.push(20)
    list.push(30)

    assert(list.get(0) == 10, "get(0) should be 10")
    assert(list.get(1) == 20, "get(1) should be 20")
    assert(list.get(2) == 30, "get(2) should be 30")

    list.set(1, 200)
    assert(list.get(1) == 200, "after set, get(1) should be 200")

    list.destroy()
    return 0
}

// ============================================================================
// HashMap Tests
// ============================================================================

@test
func test_hashmap_basic() -> I32 {
    let map: HashMap[I32, I32] = HashMap[I32, I32].new(16)

    map.set(1, 100)
    map.set(2, 200)
    map.set(3, 300)

    assert(map.len() == 3, "len should be 3")
    assert(map.get(1) == 100, "get(1) should be 100")
    assert(map.get(2) == 200, "get(2) should be 200")
    assert(map.get(3) == 300, "get(3) should be 300")
    // map.has() returns Bool - skip for now due to i1/i32 issue

    map.destroy()
    return 0
}

// ============================================================================
// Buffer Tests
// ============================================================================

@test
func test_buffer_write_read_byte() -> I32 {
    let buf: Buffer = Buffer.new(64)

    buf.write_byte(65)  // 'A'
    buf.write_byte(66)  // 'B'
    buf.write_byte(67)  // 'C'

    assert(buf.len() == 3, "len should be 3")

    buf.reset_read()
    assert(buf.read_byte() == 65, "first byte should be 65")
    assert(buf.read_byte() == 66, "second byte should be 66")
    assert(buf.read_byte() == 67, "third byte should be 67")

    buf.destroy()
    return 0
}

@test
func test_buffer_write_read_i32() -> I32 {
    let buf: Buffer = Buffer.new(64)

    buf.write_i32(12345)
    buf.write_i32(-9999)

    assert(buf.len() == 8, "len should be 8 (2 x 4 bytes)")

    buf.reset_read()
    assert(buf.read_i32() == 12345, "first i32 should be 12345")
    assert(buf.read_i32() == -9999, "second i32 should be -9999")

    buf.destroy()
    return 0
}
