// Test iterator combinators
use test
use std::iter

@test
func test_range_sum() -> I32 {
    // range(1, 5) gives [1, 2, 3, 4], sum = 10
    let mut r: Range = range(1, 5)
    let result: I32 = r.sum()
    assert(result == 10, "range(1,5).sum() should be 10")
    return 0
}

@test
func test_range_count() -> I32 {
    // range(0, 10) gives 10 elements
    let mut r: Range = range(0, 10)
    let result: I32 = r.count()
    assert(result == 10, "range(0,10).count() should be 10")
    return 0
}

@test
func test_range_fold() -> I32 {
    // fold with multiplication: 1*2*3*4 = 24
    let mut r: Range = range(1, 5)
    let result: I32 = r.fold(1, do(acc: I32, x: I32) -> I32 acc * x)
    assert(result == 24, "range(1,5).fold(1, mul) should be 24")
    return 0
}

@test
func test_range_any() -> I32 {
    let mut r1: Range = range(1, 10)
    let found: Bool = r1.any(do(x: I32) -> Bool x == 5)
    assert(found, "range(1,10) should have 5")

    let mut r2: Range = range(1, 5)
    let not_found: Bool = r2.any(do(x: I32) -> Bool x == 10)
    assert(not not_found, "range(1,5) should not have 10")
    return 0
}

@test
func test_range_all() -> I32 {
    let mut r1: Range = range(1, 5)
    let all_positive: Bool = r1.all(do(x: I32) -> Bool x > 0)
    assert(all_positive, "all elements in range(1,5) should be > 0")

    let mut r2: Range = range(1, 10)
    let all_small: Bool = r2.all(do(x: I32) -> Bool x < 5)
    assert(not all_small, "not all elements in range(1,10) are < 5")
    return 0
}

@test
func test_range_take() -> I32 {
    // take first 3 from range(0, 100): [0, 1, 2], sum = 3
    let r: Range = range(0, 100)
    let mut taken: Range = r.take(3)
    let result: I32 = taken.sum()
    assert(result == 3, "range(0,100).take(3).sum() should be 3")
    return 0
}

@test
func test_range_skip() -> I32 {
    // skip first 7 from range(0, 10): [7, 8, 9], sum = 24
    let r: Range = range(0, 10)
    let mut skipped: Range = r.skip(7)
    let result: I32 = skipped.sum()
    assert(result == 24, "range(0,10).skip(7).sum() should be 24")
    return 0
}

@test
func test_range_inclusive_sum() -> I32 {
    // range_inclusive(1, 5) gives [1, 2, 3, 4, 5], sum = 15
    let mut r: Range = range_inclusive(1, 5)
    let result: I32 = r.sum()
    assert(result == 15, "range_inclusive(1,5).sum() should be 15")
    return 0
}
