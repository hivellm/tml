// Minimal test to debug crash
use test

@test
func test_is_ok() {
    let o: Outcome[I32, Str] = Ok(42)
    assert(o.is_ok())
}

@test
func test_is_ok_false() {
    let o: Outcome[I32, Str] = Err("error")
    assert(o.is_ok() == false)
}

@test
func test_is_err_true() {
    let o: Outcome[I32, Str] = Err("error")
    assert(o.is_err())
}

@test
func test_is_err_false() {
    let o: Outcome[I32, Str] = Ok(42)
    assert(o.is_err() == false)
}

@test
func test_is_ok_and_false_predicate() {
    let o: Outcome[I32, Str] = Ok(3)
    assert(o.is_ok_and(do(x: I32) x > 5) == false)
}

@test
func test_is_ok_and_err() {
    let o: Outcome[I32, Str] = Err("error")
    assert(o.is_ok_and(do(x: I32) x > 5) == false)
}

@test
func test_is_err_and_false_predicate() {
    let o: Outcome[I32, Str] = Err("warning")
    assert(o.is_err_and(do(e: Str) e == "fatal") == false)
}

@test
func test_is_err_and_ok() {
    let o: Outcome[I32, Str] = Ok(42)
    assert(o.is_err_and(do(e: Str) e == "fatal") == false)
}

@test
func test_unwrap() {
    let o: Outcome[I32, Str] = Ok(42)
    assert_eq(o.unwrap(), 42)
}

@test
func test_map() {
    let o: Outcome[I32, Str] = Ok(10)
    let result: Outcome[I32, Str] = o.map(do(x: I32) x * 2)
    assert(result.is_ok())
    assert_eq(result.unwrap(), 20)
}

@test
func test_map_err_passthrough() {
    let o: Outcome[I32, Str] = Err("error")
    let result: Outcome[I32, Str] = o.map(do(x: I32) x * 2)
    assert(result.is_err())
    assert_eq(result.unwrap_err(), "error")
}

@test
func test_ok_method() {
    let o: Outcome[I32, Str] = Ok(42)
    let m: Maybe[I32] = o.ok()
    assert(m.is_just())
    assert_eq(m.unwrap(), 42)
}

@test
func test_err_method() {
    let o: Outcome[I32, Str] = Err("error")
    let m: Maybe[Str] = o.err()
    assert(m.is_just())
    assert_eq(m.unwrap(), "error")
}

@test
func test_contains() {
    let o: Outcome[I32, Str] = Ok(42)
    assert(o.contains(42))
}

@test
func test_contains_ok_false() {
    let o: Outcome[I32, Str] = Ok(42)
    assert(o.contains(100) == false)
}

@test
func test_contains_on_err() {
    let o: Outcome[I32, Str] = Err("error")
    assert(o.contains(42) == false)
}

@test
func test_contains_err_on_ok() {
    let o: Outcome[I32, Str] = Ok(42)
    assert(o.contains_err("error") == false)
}

@test
func test_contains_err_false() {
    let o: Outcome[I32, Str] = Err("error")
    assert(o.contains_err("other") == false)
}

@test
func test_contains_err() {
    let o: Outcome[I32, Str] = Err("error")
    assert(o.contains_err("error"))
}

// @test
// func test_contains_err_false() {
//     let o: Outcome[I32, Str] = Err("error")
//     assert(o.contains_err("other") == false)
// }

@test
func test_is_ok_and() {
    let o: Outcome[I32, Str] = Ok(10)
    assert(o.is_ok_and(do(x: I32) x > 5))
}

@test
func test_is_err_and() {
    let o: Outcome[I32, Str] = Err("fatal")
    assert(o.is_err_and(do(e: Str) e == "fatal"))
}

@test
func test_alt_ok() {
    let o: Outcome[I32, Str] = Ok(42)
    let result: Outcome[I32, Str] = o.alt(Ok(99))
    assert_eq(result.unwrap(), 42)
}

@test
func test_alt_err() {
    let o: Outcome[I32, Str] = Err("error")
    let result: Outcome[I32, Str] = o.alt(Ok(99))
    assert_eq(result.unwrap(), 99)
}

@test
func test_also_ok_ok() {
    let a: Outcome[I32, Str] = Ok(1)
    let b: Outcome[Str, Str] = Ok("hello")
    let result: Outcome[Str, Str] = a.also(b)
    assert_eq(result.unwrap(), "hello")
}

@test
func test_also_err_ok() {
    let a: Outcome[I32, Str] = Err("error")
    let b: Outcome[Str, Str] = Ok("hello")
    let result: Outcome[Str, Str] = a.also(b)
    assert(result.is_err())
    assert_eq(result.unwrap_err(), "error")
}

@test
func test_unwrap_or_else_ok() {
    let o: Outcome[I32, Str] = Ok(42)
    assert_eq(o.unwrap_or_else(do(e: Str) 99), 42)
}

@test
func test_unwrap_or_else_err() {
    let o: Outcome[I32, Str] = Err("error")
    assert_eq(o.unwrap_or_else(do(e: Str) 99), 99)
}

@test
func test_unwrap_or_default_ok() {
    let o: Outcome[I32, Str] = Ok(42)
    assert_eq(o.unwrap_or_default(), 42)
}

@test
func test_unwrap_or_default_err() {
    let o: Outcome[I32, Str] = Err("error")
    assert_eq(o.unwrap_or_default(), 0)
}

@test
func test_map_or_ok() {
    let o: Outcome[I32, Str] = Ok(10)
    let result: I32 = o.map_or(0, do(x: I32) x * 2)
    assert_eq(result, 20)
}

@test
func test_map_or_err() {
    let o: Outcome[I32, Str] = Err("error")
    let result: I32 = o.map_or(99, do(x: I32) x * 2)
    assert_eq(result, 99)
}

@test
func test_expect_ok() {
    let o: Outcome[I32, Str] = Ok(100)
    assert_eq(o.expect("should be ok"), 100)
}

@test
func test_unwrap_err_err() {
    let o: Outcome[I32, Str] = Err("error message")
    assert_eq(o.unwrap_err(), "error message")
}

@test
func test_expect_err_err() {
    let o: Outcome[I32, Str] = Err("error")
    assert_eq(o.expect_err("should be err"), "error")
}

@test
func test_unwrap_or_ok() {
    let o: Outcome[I32, Str] = Ok(42)
    assert_eq(o.unwrap_or(99), 42)
}

@test
func test_unwrap_or_err() {
    let o: Outcome[I32, Str] = Err("error")
    assert_eq(o.unwrap_or(99), 99)
}
