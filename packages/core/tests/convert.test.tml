// Tests for core::convert module

use core::convert::{From, Into, TryFrom, TryInto, AsRef, AsMut}

// ============================================================================
// From/Into Tests
// ============================================================================

@test
func test_i8_to_i16() {
    let x: I8 = 42
    let y: I16 = I16::from(x)
    assert_eq(y, 42 as I16)
}

@test
func test_i8_to_i32() {
    let x: I8 = -10
    let y: I32 = I32::from(x)
    assert_eq(y, -10)
}

@test
func test_i8_to_i64() {
    let x: I8 = 127
    let y: I64 = I64::from(x)
    assert_eq(y, 127 as I64)
}

@test
func test_i16_to_i32() {
    let x: I16 = 1000
    let y: I32 = I32::from(x)
    assert_eq(y, 1000)
}

@test
func test_i16_to_i64() {
    let x: I16 = -32000
    let y: I64 = I64::from(x)
    assert_eq(y, -32000 as I64)
}

@test
func test_i32_to_i64() {
    let x: I32 = 2000000000
    let y: I64 = I64::from(x)
    assert_eq(y, 2000000000 as I64)
}

@test
func test_u8_to_u16() {
    let x: U8 = 255
    let y: U16 = U16::from(x)
    assert_eq(y, 255 as U16)
}

@test
func test_u8_to_u32() {
    let x: U8 = 100
    let y: U32 = U32::from(x)
    assert_eq(y, 100 as U32)
}

@test
func test_u8_to_u64() {
    let x: U8 = 200
    let y: U64 = U64::from(x)
    assert_eq(y, 200 as U64)
}

@test
func test_u16_to_u32() {
    let x: U16 = 50000
    let y: U32 = U32::from(x)
    assert_eq(y, 50000 as U32)
}

@test
func test_u16_to_u64() {
    let x: U16 = 65535
    let y: U64 = U64::from(x)
    assert_eq(y, 65535 as U64)
}

@test
func test_u32_to_u64() {
    let x: U32 = 4000000000
    let y: U64 = U64::from(x)
    assert_eq(y, 4000000000 as U64)
}

@test
func test_f32_to_f64() {
    let x: F32 = 3.14
    let y: F64 = F64::from(x)
    assert(y > 3.13 and y < 3.15)
}

// ============================================================================
// Into Tests (uses From implementations)
// ============================================================================

@test
func test_into_i32_from_i8() {
    let x: I8 = 50
    let y: I32 = x.into()
    assert_eq(y, 50)
}

@test
func test_into_i64_from_i32() {
    let x: I32 = 123456
    let y: I64 = x.into()
    assert_eq(y, 123456 as I64)
}

// ============================================================================
// TryFrom/TryInto Tests
// ============================================================================

@test
func test_try_from_i32_to_i8_success() {
    let x: I32 = 100
    let result: Outcome[I8, Str] = I8::try_from(x)
    assert(result.is_ok())
    assert_eq(result.unwrap(), 100 as I8)
}

@test
func test_try_from_i32_to_i8_overflow() {
    let x: I32 = 200  // > 127, out of I8 range
    let result: Outcome[I8, Str] = I8::try_from(x)
    assert(result.is_err())
}

@test
func test_try_from_i32_to_i8_underflow() {
    let x: I32 = -200  // < -128, out of I8 range
    let result: Outcome[I8, Str] = I8::try_from(x)
    assert(result.is_err())
}

@test
func test_try_from_i64_to_i32_success() {
    let x: I64 = 1000000
    let result: Outcome[I32, Str] = I32::try_from(x)
    assert(result.is_ok())
    assert_eq(result.unwrap(), 1000000)
}

@test
func test_try_from_i64_to_i32_overflow() {
    let x: I64 = 3000000000  // > I32 max
    let result: Outcome[I32, Str] = I32::try_from(x)
    assert(result.is_err())
}

@test
func test_try_into_i8_from_i32() {
    let x: I32 = 50
    let result: Outcome[I8, Str] = x.try_into()
    assert(result.is_ok())
    assert_eq(result.unwrap(), 50 as I8)
}

// ============================================================================
// AsRef Tests
// ============================================================================

@test
func test_as_ref_str() {
    let s: Str = "hello"
    let r: ref Str = s.as_ref()
    assert_eq(*r, "hello")
}

@test
func test_as_ref_i32() {
    let x: I32 = 42
    let r: ref I32 = x.as_ref()
    assert_eq(*r, 42)
}

// ============================================================================
// Identity Conversion Tests
// ============================================================================

@test
func test_identity_from_i32() {
    let x: I32 = 999
    let y: I32 = I32::from(x)
    assert_eq(y, 999)
}

@test
func test_identity_from_str() {
    let s: Str = "test"
    let t: Str = Str::from(s)
    assert_eq(t, "test")
}

@test
func test_identity_from_bool() {
    let b: Bool = true
    let c: Bool = Bool::from(b)
    assert_eq(c, true)
}
