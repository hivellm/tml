// Tests for core::ptr module
// Note: RawPtr and RawMutPtr are defined in packages/core/src/ptr.tml
// Most ptr operations require lowlevel intrinsics not yet implemented.
use test

// ============================================================================
// Pointer Arithmetic Logic Tests (Pure TML, no lowlevel required)
// These test the underlying math that ptr operations use
// ============================================================================

@test
func test_ptr_address_arithmetic() {
    // Simulating pointer address arithmetic with I64
    let base_addr: I64 = 4096  // 0x1000
    let element_size: I64 = 8  // sizeof(I64)

    // Offset calculation (what ptr.offset does internally)
    let offset_addr: I64 = base_addr + 2 * element_size
    assert_eq(offset_addr, 4112)  // 0x1010

    // Add calculation
    let add_addr: I64 = base_addr + 1 * element_size
    assert_eq(add_addr, 4104)  // 0x1008

    // Sub calculation
    let sub_addr: I64 = base_addr - 1 * element_size
    assert_eq(sub_addr, 4088)  // 0x0FF8
}

@test
func test_ptr_null_check_logic() {
    // Testing null pointer check logic (is_null returns addr == 0)
    let null_addr: I64 = 0
    let valid_addr: I64 = 4096

    assert(null_addr == 0)
    assert(valid_addr != 0)
}

@test
func test_ptr_distance_calculation() {
    // Testing distance calculation logic
    let start: I64 = 4096   // 0x1000
    let end: I64 = 4112     // 0x1010
    let element_size: I64 = 8

    let distance: I64 = (end - start) / element_size
    assert_eq(distance, 2)
}

@test
func test_ptr_cast_logic() {
    // Cast preserves address, only changes type interpretation
    let addr: I64 = 4096
    // After cast, addr would be the same
    assert_eq(addr, 4096)
}

// ============================================================================
// TODO: Tests below require core::ptr module types to be loadable
// ============================================================================

// The following tests require the compiler to:
// 1. Load type definitions from core::ptr module
// 2. Support generic struct types like RawPtr[T]
// 3. Support impl blocks with generic parameters

// Pure TML methods (no lowlevel required):
// - RawPtr::null(), is_null(), addr(), from_addr(), cast()
// - RawMutPtr::null(), is_null(), addr(), from_addr(), cast(), as_const()
// - NonNull::new() (checks is_null)

// Methods requiring lowlevel intrinsics:
// - offset(), add(), sub() - require sizeof_type[T]()
// - read(), read_unaligned(), read_volatile() - require ptr_read[T]()
// - write(), write_unaligned(), write_volatile() - require ptr_write[T]()
// - dangling() - requires alignof_type[T]()
// - copy_nonoverlapping(), copy(), write_bytes() - require memcpy/memmove/memset
