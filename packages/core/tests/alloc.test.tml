// Tests for core::alloc module
use test
use core::alloc

// ============================================================================
// Layout Basic Tests
// ============================================================================

@test
func test_layout_unchecked() {
    let layout: Layout = Layout::from_size_align_unchecked(50, 4)
    assert_eq(layout.size(), 50)
    assert_eq(layout.align(), 4)
}

@test
func test_layout_from_size_align_valid() {
    let result: Outcome[Layout, LayoutError] = Layout::from_size_align(100, 8)
    assert(result.is_ok())
    let layout: Layout = result.unwrap()
    assert_eq(layout.size(), 100)
    assert_eq(layout.align(), 8)
}

@test
func test_layout_from_size_align_power_of_two() {
    let result: Outcome[Layout, LayoutError] = Layout::from_size_align(100, 16)
    assert(result.is_ok())
    let layout: Layout = result.unwrap()
    assert_eq(layout.align(), 16)
}

@test
func test_layout_from_size_align_invalid_align() {
    // Alignment 3 is not a power of two
    let result: Outcome[Layout, LayoutError] = Layout::from_size_align(100, 3)
    assert(result.is_err())
}

@test
func test_layout_from_size_align_zero_align() {
    // Alignment 0 is invalid
    let result: Outcome[Layout, LayoutError] = Layout::from_size_align(100, 0)
    assert(result.is_err())
}

// ============================================================================
// Layout Padding Tests
// ============================================================================

@test
func test_layout_padding_needed_aligned() {
    let layout: Layout = Layout::from_size_align_unchecked(8, 8)
    // 8 is already aligned to 8, no padding needed
    assert_eq(layout.padding_needed_for(8), 0)
}

@test
func test_layout_padding_needed_unaligned() {
    let layout: Layout = Layout::from_size_align_unchecked(8, 8)
    // 5 needs 3 bytes of padding to reach 8
    assert_eq(layout.padding_needed_for(5), 3)
}

@test
func test_layout_padding_needed_for_4() {
    let layout: Layout = Layout::from_size_align_unchecked(4, 4)
    // 7 needs 1 byte to reach 8 (next multiple of 4)
    assert_eq(layout.padding_needed_for(7), 1)
}

@test
func test_layout_pad_to_align() {
    let layout: Layout = Layout::from_size_align_unchecked(5, 4)
    let padded_result: Outcome[Layout, LayoutError] = layout.pad_to_align()
    assert(padded_result.is_ok())
    let padded: Layout = padded_result.unwrap()
    // Size 5 padded to alignment 4 = 8
    assert_eq(padded.size(), 8)
    assert_eq(padded.align(), 4)
}

// ============================================================================
// AllocError Tests
// ============================================================================

@test
func test_alloc_error_new() {
    let err: AllocError = AllocError::new()
    assert(true)
}

// ============================================================================
// LayoutError Tests
// ============================================================================

@test
func test_layout_error_new() {
    let err: LayoutError = LayoutError::new()
    assert(true)
}
