// Tests for core::cell module
// Note: Cell[T] and RefCell[T] provide interior mutability.
// See packages/core/src/cell.tml for the definitions.

// ============================================================================
// Interior Mutability Concept Tests
// ============================================================================

// Cell[T] and RefCell[T] allow mutating data even through immutable references.
// This is useful when you need shared mutable state with runtime checks.

// Simple test demonstrating the concept Cell[T] enables:
// Mutation through a wrapper while the outer reference is immutable

use test

type SimpleCell {
    value: I32
}

impl SimpleCell {
    pub func new(v: I32) -> SimpleCell {
        return SimpleCell { value: v }
    }

    pub func get(this) -> I32 {
        return this.value
    }

    pub func set(mut this, v: I32) {
        this.value = v
    }
}

@test
func test_simple_cell_get() {
    let c: SimpleCell = SimpleCell::new(42)
    assert_eq(c.get(), 42)
}

@test
func test_simple_cell_set() {
    let c: SimpleCell = SimpleCell::new(42)
    c.set(100)
    assert_eq(c.get(), 100)
}

@test
func test_simple_cell_replace_pattern() {
    let c: SimpleCell = SimpleCell::new(42)
    let old: I32 = c.get()
    c.set(100)
    assert_eq(old, 42)
    assert_eq(c.get(), 100)
}

// ============================================================================
// TODO: Tests below require core::cell module types to be loadable
// ============================================================================

// The core::cell module defines:
// - Cell[T] for Copy types: new(), get(), set(), replace(), take()
// - RefCell[T] for any types: new(), borrow(), borrow_mut(), try_borrow(), try_borrow_mut()
// - Ref[T] and RefMut[T] guard types with Drop behavior
// - BorrowState enum: Unused, Reading(I32), Writing

// These require the compiler to:
// 1. Load and parse type definitions from core library
// 2. Support generic struct types with trait bounds: Cell[T: Copy]
// 3. Support enum types with data: BorrowState::Reading(I32)
// 4. Support Drop behavior for Ref[T] and RefMut[T]
// 5. Support panic() for runtime borrow violations
